
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Active learning example &#8212; Hylleraas Software Platform</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'src/active_learning/Active_learning';</script>
    <link rel="icon" href="../../_static/hylleraas---logo---only.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/hsp---logo.png" class="logo__image only-light" alt="Hylleraas Software Platform - Home"/>
    <script>document.write(`<img src="../../_static/hsp---logo---neg.png" class="logo__image only-dark" alt="Hylleraas Software Platform - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">
<div class="prev-next-area">
</div></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">
<div class="prev-next-area">
</div></div>
      
    </div>
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="active-learning-example">
<h1>Active learning example<a class="headerlink" href="#active-learning-example" title="Link to this heading">#</a></h1>
<p>In this notebook, we will use the Hylleraas Software Platform (HSP) to explore the cis-trans isomerization of butadiene, illustrating how active learning (AL) can be used to automate the training of machine-learning potentials (MLPs). This example is chosen not for its chemical significance but to exemplify how AL can be applied in generating MLPs.</p>
<p>MLPs are useful for the dynamical study of, for example, ion-transport processes or chemical reactions. Training accurate MLPs, for the evaluation of energies and forces, requires training data. In “passive” approaches, you train on existing data, typically generated by first-principle MD calculations. In an active approach, you selectively determine which data points are needed to improve your model, with the main aim being to reduce the data requirement and enhance the accuracy.</p>
<p>The notebook relies on the installation of three programs:</p>
<ul class="simple">
<li><p>XTB</p></li>
<li><p>DeepMD</p></li>
<li><p>LAMMPS</p></li>
</ul>
<p>The simplest way to install these three programs is using Conda:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>hsp_active_learning<span class="w"> </span>deepmd-kit<span class="w"> </span>lammps<span class="w"> </span>xtb<span class="w"> </span>-c<span class="w"> </span>conda-forge
</pre></div>
</div>
<p><em>Note:</em> The Conda installation step can be time consuming, so please be patient.</p>
<section id="exploring-butadiene-and-setting-up-a-reference">
<h2>Exploring butadiene and setting up a reference<a class="headerlink" href="#exploring-butadiene-and-setting-up-a-reference" title="Link to this heading">#</a></h2>
<p>For this example we will assume XTB is our reference gold-standard QC method, and that our target MLP will be the XTB potential-energy surface (PES).</p>
<p>Note that, if you use the above Conda installation, you will need to specify  use the image <code class="docutils literal notranslate"><span class="pre">hsp_active_learning</span></code>, created above, according to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hylleraas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># This debug varaible is used throughout. For the final version simply turn off the debug </span>
<span class="c1"># option, but it might come handy when setting up and testing the code -- to more easily </span>
<span class="c1"># understand why the code fails in certain steps</span>

<span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">xtb_wrk</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/wrk_pbc/xtb&#39;</span>
<span class="n">xtb_conda</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> 
                                        <span class="n">conda_env</span><span class="o">=</span><span class="s1">&#39;hsp_al&#39;</span><span class="p">,</span> 
                                        <span class="n">work_dir</span><span class="o">=</span><span class="n">xtb_wrk</span><span class="p">,</span> 
                                        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>

<span class="c1"># XTB for geometry optimizations</span>
<span class="n">xtb_geometry_optimization</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> 
                                                    <span class="s1">&#39;geometry_optimization&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;gradient&#39;</span><span class="p">]},</span> 
                                    <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">xtb_conda</span><span class="p">)</span>

<span class="c1"># XTB for single point calaculations of the energy and gradient</span>
<span class="n">xtb_data_point</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient&#39;</span><span class="p">]},</span> 
                         <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">xtb_conda</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can start by generating butadiene from a Smiles string, using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">butadiene</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;C=C-C=C&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>the resulting coordinates will however change every time. This will mean that if we rerun the cells of this notebook, the resulting inputs and outputs will also vary. Thus we cannot use the restart options implemented in HSP. To take full advantage of this functionality we will instead use the coordinates of one such instantiation, generated by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">butadiene</span><span class="o">.</span><span class="n">xyz_string</span>
</pre></div>
</div>
<p>We also visually inspect the molecule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">xyz</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;10</span>

<span class="s1">C -1.740318000000 0.430948000000 0.064642000000</span>
<span class="s1">C -0.619681000000 -0.116079000000 0.467558000000</span>
<span class="s1">C 0.614285000000 0.118481000000 -0.245832000000</span>
<span class="s1">C 1.751101000000 -0.426794000000 0.149549000000</span>
<span class="s1">H -1.827155000000 1.074246000000 -0.797361000000</span>
<span class="s1">H -2.646902000000 0.238204000000 0.616993000000</span>
<span class="s1">H -0.608278000000 -0.746727000000 1.335847000000</span>
<span class="s1">H 0.597431000000 0.752131000000 -1.116548000000</span>
<span class="s1">H 1.799534000000 -1.067288000000 1.019770000000</span>
<span class="s1">H 2.679982000000 -0.257122000000 -0.377925000000&#39;&#39;&#39;</span>
<span class="n">butadiene</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">butadiene</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_171040091325663"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_171040091325663" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_171040091325663 = null;
var warn = document.getElementById("3dmolwarning_171040091325663");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_171040091325663 = $3Dmol.createViewer(document.getElementById("3dmolviewer_171040091325663"),{backgroundColor:"white"});
viewer_171040091325663.zoomTo();
	viewer_171040091325663.clear();
	viewer_171040091325663.addModel("10\n\nC -1.740318000000 0.430948000000 0.064642000000\nC -0.619681000000 -0.116079000000 0.467558000000\nC 0.614285000000 0.118481000000 -0.245832000000\nC 1.751101000000 -0.426794000000 0.149549000000\nH -1.827155000000 1.074246000000 -0.797361000000\nH -2.646902000000 0.238204000000 0.616993000000\nH -0.608278000000 -0.746727000000 1.335847000000\nH 0.597431000000 0.752131000000 -1.116548000000\nH 1.799534000000 -1.067288000000 1.019770000000\nH 2.679982000000 -0.257122000000 -0.377925000000\n","xyz");
		viewer_171040091325663.getModel().setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_171040091325663.setBackgroundColor("white");
	viewer_171040091325663.zoomTo();
viewer_171040091325663.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality
                
                viewer_171040091325663.render();
            });
            </script></div></div>
</div>
<p>Next we run an XTB geometry optimization to relax this <em>trans</em>-butadiene structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">xtb_geometry_optimization</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">butadiene</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>and print the energy (Hartree), and verify by inspection that the gradient elements are close to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy of trans-butadiene (Hartree):&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--- Gradient&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy of trans-butadiene (Hartree): -11.552701660534
--- Gradient [ 1.97977899e-04 -2.47811131e-04  2.81133712e-04 -2.64804664e-04
  3.84062974e-04 -4.46732825e-04  2.28796588e-04 -2.76201017e-04
  3.08977363e-04 -1.52539376e-04  1.23436479e-04 -1.23720967e-04
  3.79165160e-05  4.10387920e-05 -6.90445460e-05  4.85246350e-05
 -1.10100350e-05 -6.06061000e-07 -9.73679000e-07 -6.01078770e-05
  8.31942500e-05 -5.85582510e-05  6.79584710e-05 -7.52087110e-05
 -2.49403190e-05 -3.10079950e-05  5.11738860e-05 -1.13993500e-05
  9.64133800e-06 -9.16610100e-06]
</pre></div>
</div>
</div>
</div>
<p>We finally update the coordinates of our butadiene molecule with the converged xTB geometry, and inspect the converged geometry</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">butadiene</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;final_geometry&#39;</span><span class="p">]</span>
<span class="n">trans_butadiene</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">butadiene</span><span class="p">)</span> <span class="c1"># We store this trans-conformer explicitly by a deepcopy</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">butadiene</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_1710400913285442"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_1710400913285442" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_1710400913285442 = null;
var warn = document.getElementById("3dmolwarning_1710400913285442");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1710400913285442 = $3Dmol.createViewer(document.getElementById("3dmolviewer_1710400913285442"),{backgroundColor:"white"});
viewer_1710400913285442.zoomTo();
	viewer_1710400913285442.clear();
	viewer_1710400913285442.addModel("10\n\nC -1.778644884845 0.434588245813 0.071701355839\nC -0.627381510499 -0.105333822129 0.455130604642\nC 0.627766252062 0.105824345782 -0.232589711182\nC 1.778531867572 -0.434736583526 0.151875933290\nH -1.840180823366 1.074623479145 -0.793766170924\nH -2.697994735283 0.259640055965 0.603459228170\nH -0.589213029902 -0.745254873306 1.327798775868\nH 0.589581742563 0.745723479321 -1.105219963228\nH 1.839030140411 -1.074621445173 1.017462104190\nH 2.698503981287 -0.260452881892 -0.379159156665\n","xyz");
		viewer_1710400913285442.getModel().setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_1710400913285442.setBackgroundColor("#17d9ff");
	viewer_1710400913285442.zoomTo();
viewer_1710400913285442.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality
                
                viewer_1710400913285442.render();
            });
            </script></div></div>
</div>
<p>If you would like to see everything that is stored in the restult dictionary you can uncomment the next two lines</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#import pprint</span>
<span class="c1">#pprint.pprint(result)</span>
</pre></div>
</div>
</div>
</div>
<p>To investigate the isomerization we perform a constrained optimization for a range of dihedral  angles between 0 and 180 degrees in order to get the potential-energy profile of the dihedral rotation, starting from the <em>trans</em> (at 180 degrees) and ending up at the <em>cis</em> geometry</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_structures</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">input_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;$constrain</span>
<span class="s1">force constant=0.5</span>
<span class="s1">dihedral: 1, 2, 3, 4, 180</span>
<span class="s1">$scan</span>
<span class="s1">   1: 180, 0, </span><span class="si">{</span><span class="n">number_of_structures</span><span class="si">}</span>
<span class="s1">$opt</span>
<span class="s1">   maxcycle=20</span>
<span class="s1">$end&#39;&#39;&#39;</span>

<span class="n">scan</span> <span class="o">=</span> <span class="n">xtb_geometry_optimization</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">butadiene</span><span class="p">,</span> <span class="n">program_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">},</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;scan&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>First, let’s visually make sure our scan actually makes sense.</p>
<blockquote>
<div><p>Tilmann, for the scan the units are in Angstrom, whereas for the geometry optimization they are in Bohr. Can you verify, and easily fix this?</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scan_structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">({</span><span class="s1">&#39;atoms&#39;</span><span class="p">:</span><span class="n">butadiene</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]},</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_structures</span><span class="p">)]</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">view_trajectory</span><span class="p">(</span><span class="n">scan_structures</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_171040091332195"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_171040091332195" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_171040091332195 = null;
var warn = document.getElementById("3dmolwarning_171040091332195");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_171040091332195 = $3Dmol.createViewer(document.getElementById("3dmolviewer_171040091332195"),{backgroundColor:"white"});
viewer_171040091332195.zoomTo();
	viewer_171040091332195.clear();
	viewer_171040091332195.addModelsAsFrames("10\n\nC -1.778644884845 0.434588245813 0.071701355839\nC -0.627381510499 -0.105333822129 0.455130604642\nC 0.627766252062 0.105824345782 -0.232589711182\nC 1.778531867572 -0.434736583526 0.151875933290\nH -1.840180823366 1.074623479145 -0.793766170924\nH -2.697994735283 0.259640055965 0.603459228170\nH -0.589213029902 -0.745254873306 1.327798775868\nH 0.589581742563 0.745723479321 -1.105219963228\nH 1.839030140411 -1.074621445173 1.017462104190\nH 2.698503981287 -0.260452881892 -0.379159156665\n10\n\nC -1.777236546203 0.440127911986 0.075574261987\nC -0.629314744399 -0.114170698556 0.449650511988\nC 0.625587525190 0.097478486050 -0.238622037587\nC 1.779721043670 -0.429121258190 0.155767889030\nH -1.837022601236 1.086284021290 -0.785287424017\nH -2.696223224563 0.268777462590 0.609258475992\nH -0.593405251239 -0.763132793790 1.315512665229\nH 0.585528197440 0.728059502925 -1.117764318634\nH 1.842057417996 -1.062753695016 1.025707975664\nH 2.700307183343 -0.251548939289 -0.373104999651\n10\n\nC -1.776159801877 0.443622811161 0.078265221665\nC -0.631507526927 -0.123401844690 0.443075675393\nC 0.623494191206 0.088229366591 -0.245204414619\nC 1.780319998004 -0.425368951985 0.158280232623\nH -1.833314620586 1.099374934799 -0.775433943245\nH -2.695128077811 0.272966853139 0.612226392652\nH -0.596372077161 -0.775009485562 1.306840384020\nH 0.582911194705 0.715926663874 -1.126263327681\nH 1.844727971980 -1.049157899583 1.035102577367\nH 2.701027748467 -0.247182447743 -0.370195798176\n10\n\nC -1.774483529607 0.449077171106 0.082453158465\nC -0.633514598811 -0.131723868152 0.436882577990\nC 0.621662430973 0.079751209609 -0.251150187988\nC 1.781226860354 -0.419494368945 0.162283153071\nH -1.830040094361 1.110981540069 -0.766655381011\nH -2.692433613907 0.282429061891 0.619380605728\nH -0.601085917969 -0.793582950281 1.293089606803\nH 0.579045312510 0.696911398407 -1.139687004250\nH 1.846889664671 -1.037041442468 1.043481337598\nH 2.702732486146 -0.237307751235 -0.363384866406\n10\n\nC -1.773302870871 0.451803006125 0.084794520195\nC -0.635874444400 -0.141412210468 0.429797975771\nC 0.619574573205 0.069950264231 -0.258158324354\nC 1.781402523711 -0.416269283335 0.164245409669\nH -1.825710556609 1.124411315185 -0.756040504519\nH -2.690863133549 0.287181594775 0.623062006555\nH -0.604295656167 -0.805567207356 1.284101118256\nH 0.576690139979 0.684505860839 -1.148336893681\nH 1.848969160053 -1.022407470995 1.053165854461\nH 2.703409264647 -0.232195868999 -0.359938162355\n10\n\nC -1.771428542464 0.456564764105 0.088708829084\nC -0.638016319569 -0.149995671321 0.423397748901\nC 0.617672691127 0.060795001971 -0.264531543536\nC 1.781751728374 -0.411432100327 0.167285057487\nH -1.821457647361 1.136843563317 -0.746087347504\nH -2.688347577490 0.294531883836 0.628817471249\nH -0.608914462012 -0.822187459568 1.271528093333\nH 0.573530931663 0.667217197535 -1.160245561717\nH 1.850767419736 -1.008487012995 1.062245108562\nH 2.704440777994 -0.223850166552 -0.354424855858\n10\n\nC -1.769260143612 0.461944298707 0.093152351088\nC -0.640104459397 -0.158100781828 0.417245061506\nC 0.615848175450 0.051679211095 -0.270695398646\nC 1.782047399103 -0.406425381653 0.170402468916\nH -1.817583866350 1.147284269086 -0.737605387587\nH -2.685342480034 0.303127047291 0.635618564449\nH -0.613830853850 -0.838995954214 1.258624327500\nH 0.570480976266 0.649578702152 -1.172175120657\nH 1.852121008629 -0.996360834273 1.070007907751\nH 2.705623243797 -0.213730576361 -0.347881774321\n10\n\nC -1.767618701213 0.464693970244 0.095813868823\nC -0.642498206367 -0.167355900442 0.410329888747\nC 0.614041509729 0.042537787366 -0.277160719083\nC 1.781979649289 -0.402086012026 0.172846089776\nH -1.812458366152 1.160057517342 -0.726717592967\nH -2.683555948931 0.307030841283 0.638883921908\nH -0.617305692905 -0.850697897649 1.249614361612\nH 0.568481673731 0.637043951167 -1.180731718960\nH 1.853218354620 -0.981661271787 1.079039039858\nH 2.705714728198 -0.209562985499 -0.345224139714\n10\n\nC -1.764919379914 0.470351822995 0.100708950338\nC -0.644667688543 -0.175540427787 0.404088852352\nC 0.612123348927 0.032603002245 -0.283677807993\nC 1.781843978173 -0.397600639235 0.175430150103\nH -1.807569983244 1.171518736444 -0.717069893208\nH -2.679970324996 0.316029910000 0.646172402827\nH -0.623202942449 -0.869265986342 1.235143244460\nH 0.565392433413 0.617373813439 -1.193716957731\nH 1.854357343157 -0.967484067437 1.087721715078\nH 2.706612215478 -0.197986164321 -0.338107656226\n10\n\nC -1.763507826048 0.471740077513 0.102524684293\nC -0.647208250790 -0.184896270648 0.396782355134\nC 0.610770301469 0.025264372761 -0.289084058112\nC 1.781856990824 -0.390668963027 0.179383707260\nH -1.802121305454 1.184021866873 -0.705793370246\nH -2.677793835522 0.320190554382 0.650129150198\nH -0.626697227088 -0.880714231193 1.225916568750\nH 0.563756294443 0.604125863994 -1.202717983857\nH 1.854552938690 -0.953723454908 1.095802872879\nH 2.706390919476 -0.195339815747 -0.336250926297\n10\n\nC -1.760211668980 0.477866104701 0.108128060643\nC -0.649303851251 -0.192562370969 0.391076207121\nC 0.608908341469 0.015237746572 -0.295607380934\nC 1.781345403065 -0.386496738672 0.181447815777\nH -1.796046081967 1.196334927150 -0.694785377786\nH -2.674438148415 0.327334391247 0.656018565539\nH -0.633238716304 -0.899581238640 1.210982255289\nH 0.560942958293 0.583962566216 -1.215673999989\nH 1.855348856406 -0.937305968647 1.105273806937\nH 2.706691907685 -0.184789418957 -0.330166952596\n10\n\nC -1.758223886461 0.480260955326 0.110827227611\nC -0.651844462393 -0.201473021233 0.383960216058\nC 0.607449970850 0.006801813675 -0.301384741049\nC 1.780966107841 -0.380708642228 0.184539406508\nH -1.790732277146 1.206732414847 -0.684973937237\nH -2.671772116199 0.332324403565 0.660607290094\nH -0.636967512798 -0.910671709736 1.201840731442\nH 0.559500190810 0.571184603798 -1.224014209462\nH 1.855090923961 -0.924665308074 1.112313954346\nH 2.706532061535 -0.179785509940 -0.327022938311\n10\n\nC -1.755688044608 0.483427312422 0.114289207372\nC -0.654362597281 -0.210277168030 0.376888534713\nC 0.605950263855 -0.001796582760 -0.307213186302\nC 1.780380281434 -0.374236682063 0.187904936808\nH -1.784210331790 1.219333078624 -0.673040054526\nH -2.667956465230 0.339405835142 0.667221014990\nH -0.642850585207 -0.927211111761 1.188130172475\nH 0.557521771743 0.552161914433 -1.236228281737\nH 1.854852470030 -0.909019478633 1.120986192399\nH 2.706362237053 -0.171787117375 -0.322245536191\n10\n\nC -1.752051806959 0.489029001032 0.119875937008\nC -0.656538390674 -0.217716382305 0.371270720000\nC 0.604288170009 -0.011667007991 -0.313430375330\nC 1.779524396327 -0.370055499955 0.189710393832\nH -1.777490882138 1.230682388707 -0.662091411833\nH -2.664588942199 0.345473090181 0.672442186016\nH -0.649473185384 -0.944258784777 1.174130906001\nH 0.555416703694 0.533345955306 -1.247756163928\nH 1.854783877982 -0.892733788658 1.129640044363\nH 2.706129059342 -0.162098971539 -0.317099236129\n10\n\nC -1.749612226023 0.491478221684 0.122955101770\nC -0.659133859010 -0.226265837380 0.364286040850\nC 0.602958122616 -0.020074410403 -0.319068999076\nC 1.778721800124 -0.364068624099 0.192571074073\nH -1.771204173881 1.241160950507 -0.651401168158\nH -2.661833411206 0.349587346911 0.676515280739\nH -0.653624300553 -0.955419207673 1.164619137191\nH 0.554290188247 0.520114576750 -1.256094079172\nH 1.853862963262 -0.878883550204 1.136749712790\nH 2.705573896424 -0.157629466093 -0.314439101007\n10\n\nC -1.746701450965 0.494403795863 0.126565599831\nC -0.661763442269 -0.234897127797 0.357135001237\nC 0.601593147036 -0.028633346581 -0.324760317978\nC 1.777693955652 -0.357247668860 0.195792774039\nH -1.763687697481 1.253658888692 -0.638629642060\nH -2.657605946112 0.356282277400 0.683232078011\nH -0.660148931513 -0.971946256771 1.150321363261\nH 0.552859939815 0.500315988951 -1.268305305877\nH 1.852793445399 -0.862273270486 1.145266298614\nH 2.704965980438 -0.149663280412 -0.309924849078\n10\n\nC -1.743246489414 0.498639353619 0.131410472994\nC -0.664118261410 -0.242292934062 0.351233391275\nC 0.600278054612 -0.037585132715 -0.330357983321\nC 1.776645575504 -0.352107226411 0.197905112425\nH -1.756777102826 1.263777078757 -0.627872496369\nH -2.654724341110 0.360438222391 0.687136766996\nH -0.665748835715 -0.985286321454 1.138765579382\nH 0.551602897087 0.484735335774 -1.277507235242\nH 1.851785846554 -0.847156892255 1.152564589593\nH 2.704301656717 -0.143161483643 -0.306585197734\n10\n\nC -1.739644661567 0.502033126549 0.135686393544\nC -0.666790293685 -0.250874868879 0.344274427791\nC 0.598770506837 -0.047467949064 -0.336592284925\nC 1.775143324865 -0.346917595798 0.199931233550\nH -1.748008531692 1.276536759946 -0.614222215974\nH -2.650291648184 0.366828408967 0.693477619901\nH -0.673115879239 -1.002349130996 1.123887097250\nH 0.550320487865 0.464469047600 -1.289536339174\nH 1.850284752902 -0.828389169865 1.161630830433\nH 2.703330941897 -0.133868628459 -0.301843762397\n10\n\nC -1.736276485457 0.505705507866 0.140400389822\nC -0.669171954028 -0.257915367910 0.338117811208\nC 0.597878639217 -0.054198808113 -0.341046405914\nC 1.774077310116 -0.338044156734 0.203904518404\nH -1.740701263452 1.287368429473 -0.602034542123\nH -2.646775651741 0.371343142206 0.698617960718\nH -0.679761797247 -1.017559426899 1.109808593205\nH 0.549590483001 0.445029408116 -1.300833462679\nH 1.848658179156 -0.813075530618 1.168740039423\nH 2.702481540434 -0.128653197386 -0.298981902064\n10\n\nC -1.732735219452 0.508450180420 0.144290483874\nC -0.671984543224 -0.266407911048 0.331226956270\nC 0.596456705886 -0.064676603903 -0.347429981487\nC 1.772359305285 -0.334510929856 0.204830840665\nH -1.731790943715 1.298587708071 -0.589116935702\nH -2.643250802500 0.375792740151 0.702954133123\nH -0.685737478143 -1.030565943156 1.098243506226\nH 0.548698858111 0.429540802356 -1.309690638949\nH 1.846621263127 -0.794957558075 1.176790865436\nH 2.701361854627 -0.121252484961 -0.295406229455\n10\n\nC -1.728151439080 0.513824956123 0.150965790227\nC -0.674083842738 -0.272503779692 0.326158317114\nC 0.595499639497 -0.072285526206 -0.351937040639\nC 1.771050166841 -0.326754221748 0.207849846010\nH -1.723626330630 1.309329160683 -0.576550036532\nH -2.639948819392 0.379661737649 0.707112326738\nH -0.693933017810 -1.047323623931 1.082541121971\nH 0.547987822028 0.408411057565 -1.321209465075\nH 1.844988171969 -0.777784103999 1.184207944217\nH 2.700216649314 -0.114575656443 -0.292445804030\n10\n\nC -1.724761790149 0.515679980476 0.154280514230\nC -0.677115747058 -0.281188925242 0.318720798502\nC 0.594280990596 -0.082193588823 -0.358006870738\nC 1.769121156410 -0.321990713645 0.209292752720\nH -1.713947736595 1.320907024424 -0.562429948586\nH -2.635815568053 0.384620987038 0.712458739225\nH -0.700417443476 -1.060807221546 1.069880866135\nH 0.547523605238 0.391240539543 -1.330752303391\nH 1.842218916822 -0.758953447835 1.192108355298\nH 2.698912616264 -0.107314634389 -0.288859903395\n10\n\nC -1.720690479312 0.519239763886 0.159484388435\nC -0.679657553969 -0.288166722968 0.312568160015\nC 0.593381537693 -0.090172941641 -0.362817195495\nC 1.767430566876 -0.314591074385 0.211924566747\nH -1.704904297058 1.331833862135 -0.548721311928\nH -2.632087377795 0.388704389687 0.717211756674\nH -0.708118496924 -1.075953434449 1.055028115245\nH 0.547315283075 0.371185335102 -1.341422914004\nH 1.839706857583 -0.740966019650 1.199406043363\nH 2.697622959832 -0.101113157715 -0.285968609051\n10\n\nC -1.716714746818 0.521384199902 0.163459405842\nC -0.682652775599 -0.296644999253 0.305053191531\nC 0.592231960652 -0.099502353843 -0.368566301452\nC 1.765116437155 -0.307990540552 0.214021537700\nH -1.693636878847 1.344862183782 -0.532094069026\nH -2.626932937358 0.394225653877 0.723861138754\nH -0.716838257440 -1.092787334547 1.038525955262\nH 0.547384796429 0.348707758280 -1.353517769319\nH 1.836171092419 -0.719334944836 1.208062559144\nH 2.695870309408 -0.092919622809 -0.282112648436\n10\n\nC -1.711410575171 0.526891489124 0.171076092410\nC -0.684754420632 -0.302083603676 0.300578922950\nC 0.591480379173 -0.107558540642 -0.372832178409\nC 1.763517256397 -0.301125420129 0.216046065468\nH -1.684271187215 1.355059156321 -0.518510922706\nH -2.624187051580 0.396913354064 0.726655195813\nH -0.725974041668 -1.108771026639 1.022270807989\nH 0.547202204596 0.327511290090 -1.363752550341\nH 1.833905433894 -0.700327395779 1.215027989023\nH 2.694491002205 -0.086509302734 -0.279866422197\n10\n\nC -1.708051244290 0.527998923709 0.174247916922\nC -0.687918024876 -0.310212598452 0.293010473145\nC 0.590633050785 -0.116336387997 -0.378194015330\nC 1.761248458669 -0.294783428477 0.217783792160\nH -1.673362410104 1.366632257035 -0.502327714285\nH -2.620474686693 0.400184025255 0.730985850329\nH -0.732617221128 -1.121246414033 1.009315785729\nH 0.547547347709 0.309846220522 -1.372853392293\nH 1.830000729547 -0.679899524063 1.222364577468\nH 2.692993000380 -0.082183073500 -0.277640273845\n10\n\nC -1.703446334632 0.531608528542 0.180219512000\nC -0.690499136470 -0.316503943128 0.287154604389\nC 0.589991032047 -0.124165222666 -0.382551096605\nC 1.759241433386 -0.286996505603 0.220052086824\nH -1.663083647937 1.377355813565 -0.487033985665\nH -2.616764073910 0.403724924898 0.735456398430\nH -0.741721003134 -1.136669901763 0.992592133905\nH 0.548077833803 0.287681745745 -1.383331985501\nH 1.826703432100 -0.660002336501 1.229239945268\nH 2.691499464746 -0.076033103089 -0.275104613045\n10\n\nC -1.698775109363 0.533983062900 0.185127489590\nC -0.693444023053 -0.324164817707 0.280174866685\nC 0.589065480033 -0.133444934182 -0.387854968953\nC 1.756587843855 -0.280417217791 0.221599972081\nH -1.650289348058 1.389845738406 -0.468751694508\nH -2.612046394639 0.407871541346 0.740835063777\nH -0.751583004352 -1.153079782094 0.975014139749\nH 0.548874910572 0.264242977356 -1.394588964623\nH 1.822180799797 -0.636160077209 1.237252284412\nH 2.689427845208 -0.068676491025 -0.272115188209\n10\n\nC -1.693515898920 0.538744672393 0.193082718779\nC -0.695574876357 -0.328862545566 0.275711610600\nC 0.588745040714 -0.139613535656 -0.391135407773\nC 1.754750189003 -0.270620717996 0.224264318565\nH -1.640034694458 1.400383752432 -0.452558171031\nH -2.609771344578 0.409359357538 0.743129972727\nH -0.761715769540 -1.168915580920 0.956551044990\nH 0.549807832638 0.240162396325 -1.404963402408\nH 1.819118497573 -0.615369073052 1.243653705546\nH 2.688190023925 -0.065268725499 -0.271043389996\n10\n\nC -1.689397028431 0.540252997244 0.197241943276\nC -0.698794512120 -0.336341094438 0.268521348688\nC 0.588082393001 -0.149147870559 -0.396258127496\nC 1.752210609325 -0.265168497773 0.225134958253\nH -1.627162125103 1.411933977935 -0.434036601682\nH -2.606015607106 0.412469154821 0.747124401073\nH -0.770312205431 -1.182454942339 0.940941838191\nH 0.550649656716 0.219680640404 -1.413965577616\nH 1.814317626409 -0.591525476413 1.250735178085\nH 2.686420192740 -0.059698888882 -0.268746360772\n10\n\nC -1.684744251705 0.542995424400 0.203143274406\nC -0.701460137147 -0.342298739441 0.262360485593\nC 0.587635212736 -0.156040910455 -0.400159622957\nC 1.749679729326 -0.255691291418 0.227437439298\nH -1.615301865911 1.422916671977 -0.415849458347\nH -2.602298314730 0.415121443374 0.751423839544\nH -0.780392536447 -1.197570626950 0.922450385244\nH 0.552323133540 0.195137990125 -1.424336210170\nH 1.809777094402 -0.569124191206 1.257136101902\nH 2.684780935936 -0.055445770406 -0.266913234514\n10\n\nC -1.679821792881 0.545621661793 0.209178039107\nC -0.704361343155 -0.348607667927 0.256224311868\nC 0.587185896939 -0.164857044638 -0.404541708663\nC 1.747222788983 -0.249102201319 0.228410918078\nH -1.601586169746 1.434745025374 -0.395407154031\nH -2.599218032149 0.417337061187 0.754327312293\nH -0.790978756985 -1.212742658973 0.903519163338\nH 0.553574773865 0.170879314202 -1.433833260405\nH 1.804910251126 -0.542842257223 1.264022794161\nH 2.683071384005 -0.050431232478 -0.265207415746\n10\n\nC -1.674574752057 0.548908748498 0.216302003706\nC -0.706959815169 -0.353957367785 0.250804542553\nC 0.586910367455 -0.172339461106 -0.408187001528\nC 1.744828754573 -0.240714793269 0.229928238207\nH -1.588625692251 1.445776203859 -0.375604232518\nH -2.596214344702 0.419454112112 0.757398761780\nH -0.802458179404 -1.228372749078 0.883022356933\nH 0.555332718827 0.144723800183 -1.443529232875\nH 1.800274282608 -0.517692008528 1.270256256030\nH 2.681485660120 -0.045786484885 -0.263698692289\n10\n\nC -1.669114625403 0.551065072700 0.222180472418\nC -0.709982635075 -0.360800560523 0.244034767496\nC 0.586314596868 -0.181667081330 -0.412832928560\nC 1.741677971608 -0.233839887851 0.230833845820\nH -1.572826457177 1.457910892289 -0.352988887082\nH -2.591483520464 0.422944115893 0.762349888429\nH -0.815143492877 -1.245109502804 0.861207200710\nH 0.557578644023 0.116727768659 -1.454016808194\nH 1.793939607334 -0.488825716579 1.277144332554\nH 2.679038911161 -0.038405100454 -0.261218883592\n10\n\nC -1.664141016651 0.554438739270 0.230146483355\nC -0.712358567499 -0.364877671460 0.239381328282\nC 0.586385883487 -0.187688722343 -0.415504239791\nC 1.739678005107 -0.224111239948 0.232333670603\nH -1.560413194409 1.468413219676 -0.331947306863\nH -2.590712404544 0.422701194187 0.762321415181\nH -0.825834787358 -1.258729347294 0.840859760511\nH 0.559373719309 0.091271540355 -1.461940954769\nH 1.789782992426 -0.463076365416 1.282326637902\nH 2.678238370132 -0.038341347026 -0.261283794411\n10\n\nC -1.659223285806 0.555757560464 0.235196999972\nC -0.715591249070 -0.371532594536 0.231865333835\nC 0.585955787832 -0.195835591419 -0.419847215788\nC 1.736127779538 -0.215011651163 0.233696639223\nH -1.543848577748 1.480572479437 -0.307043091772\nH -2.585223017431 0.426560097611 0.768908005842\nH -0.839332635794 -1.275379215694 0.816692150149\nH 0.562840791798 0.059668838838 -1.472749423008\nH 1.782433159724 -0.433199808062 1.288521863226\nH 2.675860246956 -0.031600115476 -0.258548261680\n10\n\nC -1.653840350214 0.559397046799 0.244293226420\nC -0.717765510861 -0.374970669218 0.227940400159\nC 0.586126623880 -0.202008741228 -0.422097919182\nC 1.734321817426 -0.205931547186 0.234553507994\nH -1.530959010914 1.490542053905 -0.284778994683\nH -2.585585428156 0.425443331902 0.766919979692\nH -0.850519961971 -1.288328341250 0.795355176324\nH 0.564569956293 0.033985052560 -1.479317915267\nH 1.778351043552 -0.405658928526 1.292928871013\nH 2.675299820966 -0.032469257759 -0.259103332470\n10\n\nC -1.648640745035 0.561583667710 0.251184357493\nC -0.720598768234 -0.380055709389 0.221925300426\nC 0.586048288560 -0.209630323667 -0.425349434734\nC 1.731522542106 -0.197360075204 0.235378559880\nH -1.515247309614 1.501337222641 -0.259770743654\nH -2.582420476098 0.427570919634 0.770160937546\nH -0.863990134654 -1.303303909190 0.770558197401\nH 0.567668279276 0.003260857338 -1.487577567516\nH 1.772005858223 -0.375243917702 1.297762613859\nH 2.673651465469 -0.028158732172 -0.257579220702\n10\n\nC -1.642072770449 0.564222270042 0.259254138449\nC -0.723308051495 -0.385575334474 0.216332429768\nC 0.585772137766 -0.218929163865 -0.428862086594\nC 1.728412825464 -0.190777118130 0.235651857605\nH -1.497548246600 1.511981569948 -0.233847654634\nH -2.578467532895 0.430354756169 0.773542465898\nH -0.879700668965 -1.319562089443 0.743579848291\nH 0.570965057162 -0.029032365784 -1.495774578314\nH 1.764799013823 -0.342047341406 1.302593835277\nH 2.671147236188 -0.020635183059 -0.255777255747\n10\n\nC -1.637926137930 0.566411599730 0.267155948162\nC -0.725652785241 -0.388510322883 0.211364714786\nC 0.586106129924 -0.222753897198 -0.430675169456\nC 1.726144420067 -0.177700420310 0.236808388981\nH -1.483736908024 1.522330603397 -0.206579758893\nH -2.578750835638 0.429017806826 0.772500078041\nH -0.891297053143 -1.331703210268 0.718590201494\nH 0.574217665004 -0.060255936618 -1.502054385368\nH 1.759674725590 -0.311807457117 1.305832300108\nH 2.671219779392 -0.025028765558 -0.256249317855\n10\n\nC -1.632594265684 0.568148625242 0.273980274859\nC -0.728556865387 -0.393387415930 0.205073772142\nC 0.586075327108 -0.230915722883 -0.433654077520\nC 1.723160123750 -0.169798994962 0.237098330663\nH -1.466528795798 1.532183603874 -0.178903257378\nH -2.575476500484 0.431245009285 0.775629937273\nH -0.905791397903 -1.345454293946 0.691402204681\nH 0.577987257386 -0.093096549357 -1.508528921136\nH 1.752330102989 -0.278721942449 1.309142281640\nH 2.669394014021 -0.020202318875 -0.254547545222\n10\n\nC -1.627044537053 0.570736454995 0.282979806382\nC -0.731013526574 -0.396788845901 0.200031894455\nC 0.586336211648 -0.237505654283 -0.435529184198\nC 1.720725321580 -0.159841494535 0.237512450312\nH -1.450743420553 1.541565272836 -0.150901232739\nH -2.574075900066 0.431923346889 0.776254003351\nH -0.920484965630 -1.358568282187 0.662308471047\nH 0.581624649164 -0.127284761358 -1.513699134327\nH 1.746326043503 -0.245604959876 1.311676233665\nH 2.668349123982 -0.018631076582 -0.253940307948\n10\n\nC -1.620750861511 0.572014476291 0.289817412112\nC -0.733749873513 -0.402285269477 0.193595712781\nC 0.585952651230 -0.245967189730 -0.438918546010\nC 1.716749984446 -0.151934689850 0.237640306857\nH -1.431112710410 1.550429204144 -0.121442946019\nH -2.569298325937 0.434881076042 0.780643725922\nH -0.936838303762 -1.372402859353 0.632934027171\nH 0.586580004847 -0.162449859600 -1.519835012583\nH 1.736847491057 -0.210207985423 1.314043307763\nH 2.665618943552 -0.012076903044 -0.251784987994\n10\n\nC -1.615761071922 0.574331811098 0.299677396322\nC -0.735657182091 -0.404465845079 0.189672053798\nC 0.586283174715 -0.250634044454 -0.440014887604\nC 1.714803056886 -0.140659810504 0.237531212414\nH -1.416509259500 1.558569214430 -0.092027216532\nH -2.570700121910 0.433392974087 0.777078166850\nH -0.949663068442 -1.382616266100 0.604798119897\nH 0.589747892017 -0.194824195620 -1.522484964951\nH 1.731700446986 -0.176835067654 1.314701225203\nH 2.665755133261 -0.016258770203 -0.252238105396\n10\n\nC -1.609872814260 0.575381175925 0.305992457975\nC -0.738561703961 -0.409370376972 0.182554016273\nC 0.586068732766 -0.258573317400 -0.442973108258\nC 1.710643659887 -0.131440666506 0.237729354132\nH -1.397149204001 1.566283089876 -0.061785245346\nH -2.565213002375 0.436860762311 0.783118358633\nH -0.966438834957 -1.394985623526 0.573032456911\nH 0.595633131163 -0.232922498474 -1.527039720890\nH 1.721841239220 -0.142026664845 1.315703575428\nH 2.663047796518 -0.009205880389 -0.249639144858\n10\n\nC -1.604749890417 0.577363717147 0.316123225139\nC -0.740309131129 -0.411432218781 0.178799102393\nC 0.586319323836 -0.263492635376 -0.443861057885\nC 1.708699989103 -0.120895201969 0.237146293136\nH -1.382517770792 1.572899706324 -0.032214393598\nH -2.566742723649 0.435614511043 0.778990989621\nH -0.979156908600 -1.403602931305 0.544549172238\nH 0.598813150840 -0.264727515130 -1.527898590391\nH 1.716456564936 -0.108526087554 1.314901141753\nH 2.663186395872 -0.013201344399 -0.249842882405\n10\n\nC -1.599194367459 0.578661761270 0.323930617714\nC -0.742669430289 -0.414903888613 0.173084674387\nC 0.586326869669 -0.270350353261 -0.445625276243\nC 1.705527463873 -0.111746224314 0.236880056416\nH -1.365690803604 1.578647875815 -0.003446416583\nH -2.563903986531 0.437595711246 0.781329332065\nH -0.994148913649 -1.412880155284 0.513979310211\nH 0.603729962770 -0.299626053749 -1.529274847117\nH 1.708432353496 -0.075669523660 1.314053315334\nH 2.661589851724 -0.009729149450 -0.248217766185\n10\n\nC -1.592324861882 0.579728717861 0.331841680849\nC -0.745157576262 -0.419460806919 0.167049825679\nC 0.586108233117 -0.279095034562 -0.447802538853\nC 1.701573982051 -0.104590649914 0.236635303258\nH -1.345916181601 1.583818655787 0.026623358542\nH -2.559325078679 0.440656720467 0.784945788924\nH -1.011317004843 -1.422786206300 0.481403904742\nH 0.609303732933 -0.335889184856 -1.530568776546\nH 1.698331209432 -0.039805333113 1.312780230849\nH 2.658722545734 -0.002576878451 -0.246215777445\n10\n\nC -1.587633120684 0.580851218248 0.341252308490\nC -0.746731203419 -0.421241831811 0.162790497201\nC 0.586126259114 -0.282697381922 -0.448831547707\nC 1.698988491878 -0.091909598403 0.235489149797\nH -1.331902540476 1.588310755595 0.056180775702\nH -2.560284096497 0.439808043265 0.781693095056\nH -1.023037861505 -1.428794619993 0.453192782428\nH 0.613351056656 -0.368072682364 -1.529500113302\nH 1.692176075036 -0.008476560833 1.310023832075\nH 2.658945939897 -0.007777341781 -0.245597779741\n10\n\nC -1.581963438526 0.581508984334 0.348172810957\nC -0.749141834360 -0.424884185530 0.156507412399\nC 0.586006207761 -0.290260412521 -0.450550265480\nC 1.695375475480 -0.083941836257 0.234936066342\nH -1.314690873203 1.591688052184 0.084107939179\nH -2.556591621985 0.442370943888 0.784784705241\nH -1.037558676371 -1.435476314734 0.423688898750\nH 0.618745109538 -0.401131870714 -1.528751380547\nH 1.682974399243 0.023092580157 1.307319932550\nH 2.656844252424 -0.002965940808 -0.243523119393\n10\n\nC -1.575489733247 0.582079804485 0.355579746140\nC -0.751437281304 -0.428861423220 0.150495856534\nC 0.585782113883 -0.298284806322 -0.452276785572\nC 1.691374862377 -0.076598727044 0.234459913983\nH -1.296670314564 1.594214607421 0.111409687191\nH -2.552267177489 0.445238331318 0.788059958361\nH -1.052762426910 -1.441941709194 0.393906886024\nH 0.624351858685 -0.433729483504 -1.527660172558\nH 1.672936321868 0.054857701749 1.304169170906\nH 2.654180776699 0.003025704309 -0.241451261007\n10\n\nC -1.569989063790 0.582517785743 0.364529066621\nC -0.753056086685 -0.431395665027 0.145737663423\nC 0.585534650540 -0.303225196617 -0.453628040691\nC 1.687995405344 -0.065518909734 0.232913878473\nH -1.281556912023 1.596239003415 0.139360224779\nH -2.551513798822 0.445793573234 0.786283048111\nH -1.064805326181 -1.446299280373 0.366753567678\nH 0.629008873508 -0.463986621961 -1.525200493499\nH 1.665023808944 0.084863858799 1.299879365242\nH 2.653357449167 0.001011452522 -0.239935280137\n10\n\nC -1.563340285848 0.582630875266 0.370683557332\nC -0.755558165848 -0.435603024699 0.138644353182\nC 0.585142162462 -0.311242069718 -0.455837330226\nC 1.682945727512 -0.057239553812 0.232259537541\nH -1.261859131395 1.597593868960 0.168241720633\nH -2.545471195052 0.449303952816 0.791911340496\nH -1.080782501888 -1.451643825488 0.335358694499\nH 0.636033977864 -0.499314587247 -1.523034327665\nH 1.652892976113 0.117111255195 1.295584094736\nH 2.649995436080 0.008403108728 -0.237118640528\n10\n\nC -1.556729940663 0.583031064689 0.381527007790\nC -0.756761698372 -0.438077404966 0.135068683142\nC 0.584845307848 -0.316223383666 -0.456779192601\nC 1.679462369348 -0.046575896675 0.230556030914\nH -1.247750165855 1.597924857280 0.192020741007\nH -2.544180630209 0.450521264702 0.790626640749\nH -1.093405902880 -1.454791362612 0.307692539409\nH 0.640689622253 -0.528429618698 -1.519125443817\nH 1.645092873658 0.143798829815 1.290776787728\nH 2.648737164871 0.008821650131 -0.235670794321\n10\n\nC -1.551966450031 0.582699477936 0.386017182445\nC -0.759260814629 -0.441489650342 0.127863835835\nC 0.584652302790 -0.324029086829 -0.458273508915\nC 1.675655659144 -0.040265070851 0.229609279747\nH -1.231576331706 1.597852264210 0.217412153998\nH -2.540595512019 0.453047397568 0.793159202074\nH -1.104764152385 -1.457482334918 0.284893457241\nH 0.646026975266 -0.553923119488 -1.516410075306\nH 1.635099483337 0.171314802845 1.285624392057\nH 2.646727840233 0.012275319868 -0.233202919176\n10\n\nC -1.545379733990 0.582689199660 0.394543181029\nC -0.760930295938 -0.444522306352 0.122903556762\nC 0.584318263669 -0.330225755263 -0.459532838868\nC 1.671440675392 -0.031206957910 0.228252250223\nH -1.216696960806 1.597168124496 0.239097705762\nH -2.536839411024 0.455544980169 0.795528368578\nH -1.117608236741 -1.459826634732 0.258636383341\nH 0.651632138292 -0.581982395153 -1.512402320488\nH 1.625678684847 0.195713404320 1.280779383735\nH 2.644383876300 0.016648340763 -0.231112670074\n10\n\nC -1.539369315519 0.582086729505 0.401078775467\nC -0.762978935729 -0.447996989977 0.116650976559\nC 0.583900642913 -0.337301441750 -0.461173372115\nC 1.666932107141 -0.023241140905 0.226687241797\nH -1.199720500257 1.595726639440 0.264914665228\nH -2.533453067197 0.457909220323 0.796436598881\nH -1.129492637989 -1.461831888476 0.234944978846\nH 0.657306073024 -0.607948417042 -1.508798686989\nH 1.614736388900 0.223758649932 1.274384606706\nH 2.642138244714 0.018838638951 -0.228432784380\n10\n\nC -1.532612287977 0.581640480564 0.406459666562\nC -0.765393200976 -0.451812165420 0.109330712111\nC 0.583480237316 -0.345287832452 -0.463037548905\nC 1.661404315957 -0.015567153656 0.225669286476\nH -1.180397446414 1.593864096356 0.291604211414\nH -2.526925098193 0.461437156843 0.802315601931\nH -1.144314833634 -1.463616023714 0.205842074221\nH 0.664829812808 -0.640021799420 -1.503818641886\nH 1.601542062726 0.252878802870 1.267840017179\nH 2.638385438387 0.026484438029 -0.225512379103\n10\n\nC -1.526871726318 0.580998200054 0.414754755396\nC -0.766875185947 -0.454353428439 0.104697069208\nC 0.583181090235 -0.350964310894 -0.463924975832\nC 1.657735088732 -0.007060352780 0.223642338332\nH -1.168001257440 1.591758393640 0.310109778607\nH -2.525026894478 0.463295410463 0.801702471349\nH -1.153780407546 -1.464133270361 0.186690214330\nH 0.669318103417 -0.660124237011 -1.499829000603\nH 1.593355729831 0.273208650178 1.262230872996\nH 2.636964459515 0.027374945150 -0.223380523783\n10\n\nC -1.519737604800 0.580260128730 0.420519455374\nC -0.769173242709 -0.458193361273 0.097726976204\nC 0.582770578847 -0.359217539328 -0.465482806297\nC 1.652140211713 -0.000183422305 0.222605768695\nH -1.148657422490 1.588668869530 0.335878249747\nH -2.518611722228 0.466869044457 0.806755147160\nH -1.168351272714 -1.464900530954 0.158627301840\nH 0.676731996055 -0.690129936584 -1.494149700852\nH 1.579856772800 0.301800021606 1.254767707784\nH 2.633030705527 0.035026726121 -0.220555099656\n10\n\nC -1.513256138528 0.579259274006 0.429639441739\nC -0.770454177990 -0.460702395134 0.093324710284\nC 0.582294197765 -0.364054085376 -0.466759855416\nC 1.647585592582 0.010286391725 0.219836971837\nH -1.135201203255 1.585702088225 0.355714611446\nH -2.515946061675 0.468842720633 0.806826669019\nH -1.178915349971 -1.464505858997 0.136462138355\nH 0.682226221149 -0.713751925472 -1.488562919415\nH 1.570485207929 0.322850557390 1.248255434740\nH 2.631180711994 0.036073233002 -0.218044202589\n10\n\nC -1.507885949551 0.578480441500 0.433858356300\nC -0.772812548314 -0.463718346538 0.086263490850\nC 0.582161000134 -0.372210555092 -0.467525676898\nC 1.643312361599 0.015162430371 0.218936918349\nH -1.120275109160 1.582310523047 0.375021423600\nH -2.511272602224 0.471928617534 0.810304632669\nH -1.189299872708 -1.464395950978 0.118061900746\nH 0.687994571514 -0.733408433075 -1.484464229883\nH 1.559670338685 0.344179321125 1.241748123077\nH 2.628406810025 0.041671952107 -0.215511938810\n10\n\nC -1.501680435426 0.577553652641 0.440085577132\nC -0.774760344746 -0.466424240327 0.080162814559\nC 0.581892963961 -0.378854648047 -0.468564727720\nC 1.638429954331 0.022920638959 0.217120320469\nH -1.105426097545 1.578682987100 0.394733747941\nH -2.506472399954 0.474658347384 0.813690156929\nH -1.200584053637 -1.463527173353 0.096087947006\nH 0.694335297735 -0.756935454256 -1.478629147117\nH 1.548792368684 0.365331300994 1.234974410837\nH 2.625471746598 0.046594588905 -0.212968100035\n10\n\nC -1.495328378677 0.576234131060 0.447087606434\nC -0.776511351700 -0.469221559509 0.074534898424\nC 0.581556650647 -0.385454322689 -0.469481498548\nC 1.633663962417 0.030511718870 0.215004101398\nH -1.090514118433 1.574420638739 0.415070591906\nH -2.502650635918 0.477291591649 0.814894006775\nH -1.211333493887 -1.462457194719 0.075564724791\nH 0.700286287870 -0.778405636993 -1.473026041812\nH 1.537952238730 0.387346285261 1.227305573808\nH 2.622877838952 0.049734348332 -0.210260963176\n10\n\nC -1.488589490871 0.575066885260 0.452470951622\nC -0.778750136169 -0.472263081953 0.067618178957\nC 0.581336789558 -0.393444126430 -0.470285857832\nC 1.628243928962 0.036766851793 0.213660560071\nH -1.072717561332 1.569282112036 0.438767223757\nH -2.496667385639 0.480436800672 0.819179153450\nH -1.224456772366 -1.460615064648 0.050236480623\nH 0.707665980572 -0.804752188197 -1.465593977143\nH 1.524868206446 0.413063420025 1.218321177354\nH 2.619065440839 0.056458391441 -0.207680890859\n10\n\nC -1.482387945892 0.573388162988 0.461144098121\nC -0.780021947846 -0.474345344853 0.063125923396\nC 0.580939851122 -0.398142004731 -0.471246709441\nC 1.623605732183 0.046751332026 0.210231209245\nH -1.060284424546 1.564865675999 0.456886411186\nH -2.493930129478 0.482480929266 0.819233394769\nH -1.234130008714 -1.458361065368 0.030201571507\nH 0.713368843367 -0.825786435670 -1.458773350519\nH 1.515649156898 0.431739659621 1.210886044678\nH 2.617189872907 0.057409090721 -0.204995592944\n10\n\nC -1.477361328048 0.572479671135 0.464524384235\nC -0.782437937971 -0.476568686110 0.055876547860\nC 0.581069167113 -0.406406137062 -0.471108509687\nC 1.619508130679 0.050473390998 0.209563843784\nH -1.046685289736 1.560252488125 0.473714880802\nH -2.489079705392 0.485318931212 0.823024867351\nH -1.243734400292 -1.456663813191 0.014068179662\nH 0.719268673285 -0.842543800969 -1.453866987628\nH 1.505233543629 0.450222569032 1.203759840418\nH 2.614218146734 0.063435386829 -0.202864046797\n10\n\nC -1.471711484729 0.571061040537 0.470786128951\nC -0.784229108570 -0.478370952633 0.050048141879\nC 0.580936158167 -0.412238744474 -0.471628253276\nC 1.614871168554 0.058478611238 0.206886737048\nH -1.033772281843 1.555408940287 0.491968407488\nH -2.485117886225 0.487501891667 0.825226125651\nH -1.253563247124 -1.453904330117 -0.005595675591\nH 0.725434056959 -0.863350639393 -1.446668431182\nH 1.495434948054 0.468856178823 1.196055587294\nH 2.611716676757 0.066558004065 -0.200385768261\n10\n\nC -1.465239135374 0.569343320742 0.477053434723\nC -0.786212867699 -0.480800416149 0.043975861977\nC 0.580940344977 -0.420075551094 -0.471356020404\nC 1.610157627498 0.063722012876 0.205451566185\nH -1.017917565967 1.549096286714 0.513982848754\nH -2.480368053622 0.490258534244 0.827465932515\nH -1.265626455025 -1.450350486832 -0.029115082780\nH 0.732204119877 -0.886220330269 -1.438259103940\nH 1.483740355713 0.493033423438 1.185867534665\nH 2.608320629623 0.071993206332 -0.198373971695\n10\n\nC -1.460612494824 0.567880594112 0.482693236375\nC -0.787956924015 -0.481998881375 0.038204041150\nC 0.580944031174 -0.425629647571 -0.471373669351\nC 1.606307877469 0.070918047531 0.202682358558\nH -1.007604651652 1.544458502643 0.529161504986\nH -2.477571506615 0.492114152563 0.828515289605\nH -1.273404708026 -1.447567148015 -0.043742122529\nH 0.737543140424 -0.901854355791 -1.432287154562\nH 1.475764005011 0.508117238432 1.178854313644\nH 2.606590231055 0.073561497471 -0.196014797876\n10\n\nC -1.455049864313 0.566400725592 0.487581621871\nC -0.790083815963 -0.483617757691 0.031457222390\nC 0.581047851991 -0.432892535860 -0.471030715481\nC 1.601712116419 0.076586411862 0.200864668343\nH -0.992743653523 1.537760460951 0.551537679206\nH -2.472831830131 0.494351600585 0.831593856977\nH -1.284700445907 -1.443051988354 -0.066823570639\nH 0.744561094658 -0.925097411766 -1.422775716562\nH 1.464630263871 0.531179432136 1.168289538651\nH 2.603457282898 0.078381062546 -0.194001584757\n10\n\nC -1.450557651210 0.564641957662 0.493927456860\nC -0.791670456445 -0.484506944133 0.026268675781\nC 0.581184421728 -0.438347276689 -0.470446143993\nC 1.598332228259 0.083259029769 0.198050488350\nH -0.983690329381 1.533094878896 0.565553086820\nH -2.470623570046 0.496004107873 0.831866156281\nH -1.292202718947 -1.439661744697 -0.081225985095\nH 0.749537742857 -0.939593753479 -1.416393802776\nH 1.457757608960 0.545403481918 1.161200349436\nH 2.601931724224 0.079706262881 -0.192107281665\n10\n\nC -1.445534735715 0.563067442667 0.498729125828\nC -0.793736440631 -0.485592510351 0.019647905889\nC 0.581412567273 -0.445317468964 -0.469654256030\nC 1.594190230334 0.088700717280 0.196043506247\nH -0.970067903482 1.525999958905 0.587764509973\nH -2.466545606909 0.497881985142 0.834315399800\nH -1.302834463662 -1.434349736993 -0.103681619019\nH 0.756302546999 -0.961864267585 -1.406203423300\nH 1.447632315124 0.567832633756 1.150081391447\nH 2.599180490669 0.083641246143 -0.190349540835\n10\n\nC -1.441515010998 0.561198118034 0.504910499771\nC -0.795292465038 -0.486030719140 0.014498047141\nC 0.581660287978 -0.450616381976 -0.468653135159\nC 1.591189772173 0.095036370716 0.193094154968\nH -0.961943535780 1.521133907096 0.601926756047\nH -2.464788047036 0.499244151395 0.834209648998\nH -1.309963050002 -1.430352611472 -0.117906852530\nH 0.761137773554 -0.975914048014 -1.399250219971\nH 1.441602075665 0.581880065610 1.142559481798\nH 2.597911199484 0.084421147751 -0.188695381064\n10\n\nC -1.437080329275 0.559544127830 0.509637047830\nC -0.797287785585 -0.486565907186 0.008020890951\nC 0.582012113430 -0.457287108143 -0.467387961097\nC 1.587559124305 0.100215153228 0.190917372531\nH -0.949680609443 1.513729019449 0.623924064037\nH -2.461391642152 0.500742333066 0.836094512439\nH -1.319925094132 -1.424256512943 -0.139839462383\nH 0.767613018232 -0.997297265028 -1.388375165099\nH 1.432612449781 0.603636269899 1.130942656541\nH 2.595567754839 0.087539889828 -0.187240955751\n10\n\nC -1.433585633212 0.557570697079 0.515677398482\nC -0.798794818257 -0.486533100772 0.002940359040\nC 0.582364907883 -0.462380472941 -0.465967902509\nC 1.584988984584 0.106242406269 0.187809104885\nH -0.942588909485 1.508685920587 0.638290192528\nH -2.460149877849 0.501787318172 0.835575906236\nH -1.326634397310 -1.419653766209 -0.153938641911\nH 0.772258823881 -1.010947388660 -1.380820051808\nH 1.427537914629 0.617523423687 1.122973651624\nH 2.594602005136 0.087704962787 -0.185847016566\n10\n\nC -1.429753919577 0.555834983544 0.520342933761\nC -0.800708772841 -0.486529729908 -0.003383896408\nC 0.582828711253 -0.468741852954 -0.464242538755\nC 1.581884969625 0.111168696688 0.185451339259\nH -0.931662630808 1.500953965130 0.660264327805\nH -2.457454850272 0.502920350350 0.836878020958\nH -1.335939048797 -1.412796885032 -0.175483678196\nH 0.778421661502 -1.031579275038 -1.369238705797\nH 1.419697029368 0.638782978323 1.110784282393\nH 2.592685850548 0.089986768897 -0.184679085019\n10\n\nC -1.426809424756 0.553753522982 0.526270320485\nC -0.802147549537 -0.486030298306 -0.008365502808\nC 0.583273617216 -0.473598821802 -0.462412803867\nC 1.579773772976 0.116903636171 0.182166595718\nH -0.925636296243 1.495707481776 0.674955221134\nH -2.456771456965 0.503648373440 0.835897492936\nH -1.342203810619 -1.407590107727 -0.189519356051\nH 0.782840478551 -1.044879384993 -1.361057089660\nH 1.415626634373 0.652605085211 1.102296282063\nH 2.592053035004 0.089480513248 -0.183538159950\n10\n\nC -1.423570727104 0.551931417533 0.530885585314\nC -0.803972116778 -0.485515208903 -0.014531623405\nC 0.583835251809 -0.479651112850 -0.460251836578\nC 1.577188065398 0.121588703392 0.179622165715\nH -0.915979105490 1.487598557270 0.697067523944\nH -2.454761516601 0.504452514531 0.836626100730\nH -1.350872118599 -1.399989184872 -0.210803379687\nH 0.788679133912 -1.064886618042 -1.348746773655\nH 1.408890794755 0.673522368631 1.089448492948\nH 2.590561338698 0.090948563312 -0.182623255326\n10\n\nC -1.421178182788 0.549733921210 0.536725910088\nC -0.805325934295 -0.484569511498 -0.019388152529\nC 0.584356241272 -0.484248256061 -0.458036466613\nC 1.575540519808 0.127052572637 0.176144465658\nH -0.911009409358 1.482099431860 0.712179392489\nH -2.454644108780 0.504885295197 0.835160061480\nH -1.356677796383 -1.394182415333 -0.224826971811\nH 0.792845476131 -1.077880892737 -1.339922032060\nH 1.405822264514 0.687356961932 1.080365817361\nH 2.590269929880 0.089752892792 -0.181709024064\n10\n\nC -1.418496075968 0.547818598480 0.541298043332\nC -0.807054228258 -0.483582743283 -0.025396581424\nC 0.584997583681 -0.490000646172 -0.455475097076\nC 1.573438611091 0.131511712182 0.173412319729\nH -0.902507007084 1.473529746405 0.734569813977\nH -2.453268180326 0.505418275531 0.835344321701\nH -1.364737335416 -1.385848987784 -0.245966115349\nH 0.798358045461 -1.097381245521 -1.326860125082\nH 1.400089763852 0.708070993661 1.066759619258\nH 2.589177822967 0.090464296502 -0.180993199066\n10\n\nC -1.416619566112 0.545490704665 0.547081297245\nC -0.808312109531 -0.482229997971 -0.030106349705\nC 0.585577591956 -0.494325457791 -0.452915077157\nC 1.572223300159 0.136738564591 0.169725934832\nH -0.898520663157 1.467706993445 0.750147213165\nH -2.453674190755 0.505608568717 0.833409511165\nH -1.370082094270 -1.379454313746 -0.260026504911\nH 0.802256452553 -1.110117293577 -1.317386564684\nH 1.397943430706 0.721961077890 1.057017465251\nH 2.589206848452 0.088621153777 -0.180253925202\n10\n\nC -1.414448298354 0.543475613447 0.551608992285\nC -0.809936638664 -0.480818049202 -0.035962447797\nC 0.586277059154 -0.499793243054 -0.449992638238\nC 1.570560288521 0.140982053896 0.166810079899\nH -0.891037285338 1.458553015686 0.772982052708\nH -2.452870254715 0.505939342908 0.833069969948\nH -1.377566502967 -1.370384310812 -0.281126326139\nH 0.807453420616 -1.129216348169 -1.303540936004\nH 1.393086532259 0.742630587588 1.042512015363\nH 2.588480679488 0.088631337712 -0.179667762025\n10\n\nC -1.413026278650 0.540994222150 0.557373681973\nC -0.811090187731 -0.479111992340 -0.040503986859\nC 0.586897179003 -0.503838064921 -0.447142769247\nC 1.569721110060 0.146018849195 0.162893759685\nH -0.887913691026 1.452312443658 0.789052639362\nH -2.453732884900 0.505966869021 0.830683539597\nH -1.382453335950 -1.363423904648 -0.295251610253\nH 0.811074383273 -1.141726821910 -1.293430114787\nH 1.391728274963 0.756611086748 1.032039857209\nH 2.588794430959 0.086197313048 -0.179021996681\n10\n\nC -1.411317472038 0.538873626953 0.561863507263\nC -0.812602795871 -0.477315212065 -0.046205323816\nC 0.587635978258 -0.509027531359 -0.443895423374\nC 1.568451528989 0.150065185549 0.159796857688\nH -0.881361724033 1.442488985456 0.812351837208\nH -2.453427675834 0.506156297355 0.829871986930\nH -1.389376420992 -1.353614375267 -0.316363780279\nH 0.815958673172 -1.160475234476 -1.278783599079\nH 1.387644663359 0.777256787572 1.016568580755\nH 2.588394244989 0.085591470282 -0.178511643296\n10\n\nC -1.410277361026 0.536226198698 0.567614161998\nC -0.813650868857 -0.475314485990 -0.050581378232\nC 0.588277584073 -0.512810367550 -0.440808400401\nC 1.567918012019 0.154933718913 0.155652767656\nH -0.878934018021 1.435700421486 0.828972706675\nH -2.454647918364 0.506112863032 0.827085989401\nH -1.393834199295 -1.346090713286 -0.330607990473\nH 0.819317123698 -1.172818783679 -1.268025699441\nH 1.386892901174 0.791393353360 1.005262653125\nH 2.588937744599 0.082667795015 -0.177871810309\n10\n\nC -1.408964644698 0.533995440824 0.572064555890\nC -0.815048091725 -0.473178284682 -0.056135055678\nC 0.589037841036 -0.517739279954 -0.437274739941\nC 1.566978198631 0.158799430414 0.152384965163\nH -0.873184183092 1.425089896743 0.852772480120\nH -2.454747768362 0.506236540397 0.825858373657\nH -1.400216366002 -1.335533694503 -0.351785627553\nH 0.823898975020 -1.191269098774 -1.252557424881\nH 1.383435365653 0.812054230692 0.988732479503\nH 2.588809673538 0.081544818843 -0.177367006281\n10\n\nC -1.408210136896 0.531160987649 0.577823642496\nC -0.815992685732 -0.470949412717 -0.060345452040\nC 0.589683571675 -0.521278488713 -0.434012134800\nC 1.566659025199 0.163542564124 0.148006461212\nH -0.871262593120 1.417635076199 0.869906736692\nH -2.456204358685 0.506235317375 0.822742170444\nH -1.404268430934 -1.327465179125 -0.366170858436\nH 0.827006755451 -1.203477736218 -1.241166818253\nH 1.383070886312 0.826336043845 0.976536308303\nH 2.589516966731 0.078260827582 -0.176627055619\n10\n\nC -1.407234050104 0.528816791088 0.582232981219\nC -0.817269587700 -0.468512990244 -0.065754708812\nC 0.590448647667 -0.525958964488 -0.430226042851\nC 1.565992155631 0.167242495939 0.144577750374\nH -0.866218134902 1.406128121606 0.894212443453\nH -2.456623692671 0.506359277014 0.821149032228\nH -1.410120719948 -1.316145177376 -0.387442107296\nH 0.831295071591 -1.221654820428 -1.224855419732\nH 1.380118515685 0.847015547513 0.958865269464\nH 2.589610794751 0.076709719377 -0.176066198046\n10\n\nC -1.406681314124 0.525786110991 0.587999555138\nC -0.818115375349 -0.466110789745 -0.069812283321\nC 0.591084301776 -0.529282469744 -0.426834864175\nC 1.565806171639 0.171881158837 0.139974259114\nH -0.864635113407 1.397897419109 0.911810673166\nH -2.458199644116 0.506500448812 0.817782407127\nH -1.413789774508 -1.307539460805 -0.401980336039\nH 0.834168657289 -1.233748184006 -1.212839868556\nH 1.379942743717 0.861416183536 0.945729863292\nH 2.590418347082 0.073199583016 -0.175136405747\n10\n\nC -1.405965897706 0.523326417224 0.592364118674\nC -0.819271199204 -0.463416105773 -0.075086298512\nC 0.591839413538 -0.533734034577 -0.422831633459\nC 1.565339930876 0.175433338210 0.136399909722\nH -0.860175212019 1.385386524663 0.936578247894\nH -2.458833313771 0.506700784815 0.815893765821\nH -1.419121937616 -1.295449026616 -0.423356634554\nH 0.838172305875 -1.251663357225 -1.195676707695\nH 1.377342335767 0.882079840048 0.926859326866\nH 2.590672574261 0.071335619232 -0.174451094759\n10\n\nC -1.405532695013 0.520090731258 0.598138383514\nC -0.820023861173 -0.460890715227 -0.079005141639\nC 0.592452826693 -0.536869942822 -0.419354387135\nC 1.565207828547 0.179989163890 0.131580525209\nH -0.858775707702 1.376291688317 0.954545636457\nH -2.460414992925 0.507082322489 0.812358068067\nH -1.422423512366 -1.286320710993 -0.438036270692\nH 0.840824400346 -1.263639237377 -1.183056765799\nH 1.377165044445 0.896533325708 0.912767946151\nH 2.591519669148 0.067733374758 -0.173244994133\n10\n\nC -1.404999690655 0.517514937493 0.602453797499\nC -0.821059201801 -0.457977206514 -0.084154568584\nC 0.593184880308 -0.541113187380 -0.415166782188\nC 1.564868035037 0.183412071579 0.127877845170\nH -0.854784990215 1.362687805946 0.979683902954\nH -2.461155663617 0.507431869156 0.810253073603\nH -1.427240384502 -1.273458064874 -0.459508444003\nH 0.844550335017 -1.281284992697 -1.165044301631\nH 1.374763960587 0.917106799183 0.892670908688\nH 2.591871719839 0.065679968107 -0.172372431511\n10\n\nC -1.404616244392 0.514072828680 0.608225171944\nC -0.821724966982 -0.455367516788 -0.087953649936\nC 0.593766634795 -0.544091211347 -0.411634123468\nC 1.564722018455 0.187895166220 0.122859433549\nH -0.853442324805 1.352668345849 0.997896820728\nH -2.462640751803 0.508135391518 0.806633016881\nH -1.430183170374 -1.263824009939 -0.474300694621\nH 0.846990209455 -1.293124010319 -1.151846939626\nH 1.374423418541 0.931519967053 0.877636038855\nH 2.592704177110 0.062115049073 -0.170822074306\n10\n\nC -1.404185561842 0.511382526471 0.612485202734\nC -0.822642568564 -0.452271735030 -0.092992511807\nC 0.594464667876 -0.548149665264 -0.407291579678\nC 1.564433027635 0.191206700242 0.119048750253\nH -0.849807009481 1.337913717129 1.023258014165\nH -2.463379667562 0.508702305696 0.804401899450\nH -1.434484615300 -1.250203188688 -0.495832194916\nH 0.850441891439 -1.310470529406 -1.133010302927\nH 1.372067716255 0.951884926424 0.856332898282\nH 2.593091119544 0.060004942426 -0.169707175556\n10\n\nC -1.403793097565 0.507737148037 0.618238206228\nC -0.823228203153 -0.449607354760 -0.096692531781\nC 0.595008172601 -0.550998760731 -0.403725167266\nC 1.564215876273 0.195620720220 0.113851719405\nH -0.848419243240 1.326945332337 1.041559026252\nH -2.464678518936 0.509793243753 0.800782970813\nH -1.437070482343 -1.240090405220 -0.510688105189\nH 0.852673720253 -1.322135551756 -1.119277154892\nH 1.371428709035 0.966136160910 0.840406429932\nH 2.593862067072 0.056599467211 -0.167762393500\n10\n\nC -1.403392596407 0.504936033112 0.622435007630\nC -0.824030888538 -0.446359504271 -0.101635616510\nC 0.595662980322 -0.554894967549 -0.399251049874\nC 1.563909738043 0.198835561812 0.109954174276\nH -0.845045372024 1.311030178168 1.066943946988\nH -2.465317329744 0.510629916461 0.798519934994\nH -1.440849870803 -1.225744308923 -0.532212666944\nH 0.855849312370 -1.339128930528 -1.099667420170\nH 1.368986077356 0.986134238731 0.817974760808\nH 2.594226949425 0.054561782988 -0.166368071198\n10\n\nC -1.402945363578 0.501096832354 0.628146770140\nC -0.824543203805 -0.443659823030 -0.105259530846\nC 0.596164172202 -0.557643417614 -0.395662411556\nC 1.563576668461 0.203175298802 0.104604458299\nH -0.843537091922 1.299133575698 1.085144571819\nH -2.466355135074 0.512151654803 0.794988927869\nH -1.443075413677 -1.215194348239 -0.547062856907\nH 0.857872418489 -1.350566458715 -1.085459223540\nH 1.367944684726 1.000077864453 0.801254784395\nH 2.594897264177 0.051428821489 -0.164002489672\n10\n\nC -1.402519684565 0.498190110612 0.632271999724\nC -0.825233440738 -0.440281107447 -0.110119604971\nC 0.596769243925 -0.561395536310 -0.391072427365\nC 1.563201441492 0.206303222981 0.100639228278\nH -0.840362670794 1.282106074362 1.110317360817\nH -2.466816820669 0.513285665389 0.792784427972\nH -1.446320223969 -1.200176447038 -0.568487118758\nH 0.860764299981 -1.367131749596 -1.065154216373\nH 1.365321769058 1.019523396690 0.777831000347\nH 2.595195086278 0.049576370359 -0.162317649670\n10\n\nC -1.401987738789 0.494172592012 0.637913715993\nC -0.825678644086 -0.437554549316 -0.113690807820\nC 0.597226579640 -0.564068893360 -0.387462742050\nC 1.562722943819 0.210555076149 0.095167010292\nH -0.838688672975 1.269352394210 1.128208453699\nH -2.467538553483 0.515253739702 0.789425255123\nH -1.448178634855 -1.189246824216 -0.583245509442\nH 0.862573692387 -1.378276270617 -1.050551265108\nH 1.363812573949 1.032999617709 0.760462534340\nH 2.595735454392 0.046813117727 -0.159533645027\n10\n\nC -1.401504176042 0.491165572878 0.641959676441\nC -0.826257623435 -0.434056507080 -0.118476157279\nC 0.597777949712 -0.567687987476 -0.382764951828\nC 1.562248006902 0.213599916282 0.091148406464\nH -0.835690341418 1.251320412244 1.152918735283\nH -2.467774804760 0.516682668208 0.787358366694\nH -1.450872514939 -1.173630404324 -0.604455740083\nH 0.865169187220 -1.394324053041 -1.029653046895\nH 1.360966354023 1.051698520943 0.736234648543\nH 2.595936962737 0.045231861366 -0.157576937339\n","xyz");
	viewer_171040091332195.setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_171040091332195.setBackgroundColor("#17d9ff");
	viewer_171040091332195.zoomTo();
viewer_171040091332195.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality
                	viewer_171040091332195.animate({"loop": "forward", "reps": 0, "interval": 300});

                viewer_171040091332195.render();
            });
            </script></div></div>
</div>
<p>All good! Next, we extract the energies, convert from Hartree to kcal/mol, and set the trans-butadiene energy as our reference zero-point energy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;  # For higher resolution display in Jupyter notebooks

<span class="k">def</span><span class="w"> </span><span class="nf">plot_energies</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">,</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rescales energies from hartree to kcal/mol and plots them against automatically generated dihedral angles.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - energies_hartree: List of energies in hartree to be rescaled and plotted.</span>
<span class="sd">    - add_to_plot: Flag to indicate if the plot should be added to an existing figure.</span>
<span class="sd">    - label: Label for the plot data.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - plt: The matplotlib.pyplot object for further customization and plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hartree_to_kcalmol</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Constants</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">(</span><span class="s2">&quot;hartree&quot;</span><span class="p">,</span> <span class="s2">&quot;kcal / mol&quot;</span><span class="p">)</span>
    
    <span class="c1"># Determine the number of structures and generate dihedral angles</span>
    <span class="n">number_of_structures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">)</span>
    <span class="n">dihedral_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">number_of_structures</span><span class="p">)</span>

    <span class="c1"># Rescale energies</span>
    <span class="n">energies_kcalmol</span> <span class="o">=</span> <span class="p">[(</span><span class="n">energy</span> <span class="o">-</span> <span class="n">reference_energy</span><span class="p">)</span> <span class="o">*</span> <span class="n">hartree_to_kcalmol</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">energies_hartree</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">add_to_plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
        <span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;  # For higher resolution display in Jupyter notebooks
    
    <span class="c1"># Plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dihedral_angles</span><span class="p">,</span> <span class="n">energies_kcalmol</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Customization</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">180</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XTB Isomerization Energy Profile&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kcal/mol)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Dihedral Angle (degrees)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">energies_kcalmol</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">energies_kcalmol</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span> 
    
    <span class="k">return</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
</div>
<p>Next we plot the energy profile</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energies_hartree</span> <span class="o">=</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">][</span><span class="s1">&#39;energies&#39;</span><span class="p">]</span>
<span class="n">reference_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">,</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;reference.png&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/d38cc7562d0c7978f6139d7504cfe7a3cdd4d12c29d1ab57a120322563ecfc5e.png"><img alt="../../_images/d38cc7562d0c7978f6139d7504cfe7a3cdd4d12c29d1ab57a120322563ecfc5e.png" src="../../_images/d38cc7562d0c7978f6139d7504cfe7a3cdd4d12c29d1ab57a120322563ecfc5e.png" style="width: 842px; height: 664px;" />
</a>
</div>
</div>
<p>As we can see from the plot, the minimal for the <em>cis</em>-butadiene is not at 0 degrees dehedral angle (this is indeed a saddle point), but rather somewhere around 20 degrees. We find the <em>cis</em>-butadiene structure by relaxing a guess structure with a dihedral angle of about 20 degrees, accoding to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cis_dihedral</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">cis_guess</span> <span class="o">=</span> <span class="n">number_of_structures</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_of_structures</span> <span class="o">*</span> <span class="n">cis_dihedral</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

<span class="n">cis_butadiene</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">scan_structures</span><span class="p">[</span><span class="n">cis_guess</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="o">.</span><span class="n">xyz_string</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The index of the cis-butadiene guess: </span><span class="si">{</span><span class="n">cis_guess</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The dihedral angle of the cis-butadiene guess: </span><span class="si">{</span><span class="n">cis_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">xtb_geometry_optimization</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;cis&#39;</span><span class="p">})</span>

<span class="n">cis_butadiene</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;final_geometry&#39;</span><span class="p">]</span>
<span class="n">cis_energy</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>

<span class="n">hartree_to_kcalmol</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Constants</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">(</span><span class="s2">&quot;hartree&quot;</span><span class="p">,</span> <span class="s2">&quot;kcal / mol&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The cis-trans isomerization energy of butadiene: </span><span class="si">{</span><span class="p">(</span><span class="n">cis_energy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">reference_energy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hartree_to_kcalmol</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> kcal/mol&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The dihedral angle is: </span><span class="si">{</span><span class="n">cis_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>

<span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">);</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">xtb_data_point</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10

C -1.405965897706 0.523326417224 0.592364118674
C -0.819271199204 -0.463416105773 -0.075086298512
C 0.591839413538 -0.533734034577 -0.422831633459
C 1.565339930876 0.175433338210 0.136399909722
H -0.860175212019 1.385386524663 0.936578247894
H -2.458833313771 0.506700784815 0.815893765821
H -1.419121937616 -1.295449026616 -0.423356634554
H 0.838172305875 -1.251663357225 -1.195676707695
H 1.377342335767 0.882079840048 0.926859326866
H 2.590672574261 0.071335619232 -0.174451094759

The index of the cis-butadiene guess: 90
The dihedral angle of the cis-butadiene guess: 18.0 degrees
The cis-trans isomerization energy of butadiene: 2.13 kcal/mol
The dihedral angle is: 18.0 degrees
</pre></div>
</div>
<div class="output text_html"><div id="3dmolviewer_1710400914554402"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_1710400914554402" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_1710400914554402 = null;
var warn = document.getElementById("3dmolwarning_1710400914554402");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1710400914554402 = $3Dmol.createViewer(document.getElementById("3dmolviewer_1710400914554402"),{backgroundColor:"white"});
viewer_1710400914554402.zoomTo();
	viewer_1710400914554402.clear();
	viewer_1710400914554402.addModel("10\n\nC -1.405965897706 0.523326417224 0.592364118674\nC -0.819271199204 -0.463416105773 -0.075086298512\nC 0.591839413538 -0.533734034577 -0.422831633459\nC 1.565339930876 0.175433338210 0.136399909722\nH -0.860175212019 1.385386524663 0.936578247894\nH -2.458833313771 0.506700784815 0.815893765821\nH -1.419121937616 -1.295449026616 -0.423356634554\nH 0.838172305875 -1.251663357225 -1.195676707695\nH 1.377342335767 0.882079840048 0.926859326866\nH 2.590672574261 0.071335619232 -0.174451094759\n","xyz");
		viewer_1710400914554402.getModel().setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_1710400914554402.setBackgroundColor("white");
	viewer_1710400914554402.zoomTo();
viewer_1710400914554402.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality
                
                viewer_1710400914554402.render();
            });
            </script></div></div>
</div>
<p>Next we will locate the TS, by starting from the structure closest to the maximum energy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_energy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">)</span>
<span class="n">index_max</span> <span class="o">=</span> <span class="n">energies_hartree</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_energy</span><span class="p">)</span>

<span class="n">dihedrals</span> <span class="o">=</span> <span class="p">[</span><span class="n">structure</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">scan_structures</span><span class="p">]</span>
<span class="n">TS_butadiene</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">scan_structures</span><span class="p">[</span><span class="n">index_max</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The dihedral angle of the TS guess is: </span><span class="si">{</span><span class="n">TS_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">xtb_geometry_optimization</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">TS_butadiene</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;optimization_target&#39;</span><span class="p">:</span> <span class="s1">&#39;transition_state&#39;</span><span class="p">},</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;TS&#39;</span><span class="p">})</span>

<span class="n">TS_energy</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
<span class="n">TS_gradient</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span>
<span class="n">TS_butadiene</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;final_geometry&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The energy barrier of butadiene: </span><span class="si">{</span><span class="p">(</span><span class="n">TS_energy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">reference_energy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hartree_to_kcalmol</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> kcal/mol&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The dihedral angle of the TS is: </span><span class="si">{</span><span class="n">TS_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>

<span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">TS_butadiene</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The dihedral angle of the TS guess is: 95.3 degrees
The energy barrier of butadiene: 5.44 kcal/mol
The dihedral angle of the TS is: 95.2 degrees
</pre></div>
</div>
<div class="output text_html"><div id="3dmolviewer_17104009145939999"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_17104009145939999" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_17104009145939999 = null;
var warn = document.getElementById("3dmolwarning_17104009145939999");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_17104009145939999 = $3Dmol.createViewer(document.getElementById("3dmolviewer_17104009145939999"),{backgroundColor:"white"});
viewer_17104009145939999.zoomTo();
	viewer_17104009145939999.clear();
	viewer_17104009145939999.addModel("10\n\nC -1.593017995833 0.580044238441 0.333058001300\nC -0.745255225679 -0.418364647831 0.166755102052\nC 0.586401281218 -0.277813745528 -0.447237912953\nC 1.702044875515 -0.101067485326 0.236342322415\nH -1.347244968522 1.584445659797 0.029015857617\nH -2.561283368254 0.439225837335 0.782935142492\nH -1.010524907343 -1.422045741430 0.479814780015\nH 0.609226513404 -0.338306268561 -1.529630675829\nH 1.699702417804 -0.039066603330 1.312368151503\nH 2.659950377690 -0.007051243566 -0.246727768613\n","xyz");
		viewer_17104009145939999.getModel().setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_17104009145939999.setBackgroundColor("white");
	viewer_17104009145939999.zoomTo();
viewer_17104009145939999.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality
                
                viewer_17104009145939999.render();
            });
            </script></div></div>
</div>
<p>For the sake of it, lets us also include the second TS</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TS2_butadiene</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">scan_structures</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">TS_butadiene</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_1710400914604234"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_1710400914604234" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_1710400914604234 = null;
var warn = document.getElementById("3dmolwarning_1710400914604234");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1710400914604234 = $3Dmol.createViewer(document.getElementById("3dmolviewer_1710400914604234"),{backgroundColor:"white"});
viewer_1710400914604234.zoomTo();
	viewer_1710400914604234.clear();
	viewer_1710400914604234.addModel("10\n\nC -1.593017995833 0.580044238441 0.333058001300\nC -0.745255225679 -0.418364647831 0.166755102052\nC 0.586401281218 -0.277813745528 -0.447237912953\nC 1.702044875515 -0.101067485326 0.236342322415\nH -1.347244968522 1.584445659797 0.029015857617\nH -2.561283368254 0.439225837335 0.782935142492\nH -1.010524907343 -1.422045741430 0.479814780015\nH 0.609226513404 -0.338306268561 -1.529630675829\nH 1.699702417804 -0.039066603330 1.312368151503\nH 2.659950377690 -0.007051243566 -0.246727768613\n","xyz");
		viewer_1710400914604234.getModel().setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_1710400914604234.setBackgroundColor("#17d9ff");
	viewer_1710400914604234.zoomTo();
viewer_1710400914604234.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality
                
                viewer_1710400914604234.render();
            });
            </script></div></div>
</div>
<p>With the <em>trans</em>, TS and <em>cis</em> structures determined, we can also set up an energy diagram for the isomerization.</p>
<p>First we perform single-point calculations on the four geometries, and collect their energies and angles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">xtb_data_point</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;buta&#39;</span><span class="p">})</span>
<span class="n">TS</span> <span class="o">=</span> <span class="n">xtb_data_point</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">TS_butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;TS&#39;</span><span class="p">})</span>
<span class="n">cis</span> <span class="o">=</span> <span class="n">xtb_data_point</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;cis&#39;</span><span class="p">})</span>
<span class="n">TS2</span> <span class="o">=</span> <span class="n">xtb_data_point</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">TS2_butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;TS2&#39;</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>

<span class="n">trans_energy</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
<span class="n">TS_energy</span> <span class="o">=</span> <span class="n">TS</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
<span class="n">cis_energy</span> <span class="o">=</span> <span class="n">cis</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
<span class="n">TS2_energy</span> <span class="o">=</span> <span class="n">TS2</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>

<span class="n">trans_gradient</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span>
<span class="n">TS_gradient</span> <span class="o">=</span> <span class="n">TS</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span>
<span class="n">cis_gradient</span> <span class="o">=</span> <span class="n">cis</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span>
<span class="n">TS2_gradient</span> <span class="o">=</span> <span class="n">TS2</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span>

<span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">trans_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
          <span class="n">TS_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> 
          <span class="n">cis_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> 
          <span class="n">TS2_butadiene</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">diagram_energies_hartree</span> <span class="o">=</span> <span class="p">[</span><span class="n">trans_energy</span><span class="p">,</span> <span class="n">TS_energy</span><span class="p">,</span> <span class="n">cis_energy</span><span class="p">,</span> <span class="n">TS2_energy</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-1.4059659   0.52332642  0.59236412]
 [-0.8192712  -0.46341611 -0.0750863 ]
 [ 0.59183941 -0.53373403 -0.42283163]
 [ 1.56533993  0.17543334  0.13639991]
 [-0.86017521  1.38538652  0.93657825]
 [-2.45883331  0.50670078  0.81589377]
 [-1.41912194 -1.29544903 -0.42335663]
 [ 0.83817231 -1.25166336 -1.19567671]
 [ 1.37734234  0.88207984  0.92685933]
 [ 2.59067257  0.07133562 -0.17445109]]
</pre></div>
</div>
</div>
</div>
<p>Second, we plot the diagram</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;  # For higher resolution display in Jupyter notebooks

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">hartree_to_kcalmol</span> <span class="o">=</span> <span class="mf">627.509</span>
<span class="n">lowest_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diagram_energies_hartree</span><span class="p">)</span>
<span class="n">E_kcalmol</span> <span class="o">=</span> <span class="p">[(</span><span class="n">energy</span> <span class="o">-</span> <span class="n">lowest_energy</span><span class="p">)</span> <span class="o">*</span> <span class="n">hartree_to_kcalmol</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">diagram_energies_hartree</span><span class="p">]</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">,</span> <span class="s1">&#39;TS&#39;</span><span class="p">,</span> <span class="s1">&#39;cis&#39;</span><span class="p">,</span> <span class="s1">&#39;TS2&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="c1"># Plotting each energy level as a horizontal line</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">E_kcalmol</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">energy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)),</span> <span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Butadiene Isomerization Energy Diagram&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;XTB Energy (kcal/mol)&#39;</span><span class="p">)</span>

<span class="c1"># Setting limits and customizing grid appearance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">E_kcalmol</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">E_kcalmol</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># Make grid less obtrusive</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;isomerization.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/5d97dd13c5d329d34ce062d4d212fac00141a010d42f2f9a0176cee17dc81cd4.png"><img alt="../../_images/5d97dd13c5d329d34ce062d4d212fac00141a010d42f2f9a0176cee17dc81cd4.png" src="../../_images/5d97dd13c5d329d34ce062d4d212fac00141a010d42f2f9a0176cee17dc81cd4.png" style="width: 835px; height: 637px;" />
</a>
</div>
</div>
<p>We have now a better understanding of the isomerization profile of the <em>cis-trans</em> process.</p>
<p>Before we proceed to the passive and active learning approaches, we will generate a reference dataset from the scan geometries, for testing the various ML approaches.</p>
<p>To set up the reference, we start by running the single-point calculations. We here use <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> to gather the results. This will run the calculations concurrently, and only proceed when all the results have been gathered. For a local setup this is not actually neccessary. However, if our <code class="docutils literal notranslate"><span class="pre">xtb_data_point</span></code> is set up to use a Slurm scheduler, this syntax allow us to submit and run the calculations in parallel. In either case, we will only proceed once all the calculations are finished.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">xtb_data_point</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;reference&#39;</span><span class="p">})</span> <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">scan_structures</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we generate the dataset for the ouputs and inputs, and finally inspect the reference data, according to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_path</span><span class="o">=</span><span class="n">xtb_wrk</span> <span class="o">+</span> <span class="s1">&#39;/reference&#39;</span>
<span class="n">reference</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">reference_path</span><span class="p">,</span>
                        <span class="n">parser</span><span class="o">=</span><span class="n">xtb_data_point</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">)</span>

<span class="c1"># Rename the coordinates</span>
<span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
<span class="c1"># Sort the data according to ascending dihedral engles</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_dihedral</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">coor</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">({</span><span class="s1">&#39;atoms&#39;</span><span class="p">:</span><span class="n">atoms</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span><span class="n">coor</span><span class="p">},</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
    <span class="n">dihedral</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dihedral</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">dihedral</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">+</span> <span class="n">dihedral</span>
    <span class="k">return</span> <span class="n">dihedral</span>

<span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_dihedral</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">reference</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">flatten_data_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="c1"># Check if the item is indeed a list of lists</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sublist</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">column</span><span class="p">]):</span>
            <span class="c1"># Only then proceed to flatten</span>
            <span class="n">flattened_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">flattened_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If it&#39;s not a list of lists, you might want to handle it differently or skip</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Item at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is already flattened or is not a list of lists.&quot;</span><span class="p">)</span>

<span class="n">flatten_data_column</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us finally plot the recalculated data to see if we did everything correctly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Reference - recalc&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;reference_recalc.png&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/aee8597588d757a9891674990be1c349dfbe23179582453e2652cc3dce8d9973.png"><img alt="../../_images/aee8597588d757a9891674990be1c349dfbe23179582453e2652cc3dce8d9973.png" src="../../_images/aee8597588d757a9891674990be1c349dfbe23179582453e2652cc3dce8d9973.png" style="width: 825px; height: 664px;" />
</a>
</div>
</div>
</section>
<section id="passive-learning">
<h2>Passive learning<a class="headerlink" href="#passive-learning" title="Link to this heading">#</a></h2>
<p>Having expored our system, we are now ready to test out different machine-learning approaches. We start here by exploring the so-called <em>passive</em> approach, where we</p>
<ul class="simple">
<li><p>first run an MD calculation to genereate data points</p></li>
<li><p>train the MLPs using these data points</p></li>
<li><p>test our model</p></li>
</ul>
<p>Typically this is an iterative approach, where we will have to also explore <em>how</em> to run the MD, and the number of data points required before we get an accuracy we can be satisfied with. Note that we will not in any way target the isomerization energy profile, but merly use it as a way to test our MLPs.</p>
<p>We start by defining a function to run the MD, and generate a dataset with the energies and forces of all the MD snapshots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">xtb_MD</span><span class="p">(</span><span class="n">starting_geomerty</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">number_of_dumps</span><span class="p">,</span> <span class="n">sub_dir</span><span class="o">=</span><span class="s1">&#39;md&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Function that runs an XTB molecular dynamics simulation.</span>
<span class="sd">    </span>
<span class="sd">    The time step is 5 fs, but only every tenth geometry is stored&#39;&#39;&#39;</span>

    <span class="c1"># --- Start by running the MD</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">50.0</span><span class="o">*</span><span class="n">number_of_dumps</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">input_str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;$md</span>
<span class="s1">      temp=</span><span class="si">{</span><span class="n">temperature</span><span class="si">}</span><span class="s1"> # in K</span>
<span class="s1">      time= </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">  # in ps</span>
<span class="s1">      dump= 50.0  # in fs</span>
<span class="s1">      step=  5.0  # in fs</span>
<span class="s1">      velo=false</span>
<span class="s1">      nvt =true</span>
<span class="s1">      hmass=4</span>
<span class="s1">      shake=2</span>
<span class="s1">      sccacc=2.0</span>
<span class="s1">    $end</span>
<span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">xtb_md</span> <span class="o">=</span>  <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="s1">&#39;molecular_dynamics&#39;</span><span class="p">},</span> <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">xtb_conda</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">xtb_md</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">starting_geomerty</span><span class="p">,</span> <span class="n">program_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">},</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="n">sub_dir</span><span class="p">})</span>

    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;trajectories&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>

    <span class="c1"># --- Next we are ready to calculate the data points from the MD geometries</span>
    <span class="n">geometries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_dumps</span><span class="p">):</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">starting_geomerty</span><span class="p">)</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

    <span class="c1"># Here we perform the data point calculations</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">xtb_data_point</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sub_dir</span><span class="si">}</span><span class="s1">_data&#39;</span><span class="p">})</span> <span class="k">for</span> <span class="n">geo</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">])</span>

    <span class="c1"># Extract results for generating a dataset</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">xtb_wrk</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">sub_dir</span><span class="si">}</span><span class="s1">_data&#39;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">xtb_data_point</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">)</span>

    <span class="c1"># Extract C=C-C=C dihedral angles</span>
    <span class="n">dihedrals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">geo</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
        <span class="n">dihedrals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Add the dihedrals to the pandas data sheet</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dihedrals</span>

    <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
<p>Next we generate an MD data set with <span class="math notranslate nohighlight">\(n\)</span> frames, at a temperature of 20 degrees celsius.</p>
<blockquote>
<div><p>This calculation will likely take quite some minutes. On a 2.3 GHz 8-core intel i9, this took about 15 minutes for <span class="math notranslate nohighlight">\(n=1000\)</span>. You can easily proceed also by using a lower number of data frames, for example 50 or 200.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">=</span><span class="mi">50</span>
<span class="n">t</span><span class="o">=</span><span class="mi">20</span>
<span class="n">t20</span> <span class="o">=</span> <span class="k">await</span> <span class="n">xtb_MD</span><span class="p">(</span><span class="n">butadiene</span><span class="p">,</span> <span class="mf">273.15</span><span class="o">+</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;t20&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: MD is recommended to be used only with optimized geometry.
</pre></div>
</div>
</div>
</div>
<p>For now the model inference, ie. the evaluation of the model, is only implemented for periodic systems. As such we will also need to train the data on a periodic system, which we emulate by adding a large unit cell for each data point in our Pandas datasheet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">augment_data_with_lattice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="c1"># Create a list of N 3x3 identity matrices, each multiplied by a factor</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    
    <span class="c1"># Flatten each 3x3 matrix in the cell list</span>
    <span class="n">flattened_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="n">cell</span><span class="p">]</span>
    
    <span class="c1"># Update the data entry with the flattened cells</span>
    <span class="n">data</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">flattened_cell</span>

<span class="n">augment_data_with_lattice</span><span class="p">(</span><span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us inspect the MM datapoint before we proceed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t20</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>input_geometry</th>
      <th>atoms</th>
      <th>gradient</th>
      <th>version</th>
      <th>cite</th>
      <th>omp_threads</th>
      <th>Reference</th>
      <th>basis_functions</th>
      <th>atomic_orbitals</th>
      <th>electrons</th>
      <th>...</th>
      <th>orbital_occupations</th>
      <th>orbital_homo</th>
      <th>orbital_lumo</th>
      <th>coordination_numbers</th>
      <th>molecular_dipole</th>
      <th>molecular_quadrupole</th>
      <th>molecular_quadrupole_order</th>
      <th>gradient_norm</th>
      <th>dihedrals</th>
      <th>cell</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[[-1.758792198496, 0.488609923081, 0.084780896...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.000982293806, -0.008253154471, -0.01117791...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.842, 2.89, 2.895, 2.837, 0.926, 0.926, 0.92...</td>
      <td>0.197</td>
      <td>[0.261, -0.482, -0.508, -0.459, -1.522, 0.248]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.028757329416</td>
      <td>-179.999886</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[[-1.649834761847, 0.524651371548, 0.191653691...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.02015416698, 0.012245020214, 0.008497904477...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.87, 2.914, 2.922, 2.861, 0.926, 0.926, 0.92...</td>
      <td>0.079</td>
      <td>[0.272, -0.447, -0.533, 0.228, -1.714, 0.261]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.044209350379</td>
      <td>-159.293699</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[[-1.812574088505, 0.423497025153, 0.051543886...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.007183576556, 0.008608273681, 0.0048916808...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.889, 2.889, 2.836, 0.926, 0.926, 0.9...</td>
      <td>0.064</td>
      <td>[0.560, -0.332, -0.651, -0.594, -1.285, 0.092]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.052652709947</td>
      <td>-155.550273</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[[-1.767780100749, 0.361255713891, 0.039999237...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.001287849305, -0.009980958944, 0.000237307...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.844, 2.893, 2.897, 2.84, 0.926, 0.926, 0.92...</td>
      <td>0.033</td>
      <td>[0.747, -0.215, -0.788, -0.374, -1.616, 0.041]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.027981163674</td>
      <td>-164.129998</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[[-1.760985003349, 0.368729186591, 0.059175301...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.00044686763, -0.004644546387, 0.00423712348...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.844, 2.904, 2.897, 2.851, 0.926, 0.926, 0.9...</td>
      <td>0.141</td>
      <td>[0.593, -0.306, -0.649, -0.206, -1.690, 0.057]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.024708957320</td>
      <td>178.124980</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>[[-1.817622483182, 0.429511708566, 0.047982212...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.005127531327, -0.008878993949, -0.011345543...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.891, 2.889, 2.838, 0.926, 0.926, 0.9...</td>
      <td>0.031</td>
      <td>[0.617, -0.477, -0.626, -0.648, -1.594, 0.009]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037965906523</td>
      <td>171.517642</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>6</th>
      <td>[[-1.716186108647, 0.54973995613, 0.1846434144...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.003012107164, 0.011300749123, -0.000256325...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.842, 2.898, 2.895, 2.845, 0.926, 0.926, 0.9...</td>
      <td>0.024</td>
      <td>[0.252, -0.062, -0.617, -0.242, -1.413, 0.364]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.035586168986</td>
      <td>172.083832</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>7</th>
      <td>[[-1.754324864542, 0.341916545009, 0.023338300...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.0022768491, 0.008069605087, 0.000548923708...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.842, 2.903, 2.895, 2.85, 0.926, 0.926, 0.92...</td>
      <td>0.264</td>
      <td>[0.171, -0.193, -0.561, -0.379, -1.511, 0.390]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.021422210851</td>
      <td>-176.439379</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>8</th>
      <td>[[-1.729245368607, 0.373154058978, 0.079226593...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.001255733421, -0.008770324176, 0.0008959025...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.864, 2.905, 2.917, 2.852, 0.926, 0.926, 0.9...</td>
      <td>0.062</td>
      <td>[0.638, -0.064, -0.714, -0.256, -1.654, 0.076]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.049358998899</td>
      <td>-164.316955</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>9</th>
      <td>[[-1.748826780634, 0.506392109563, 0.142801288...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.011370764324, -0.015511157501, -0.01162558...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.839, 2.898, 2.891, 2.846, 0.926, 0.926, 0.9...</td>
      <td>0.401</td>
      <td>[-0.013, -0.151, -0.518, -0.547, -1.303, 0.530]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.035991194271</td>
      <td>-160.488160</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>10</th>
      <td>[[-1.777675337461, 0.550514429946, 0.124883481...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.014561383732, 0.011800174922, 0.00338393956...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.889, 2.889, 2.836, 0.926, 0.926, 0.9...</td>
      <td>0.184</td>
      <td>[0.963, -0.693, -0.795, -0.047, -1.592, -0.169]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.036306490309</td>
      <td>179.868212</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>11</th>
      <td>[[-1.645473393799, 0.560625023979, 0.163346929...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.009915860045, 0.002701958301, -0.0098270651...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.854, 2.899, 2.907, 2.847, 0.926, 0.926, 0.9...</td>
      <td>0.429</td>
      <td>[-0.300, 0.075, -0.359, -0.187, -1.635, 0.659]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.042448742360</td>
      <td>161.849506</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>12</th>
      <td>[[-1.702193552915, 0.31066200115, 0.0214993519...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.004489817557, -0.010045947189, -0.009636670...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.869, 2.91, 2.922, 2.857, 0.926, 0.926, 0.92...</td>
      <td>0.122</td>
      <td>[0.047, -0.202, -0.411, -0.523, -1.728, 0.364]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.043664665454</td>
      <td>154.790459</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>13</th>
      <td>[[-1.715705433726, 0.452068258089, 0.128336869...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[1.022349e-06, -0.006813864316, -0.00986128119...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.858, 2.913, 2.911, 2.861, 0.926, 0.926, 0.9...</td>
      <td>0.018</td>
      <td>[0.025, -0.375, -0.294, -0.624, -1.589, 0.269]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.043510215914</td>
      <td>146.183214</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>14</th>
      <td>[[-1.781301662191, 0.384290606212, 0.044152236...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.007071547416, -0.000912207663, -0.00553651...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.84, 2.894, 2.893, 2.841, 0.926, 0.926, 0.92...</td>
      <td>0.207</td>
      <td>[0.555, -0.438, -0.704, -0.458, -1.571, 0.150]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.039443895739</td>
      <td>-174.325348</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>15</th>
      <td>[[-1.727149392063, 0.485245098046, 0.119321336...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.0069689317, 0.008687385507, -0.001419419022...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.853, 2.896, 2.905, 2.843, 0.926, 0.926, 0.9...</td>
      <td>0.072</td>
      <td>[0.251, -0.569, -0.554, -0.422, -1.608, 0.303]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.039081106600</td>
      <td>-160.500637</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>16</th>
      <td>[[-1.803816722534, 0.355658932839, 0.039414291...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.00346805371, -0.015923075218, -0.002626583...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.838, 2.893, 2.891, 2.84, 0.926, 0.926, 0.92...</td>
      <td>0.042</td>
      <td>[0.646, -0.802, -0.529, -0.427, -1.524, -0.117]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.025732884130</td>
      <td>-144.055677</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>17</th>
      <td>[[-1.727651190089, 0.335079232468, 0.010911879...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.003353015162, 0.010678242642, -0.0003409062...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.845, 2.91, 2.898, 2.857, 0.926, 0.926, 0.92...</td>
      <td>0.342</td>
      <td>[-0.267, -0.191, -0.263, -0.377, -1.528, 0.529]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.038450865513</td>
      <td>-158.059070</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>18</th>
      <td>[[-1.770195517442, 0.408667121088, 0.040489955...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.003333186676, 0.014023719689, 0.01028706763...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.843, 2.89, 2.896, 2.837, 0.926, 0.926, 0.92...</td>
      <td>0.261</td>
      <td>[0.280, 0.271, -0.649, -0.740, -1.502, 0.369]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037195445367</td>
      <td>160.753214</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>19</th>
      <td>[[-1.67208550913, 0.519604583969, 0.2253591253...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.001009338214, 0.002640089066, 0.01202402520...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.856, 2.922, 2.908, 2.87, 0.926, 0.926, 0.92...</td>
      <td>0.046</td>
      <td>[0.396, -0.207, -0.641, -0.157, -1.619, 0.244]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.041259718668</td>
      <td>159.072910</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>20</th>
      <td>[[-1.730125308187, 0.376615854953, 0.071226436...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.005246649971, 0.003296875643, 0.00249875748...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.857, 2.903, 2.91, 2.85, 0.926, 0.926, 0.925...</td>
      <td>0.127</td>
      <td>[0.591, -0.118, -0.690, -0.168, -1.633, 0.099]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.034496195790</td>
      <td>145.685752</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>21</th>
      <td>[[-1.771864477523, 0.362015712949, 0.068994093...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.001916632886, -0.019246207434, -0.00839805...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.845, 2.903, 2.898, 2.85, 0.926, 0.926, 0.92...</td>
      <td>0.196</td>
      <td>[0.417, -0.654, -0.457, -0.514, -1.553, 0.041]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.030665563685</td>
      <td>179.518778</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>22</th>
      <td>[[-1.748395868652, 0.394926434469, 0.035187612...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.003721747785, -0.001068004759, -0.019852599...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.849, 2.905, 2.902, 2.852, 0.926, 0.926, 0.9...</td>
      <td>0.236</td>
      <td>[0.097, -0.260, -0.454, -0.014, -1.806, 0.357]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.043948060765</td>
      <td>-152.253329</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>23</th>
      <td>[[-1.806959425108, 0.442455407455, 0.077599303...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.021296240479, -0.009644146379, -0.00652856...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.838, 2.889, 2.891, 2.836, 0.926, 0.926, 0.9...</td>
      <td>0.219</td>
      <td>[0.813, -0.252, -0.801, -0.619, -1.408, -0.012]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.054869083991</td>
      <td>-143.582566</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>24</th>
      <td>[[-1.743436009621, 0.438821072646, 0.092956249...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.004220410247, 0.007693429905, -0.0045644288...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.851, 2.903, 2.904, 2.851, 0.926, 0.926, 0.9...</td>
      <td>0.164</td>
      <td>[0.386, -0.767, -0.515, -0.094, -1.592, 0.129]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.031049647794</td>
      <td>-156.435383</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>25</th>
      <td>[[-1.834132498826, 0.531616901979, 0.123797461...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.0125970752, 0.003867722431, 0.013006352149...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.834, 2.886, 2.887, 2.834, 0.926, 0.926, 0.9...</td>
      <td>0.083</td>
      <td>[1.171, -0.111, -1.010, -0.540, -1.480, -0.162]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.056937881668</td>
      <td>171.441064</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>26</th>
      <td>[[-1.734112740862, 0.396373890065, 0.027137284...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.012998978626, 0.01407563744, -0.00582819017...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.852, 2.905, 2.905, 2.853, 0.926, 0.926, 0.9...</td>
      <td>0.191</td>
      <td>[0.035, -0.431, -0.455, -0.256, -1.408, 0.420]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.049921918770</td>
      <td>150.451683</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>27</th>
      <td>[[-1.821138835894, 0.401363416281, 0.026981959...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.001806191823, -0.002951060703, 0.003453250...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.887, 2.889, 2.835, 0.926, 0.926, 0.9...</td>
      <td>0.068</td>
      <td>[1.012, -0.018, -0.933, -0.382, -1.510, -0.079]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.040516682194</td>
      <td>141.398400</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>28</th>
      <td>[[-1.71894395995, 0.565603743103, 0.1820934111...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.016343179278, -0.000329862481, 0.0029514732...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.839, 2.894, 2.892, 2.842, 0.926, 0.926, 0.9...</td>
      <td>0.063</td>
      <td>[0.677, -0.449, -0.779, -0.422, -1.526, 0.102]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.046219055524</td>
      <td>166.518528</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>29</th>
      <td>[[-1.778644884845, 0.434588245813, 0.071701355...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.000197851752, -0.0002477611, 0.000281104369...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.841, 2.894, 2.894, 2.841, 0.926, 0.926, 0.9...</td>
      <td>0.000</td>
      <td>[0.698, -0.477, -0.863, -0.234, -1.611, 0.165]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.000955708899</td>
      <td>-171.409076</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>30</th>
      <td>[[-1.652315579154, 0.523886380489, 0.148333509...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.015044675046, 0.012842742948, -0.0039288337...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.876, 2.907, 2.929, 2.854, 0.926, 0.926, 0.9...</td>
      <td>0.112</td>
      <td>[0.049, 0.017, -0.517, -0.333, -1.864, 0.468]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.044741861070</td>
      <td>-142.767293</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>31</th>
      <td>[[-1.698798219158, 0.553449977269, 0.165180587...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.001148643359, 0.004042392108, -0.0028027770...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.842, 2.892, 2.895, 2.84, 0.926, 0.926, 0.92...</td>
      <td>0.137</td>
      <td>[0.166, 0.097, -0.679, -0.666, -1.506, 0.513]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.031155132795</td>
      <td>-159.704937</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>32</th>
      <td>[[-1.806460270597, 0.468439488092, 0.095418066...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.000519507286, 0.012441582853, 0.0085895276...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.892, 2.889, 2.84, 0.926, 0.926, 0.92...</td>
      <td>0.304</td>
      <td>[0.446, 0.027, -0.669, -0.438, -1.689, 0.223]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.034356985536</td>
      <td>176.756106</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>33</th>
      <td>[[-1.741566443376, 0.511504074559, 0.081354928...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.011306668498, 0.005096725195, -0.0187125379...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.845, 2.895, 2.897, 2.842, 0.926, 0.926, 0.9...</td>
      <td>0.205</td>
      <td>[0.356, -0.121, -0.506, -0.083, -1.502, 0.149]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.046002381406</td>
      <td>153.473492</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>34</th>
      <td>[[-1.725274095178, 0.408848154841, 0.120469397...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.005353268825, -0.020050397133, -0.00452671...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.857, 2.91, 2.91, 2.857, 0.926, 0.926, 0.925...</td>
      <td>0.293</td>
      <td>[0.401, -0.093, -0.516, -0.470, -1.488, 0.115]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.048917563807</td>
      <td>139.365611</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>35</th>
      <td>[[-1.752711730776, 0.397298958494, 0.079376991...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.005041691459, 0.016894077992, 0.0103949841...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.848, 2.903, 2.901, 2.85, 0.926, 0.926, 0.92...</td>
      <td>0.167</td>
      <td>[0.277, 0.318, -0.532, -0.596, -1.323, 0.255]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.043824920661</td>
      <td>173.703928</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>36</th>
      <td>[[-1.762450276593, 0.431392139159, 0.098345517...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.003958373711, 0.008132673219, 0.00366436306...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.844, 2.901, 2.897, 2.849, 0.926, 0.926, 0.9...</td>
      <td>0.126</td>
      <td>[0.345, -0.111, -0.603, -0.588, -1.686, 0.259]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037186213115</td>
      <td>-164.846662</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>37</th>
      <td>[[-1.79677339558, 0.425304532942, 0.0364589196...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.006196577019, 0.016420145598, 0.00540294912...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.838, 2.891, 2.891, 2.838, 0.926, 0.926, 0.9...</td>
      <td>0.065</td>
      <td>[0.667, -0.320, -0.679, -0.063, -1.246, 0.012]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037336604167</td>
      <td>-133.799320</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>38</th>
      <td>[[-1.75203021639, 0.482209168527, 0.1444594176...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.006150439019, 0.002196394079, 0.0026416403...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.84, 2.901, 2.893, 2.848, 0.926, 0.926, 0.92...</td>
      <td>0.104</td>
      <td>[0.388, -0.110, -0.549, -0.733, -1.694, 0.161]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037141995992</td>
      <td>-147.234819</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>39</th>
      <td>[[-1.799984574357, 0.388773298853, 0.030628085...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.004151878893, -0.0034071028, -0.0026056542...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.839, 2.89, 2.891, 2.837, 0.926, 0.926, 0.92...</td>
      <td>0.224</td>
      <td>[0.587, -0.706, -0.562, -0.443, -1.537, -0.025]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.029013324622</td>
      <td>-174.474761</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>40</th>
      <td>[[-1.780860307005, 0.514800962468, 0.089489708...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[3.2997207e-05, 0.016270915634, -0.00352152431...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.838, 2.89, 2.891, 2.838, 0.926, 0.926, 0.92...</td>
      <td>0.166</td>
      <td>[0.486, -0.351, -0.767, -0.279, -1.737, 0.281]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037640019141</td>
      <td>163.300098</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>41</th>
      <td>[[-1.758637275412, 0.589059445689, 0.146956835...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.011860497138, 0.017554491454, 0.00783418894...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.888, 2.888, 2.835, 0.926, 0.926, 0.9...</td>
      <td>0.122</td>
      <td>[1.054, -0.328, -1.010, -0.018, -1.576, -0.044]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.053144866851</td>
      <td>144.553128</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>42</th>
      <td>[[-1.773114343643, 0.328302018765, -0.02204116...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.001490390544, -0.008770215253, -0.00761063...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.838, 2.89, 2.891, 2.837, 0.926, 0.926, 0.92...</td>
      <td>0.056</td>
      <td>[0.438, -0.158, -0.640, -0.639, -1.645, 0.202]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037351430313</td>
      <td>157.724031</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>43</th>
      <td>[[-1.742798460514, 0.51517433082, 0.1267761156...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.000447895515, 0.005898781361, -0.011545461...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.84, 2.896, 2.893, 2.843, 0.926, 0.926, 0.92...</td>
      <td>0.060</td>
      <td>[0.049, -0.337, -0.606, -0.482, -1.388, 0.557]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.038872885656</td>
      <td>-177.013561</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>44</th>
      <td>[[-1.72536711797, 0.488020339406, 0.1374609879...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.001402820496, -0.018172589705, -0.017439847...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.848, 2.903, 2.901, 2.85, 0.926, 0.926, 0.92...</td>
      <td>0.068</td>
      <td>[0.308, -0.367, -0.467, -0.390, -0.924, 0.159]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.052393656744</td>
      <td>-154.351500</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>45</th>
      <td>[[-1.769104592646, 0.342400041217, 0.028238697...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.018629926883, -0.002395803906, 0.0051762731...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.84, 2.894, 2.893, 2.841, 0.926, 0.926, 0.92...</td>
      <td>0.054</td>
      <td>[0.869, -0.048, -0.745, -0.201, -1.484, -0.124]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.048650234851</td>
      <td>-162.902802</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>46</th>
      <td>[[-1.718561338056, 0.462156306346, 0.112883382...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[0.009562576512, 0.021083175742, 0.00448670932...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.86, 2.914, 2.913, 2.862, 0.926, 0.926, 0.92...</td>
      <td>0.165</td>
      <td>[0.137, -0.275, -0.529, 0.399, -1.749, 0.392]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.045630245709</td>
      <td>-170.957784</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>47</th>
      <td>[[-1.752886157554, 0.52171727473, 0.1343939382...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.008924581045, -0.006441389208, -0.00150791...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.838, 2.89, 2.891, 2.837, 0.926, 0.926, 0.92...</td>
      <td>0.152</td>
      <td>[0.430, -0.066, -0.547, -0.900, -1.522, 0.116]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.037874625742</td>
      <td>151.739316</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>48</th>
      <td>[[-1.836098221734, 0.447407281519, 0.094028877...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.000201987954, -0.022880210868, 0.007007151...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.834, 2.888, 2.887, 2.836, 0.926, 0.926, 0.9...</td>
      <td>0.181</td>
      <td>[1.075, 0.008, -0.949, -0.643, -1.398, -0.127]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.054371966442</td>
      <td>139.624670</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
    <tr>
      <th>49</th>
      <td>[[-1.82098737237, 0.450190373206, 0.0550210417...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>[-0.002234875275, -0.020494200851, -0.01007734...</td>
      <td>6.6.1</td>
      <td>10.1002/wcms.1493</td>
      <td>16</td>
      <td>10.1021/acs.jctc.8b01176</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>...</td>
      <td>[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, ...</td>
      <td>11</td>
      <td>12</td>
      <td>[2.836, 2.887, 2.889, 2.834, 0.926, 0.926, 0.9...</td>
      <td>0.272</td>
      <td>[0.909, -0.320, -0.720, -0.745, -1.354, -0.190]</td>
      <td>[xx, xy, yy, xz, yz, zz]</td>
      <td>0.047653916007</td>
      <td>155.925617</td>
      <td>[50.0, 0.0, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 50.0]</td>
    </tr>
  </tbody>
</table>
<p>50 rows × 25 columns</p>
</div></div></div>
</div>
<p>Here you may notice that the dihedral values jump between +/- roughly 180 degrees, therefor we instead map them to positive valules only, i.e. from (-180,180) to (0,360).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">360</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the following we would like to investigate these data points, so in the following cell we first set up a function to plot data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">horizontal_line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot data as a function of geometry number from a given DataFrame and optionally add a horizontal line at a given y value.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - data: DataFrame containing the data to plot.</span>
<span class="sd">    - column: The column name in the DataFrame to plot.</span>
<span class="sd">    - ylabel: Label for the y-axis.</span>
<span class="sd">    - title: Title of the plot.</span>
<span class="sd">    - ref: Reference value for adjusting data, used when plotting &#39;energies&#39;.</span>
<span class="sd">    - horizontal_line: Y value at which to draw a horizontal line (optional).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate a sequence of row numbers equal to the length of the DataFrame</span>
    <span class="n">row_numbers</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># Adjust the figure size as needed</span>
    
    <span class="n">hartree_to_kcalmol</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Constants</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">(</span><span class="s2">&quot;hartree&quot;</span><span class="p">,</span> <span class="s2">&quot;kcal / mol&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span> <span class="ow">or</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;energies&#39;</span><span class="p">:</span>
        <span class="n">reference_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">])</span>  <span class="c1"># Assuming adjustment by the minimum energy</span>
        <span class="n">energies_kcalmol</span> <span class="o">=</span> <span class="p">[(</span><span class="n">energy</span> <span class="o">-</span> <span class="n">reference_energy</span><span class="p">)</span> <span class="o">*</span> <span class="n">hartree_to_kcalmol</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">,</span> <span class="n">energies_kcalmol</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Optionally add a horizontal line at the specified y value</span>
    <span class="k">if</span> <span class="n">horizontal_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">horizontal_line</span><span class="o">-</span><span class="n">ref</span><span class="p">)</span><span class="o">*</span><span class="n">hartree_to_kcalmol</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Geometry Number&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Show grid lines for better readability</span>
    <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We are then ready to invesitgate the dihedral angles as a function of the MD frames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_data</span><span class="p">(</span><span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;dihedrals&#39;</span><span class="p">,</span> <span class="s1">&#39;Dihedral angle (degrees)&#39;</span><span class="p">,</span> <span class="s1">&#39;Dihedral angle as a function of the MD frame&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;dihedral_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_0.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/5e9508339d24a9c6b3aeab52d6f001ff3c9f016eb345015e702130800c7a389e.png"><img alt="../../_images/5e9508339d24a9c6b3aeab52d6f001ff3c9f016eb345015e702130800c7a389e.png" src="../../_images/5e9508339d24a9c6b3aeab52d6f001ff3c9f016eb345015e702130800c7a389e.png" style="width: 858px; height: 554px;" />
</a>
</div>
</div>
<p>In our case, we do not have a sufficient amount of MD steps to see any actual dihedral isomerization. Before we proceed, let us also plot the electronic energies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_data</span><span class="p">(</span><span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;Electronic Energy (kcal/mol)&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy as a function of the MD frame&#39;</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">reference_energy</span><span class="p">,</span> 
          <span class="n">horizontal_line</span><span class="o">=</span><span class="n">TS_energy</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;energy_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_0.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/cf08ad8037c31715ca4bb7dc3169f198e9932f49ed0121e3c357452c32a91c04.png"><img alt="../../_images/cf08ad8037c31715ca4bb7dc3169f198e9932f49ed0121e3c357452c32a91c04.png" src="../../_images/cf08ad8037c31715ca4bb7dc3169f198e9932f49ed0121e3c357452c32a91c04.png" style="width: 848px; height: 554px;" />
</a>
</div>
</div>
<p>As can be seen from the electronic energies, there is clearly enough energy in the system to isomerize (the isomerization barrier is 5.44 kcal/mol). However, as can be seen from the plot of the dihedral angles, we rather see only small osciallations around the equilibrium <em>trans</em> dihedral angle of 180 degrees. It is a typical feature for MD  calculations to oscillate around equilibirum states. As a result, traning MLPs based on such calculations will typically give a bias towards equilibrium states. Furthermore, important parts of the PES may never be explored, thus resulting in MLPs that perform poorly unless great care is taken in the construction of the training data.</p>
<p>Still, let us use the MD data points generated to train our MLP to see how it actually performs byt comparing to our reference data points.</p>
<p>We start by setting up our DeepMD engine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">deepmd_wrk</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/wrk_pbc/deepmd&#39;</span>
<span class="n">deepmd_conda</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> 
                                            <span class="n">conda_env</span><span class="o">=</span><span class="s1">&#39;hsp_al&#39;</span><span class="p">,</span> 
                                            <span class="n">work_dir</span><span class="o">=</span><span class="n">deepmd_wrk</span><span class="p">,</span> 
                                            <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>

<span class="n">deepmd_input_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;templates/deepmd_template.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="n">deepmd_engine</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DeepMD</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">deepmd_input_dict</span><span class="p">,</span>
        <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;check_version&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">},</span> 
    <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">deepmd_conda</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We again rename the coordinates and flatten them</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">flatten_data_column</span><span class="p">(</span><span class="n">t20</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we train our model based on these data points. We first transform our dataset into a DeepMD friendly format, and second train our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dp_data</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">t20</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">deepmd_wrk</span><span class="si">}</span><span class="s1">/wrk/t20&#39;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">dp_data</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sub_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;wrk/trained_models&quot;</span><span class="p">})</span>
<span class="c1"># This step takes a lot of time, you can monitor the progress in the trained_models directory</span>
</pre></div>
</div>
</div>
</div>
<p>We can then test our model on the reference geometries, and make a plot to compare the two.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">deepmd_engine</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">reference</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref_M</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">,</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">);</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, 0)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;model1_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_0.png&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/a0cc71da77463247cf3b012376546c04eee9ebb109d127014057097fc8946870.png"><img alt="../../_images/a0cc71da77463247cf3b012376546c04eee9ebb109d127014057097fc8946870.png" src="../../_images/a0cc71da77463247cf3b012376546c04eee9ebb109d127014057097fc8946870.png" style="width: 857px; height: 664px;" />
</a>
</div>
</div>
<p>As can be seen, our model captures some of the involved physics, but is also quite off. Let us for the sake of it calculate the barrier along the xTB dihedral scan. The reference barrier of xTB was 5.44 kcal/mol.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barrier</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">hsp</span><span class="o">.</span><span class="n">Constants</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">(</span><span class="s2">&quot;hartree&quot;</span><span class="p">,</span> <span class="s2">&quot;kcal / mol&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Isomerization barrier for model 1 is </span><span class="si">{</span><span class="n">barrier</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kcal/mol&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Isomerization barrier for model 1 is 11.33 kcal/mol
</pre></div>
</div>
</div>
</div>
<p>We are off by more than a factor 2. Next let us also add traing data around the <em>cis</em>-butadiene geometry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t20_cis</span> <span class="o">=</span> <span class="k">await</span> <span class="n">xtb_MD</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">,</span> <span class="mf">273.15</span><span class="o">+</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;cis_t20&#39;</span><span class="p">)</span>

<span class="c1"># Rename the coordinates</span>
<span class="n">t20_cis</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">flatten_data_column</span><span class="p">(</span><span class="n">t20_cis</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">)</span>

<span class="n">augment_data_with_lattice</span><span class="p">(</span><span class="n">t20_cis</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: MD is recommended to be used only with optimized geometry.
</pre></div>
</div>
</div>
</div>
<p>Again, we inspect the dihedral angles to confirm that the generated structures are indeed centered around the <em>cis</em>-state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_data</span><span class="p">(</span><span class="n">t20_cis</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;dihedrals&#39;</span><span class="p">,</span> <span class="s1">&#39;Dihedral angle (degrees)&#39;</span><span class="p">,</span> <span class="s1">&#39;Dehedral angle as a function of the MD frame&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;dihedral_cis_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_0.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/ee10771370f945acdfae2f80b290e3ae5749fec634eeb57f60f87f0d184d859d.png"><img alt="../../_images/ee10771370f945acdfae2f80b290e3ae5749fec634eeb57f60f87f0d184d859d.png" src="../../_images/ee10771370f945acdfae2f80b290e3ae5749fec634eeb57f60f87f0d184d859d.png" style="width: 862px; height: 554px;" />
</a>
</div>
</div>
<p>Next take the union of t20 and t20_cis, and train and compare to our reference with the added data points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">t20_50_50</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">t20</span><span class="p">)</span>
<span class="n">t20_50_50</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">t20_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">t20_cis</span><span class="o">.</span><span class="n">data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us inspect the data to ensure we have correctly concatenated the two data sets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t20_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span><span class="s1">&#39;atoms&#39;</span><span class="p">,</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="s1">&#39;gradient&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coordinates</th>
      <th>atoms</th>
      <th>energy</th>
      <th>gradient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[-1.758792198496, 0.488609923081, 0.0847808965...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.544214</td>
      <td>[-0.000982293806, -0.008253154471, -0.01117791...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[-1.649834761847, 0.524651371548, 0.1916536914...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.539112</td>
      <td>[0.02015416698, 0.012245020214, 0.008497904477...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[-1.812574088505, 0.423497025153, 0.0515438866...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.540379</td>
      <td>[-0.007183576556, 0.008608273681, 0.0048916808...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[-1.767780100749, 0.361255713891, 0.0399992375...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.548521</td>
      <td>[-0.001287849305, -0.009980958944, 0.000237307...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[-1.760985003349, 0.368729186591, 0.0591753011...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.548482</td>
      <td>[0.00044686763, -0.004644546387, 0.00423712348...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>[-1.436833595829, 0.610256417747, 0.4254923233...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.539006</td>
      <td>[0.009097811086, 0.014929575748, -0.0228786042...</td>
    </tr>
    <tr>
      <th>96</th>
      <td>[-1.476090822861, 0.361181035799, 0.7380626409...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.541290</td>
      <td>[-0.003634124913, 0.004613398819, -0.001840707...</td>
    </tr>
    <tr>
      <th>97</th>
      <td>[-1.493690465243, 0.585623895164, 0.4979424920...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.538505</td>
      <td>[-0.007096895976, 0.012492069837, -0.019683693...</td>
    </tr>
    <tr>
      <th>98</th>
      <td>[-1.375077620089, 0.533753915934, 0.6164569200...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.542540</td>
      <td>[0.001510555776, 0.010825543854, -0.0053038399...</td>
    </tr>
    <tr>
      <th>99</th>
      <td>[-1.469749557937, 0.591631431177, 0.4712953417...</td>
      <td>[C, C, C, C, H, H, H, H, H, H]</td>
      <td>-11.541335</td>
      <td>[-0.008930395251, 0.004073145543, -0.009881724...</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 4 columns</p>
</div></div></div>
</div>
<p>If all is good, we are ready to train our combined model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dp_data_50_50</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">t20_50_50</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">deepmd_wrk</span><span class="si">}</span><span class="s1">/wrk/t20_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">model_50_50</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">dp_data_50_50</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sub_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;wrk/trained_models_</span><span class="si">{n}</span><span class="s2">_</span><span class="si">{n}</span><span class="s2">&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>And infer the model on our reference geometries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_50_50</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">deepmd_engine</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">model_50_50</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">reference</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>For comparison, we also train solely on the <em>cis</em> generated geometries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dp_data_0_50</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">t20_cis</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">deepmd_wrk</span><span class="si">}</span><span class="s1">/wrk/t20_0_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">model_0_50</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">dp_data_0_50</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sub_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;wrk/trained_models_0_</span><span class="si">{n}</span><span class="s2">&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_0_50</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">deepmd_engine</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">model_0_50</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">reference</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We are ready to plot and compare our three trained models.</p>
<blockquote>
<div><p>(<span class="math notranslate nohighlight">\(n\)</span>,<span class="math notranslate nohighlight">\(m\)</span>) means <span class="math notranslate nohighlight">\(n\)</span> data points around the <em>trans</em> conformer and <span class="math notranslate nohighlight">\(m\)</span> data points around the <em>cis</em> conformer</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref_M2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">predictions_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">,</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">);</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, 0)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">);</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions_0_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(0, </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">);</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/a269edf675cd03ea08a84fc0269ec8c7ae8e37923c6383140c688ec27af4594e.png"><img alt="../../_images/a269edf675cd03ea08a84fc0269ec8c7ae8e37923c6383140c688ec27af4594e.png" src="../../_images/a269edf675cd03ea08a84fc0269ec8c7ae8e37923c6383140c688ec27af4594e.png" style="width: 838px; height: 664px;" />
</a>
</div>
</div>
<p>For a better comparison let us take the <em>trans</em>-conformer as the reference for each energy profile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref_M2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">predictions_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
<span class="n">ref_M1</span> <span class="o">=</span><span class="n">predictions_0_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">energies_hartree</span><span class="p">,</span> <span class="n">reference_energy</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;model_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_0.png&#39;</span><span class="p">);</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">ref_M</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, 0)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;model_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_1.png&#39;</span><span class="p">);</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions_0_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">ref_M1</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(0, </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;model_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_2.png&#39;</span><span class="p">);</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_energies</span><span class="p">(</span><span class="n">predictions_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">ref_M2</span><span class="p">,</span> <span class="n">add_to_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;model_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_3.png&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/a1677183d68eb5e271df253038133a52d0d114c1eff880680045a599f810dc42.png"><img alt="../../_images/a1677183d68eb5e271df253038133a52d0d114c1eff880680045a599f810dc42.png" src="../../_images/a1677183d68eb5e271df253038133a52d0d114c1eff880680045a599f810dc42.png" style="width: 838px; height: 664px;" />
</a>
</div>
</div>
<p>Clearly, using data points around both the <em>cis</em> and <em>trans</em> conformer generates the overall best profile. However, our model is not able to infer any knowledge around the TS state, as we have no data points in this region.</p>
<p>Let us finally inspect the barrier hight of our combined model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barrier</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">predictions_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">predictions_50_50</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">hsp</span><span class="o">.</span><span class="n">Constants</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">(</span><span class="s2">&quot;hartree&quot;</span><span class="p">,</span> <span class="s2">&quot;kcal / mol&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Isomerization barrier for model (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">) is </span><span class="si">{</span><span class="n">barrier</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kcal/mol&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Isomerization barrier for model (50, 50) is 4.49 kcal/mol
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>ToDO: 1) plot gradients, 2) train several models on the same data, and 3) train models with varying <span class="math notranslate nohighlight">\(n\)</span></p>
</div></blockquote>
</section>
<section id="active-learning">
<h2>Active Learning<a class="headerlink" href="#active-learning" title="Link to this heading">#</a></h2>
<p>We are now ready to explore the active-learning approach. For this we will use the hyal module, and in the same way as for the passive approach compare the MLPs with the reference data.</p>
<p>The HSP implementation of active learning start from an inital data set, and interatively combines the following main steps to train the MLPs:</p>
<ul class="simple">
<li><p>train the MLPs for a committee of models</p></li>
<li><p>run a fast sampler to genereate candidates for new data points</p></li>
<li><p>refine a selection of these candidates by minimizing an objective funtion (that includes the committee model devitations)</p></li>
<li><p>generate new data points using a calculator</p></li>
</ul>
<p>In the current example we will use: DeepMD for training, LAMMPS for sampling and XTB as calculator. The objective funtion to minimize in each AL iteration is:</p>
<div class="math notranslate nohighlight">
\[equation\]</div>
<section id="sampler">
<h3>Sampler<a class="headerlink" href="#sampler" title="Link to this heading">#</a></h3>
<p>For the sampler we will use LAMMPS. We can steer the LAMMPS setting by modifying the LAMMPS input template: <a class="reference download internal" download="" href="../../_downloads/863a5b4e2a079acd718b9acf61088b85/lammps.inp"><span class="xref download myst">lammps.inp</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hylleraas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">lammps_wrk</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
<span class="n">lammps_conda</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> 
                                           <span class="n">conda_env</span><span class="o">=</span><span class="s1">&#39;hsp_active_learning&#39;</span><span class="p">,</span> 
                                           <span class="n">work_dir</span><span class="o">=</span><span class="n">lammps_wrk</span><span class="p">,</span> 
                                           <span class="n">force_recompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lammps_engine</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Lammps</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;metal&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;check_version&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> 
                                    <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">lammps_conda</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ml-model">
<h3>ML model<a class="headerlink" href="#ml-model" title="Link to this heading">#</a></h3>
<p>For the ML model we will simply use the <code class="docutils literal notranslate"><span class="pre">deepmd_engine</span></code> we used for the passive learning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">deepmd_wrk</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/wrk_pbc/deepmd&#39;</span>
<span class="n">deepmd_conda</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> 
                                            <span class="n">conda_env</span><span class="o">=</span><span class="s1">&#39;hsp_al&#39;</span><span class="p">,</span> 
                                            <span class="n">work_dir</span><span class="o">=</span><span class="n">deepmd_wrk</span><span class="p">,</span> 
                                            <span class="n">force_recompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="c1">#                                            debug=debug)</span>
                                            <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">deepmd_input_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;templates/deepmd_template.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="n">deepmd_engine</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DeepMD</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">deepmd_input_dict</span><span class="p">,</span>
        <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;check_version&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">},</span> 
    <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">deepmd_conda</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculator">
<h3>Calculator<a class="headerlink" href="#calculator" title="Link to this heading">#</a></h3>
<p>For the calculator we will continue to use the <code class="docutils literal notranslate"><span class="pre">xtb_data_point</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This debug varaible is used throughout. For the final version simply turn off the debug </span>
<span class="c1"># option, but it might come handy when setting up and testing the code -- to more easily </span>
<span class="c1"># understand why the code fails in certain steps</span>

<span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">xtb_wrk</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/wrk_pbc/xtb&#39;</span>
<span class="n">xtb_conda</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> 
                                        <span class="n">conda_env</span><span class="o">=</span><span class="s1">&#39;hsp_al&#39;</span><span class="p">,</span> 
                                        <span class="n">work_dir</span><span class="o">=</span><span class="n">xtb_wrk</span><span class="p">,</span> 
                                        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>

<span class="c1"># XTB for geometry optimizations</span>
<span class="n">xtb_geometry_optimization</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> 
                                                    <span class="s1">&#39;geometry_optimization&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;gradient&#39;</span><span class="p">]},</span> 
                                    <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">xtb_conda</span><span class="p">)</span>

<span class="c1"># XTB for single point calaculations of the energy and gradient</span>
<span class="n">xtb_data_point</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient&#39;</span><span class="p">]},</span> 
                         <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">xtb_conda</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEBUG: (one of) output file(s) [PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/xtb_version.out&#39;), PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/xtb_version.out&#39;)] exists
DEBUG: and will *not* be overwritten
DEBUG: QUICK RETURN: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/xtb_version.out&#39;), output_folder=None, stdout=None, stderr=None, returncode=None, error=None)
DEBUG: (one of) output file(s) [PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/xtb_version.out&#39;), PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/xtb_version.out&#39;)] exists
DEBUG: and will *not* be overwritten
DEBUG: QUICK RETURN: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/xtb_version.out&#39;), output_folder=None, stdout=None, stderr=None, returncode=None, error=None)
</pre></div>
</div>
</div>
</div>
</section>
<section id="al-model">
<h3>AL model<a class="headerlink" href="#al-model" title="Link to this heading">#</a></h3>
<p>For the active learning we will use hyal, which can be steered using a json template file: <a class="reference download internal" download="" href="../../_downloads/3e308e4dd3903b09880dba9e6bf6676c/hyal_settings.json"><span class="xref download myst">hyal_settings.json</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyal_settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;templates/hyal_settings.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="c1"># Setup sampling for lammps</span>
<span class="n">hyal_settings</span><span class="p">[</span><span class="s1">&#39;sampling_opts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;butadiene&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;template&#39;</span><span class="p">:</span> <span class="s1">&#39;templates/lammps.inp&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hyal</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># To avoid creating new geometries in make_initial_set! </span>

<span class="n">xyz</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;10</span>

<span class="s1">C -1.740318000000 0.430948000000 0.064642000000</span>
<span class="s1">C -0.619681000000 -0.116079000000 0.467558000000</span>
<span class="s1">C 0.614285000000 0.118481000000 -0.245832000000</span>
<span class="s1">C 1.751101000000 -0.426794000000 0.149549000000</span>
<span class="s1">H -1.827155000000 1.074246000000 -0.797361000000</span>
<span class="s1">H -2.646902000000 0.238204000000 0.616993000000</span>
<span class="s1">H -0.608278000000 -0.746727000000 1.335847000000</span>
<span class="s1">H 0.597431000000 0.752131000000 -1.116548000000</span>
<span class="s1">H 1.799534000000 -1.067288000000 1.019770000000</span>
<span class="s1">H 2.679982000000 -0.257122000000 -0.377925000000&#39;&#39;&#39;</span>
<span class="n">butadiene</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">butadiene_pbc</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">PeriodicSystem</span><span class="p">(</span><span class="n">butadiene</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">]),</span> <span class="n">pbc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">50.0</span><span class="p">)</span>

<span class="n">al</span> <span class="o">=</span> <span class="n">hyal</span><span class="o">.</span><span class="n">ActiveLearning</span><span class="p">(</span><span class="n">ml_engines</span><span class="o">=</span><span class="p">[</span><span class="n">deepmd_engine</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">calculator</span><span class="o">=</span><span class="n">xtb_data_point</span><span class="p">,</span>
                         <span class="n">sampler</span><span class="o">=</span><span class="n">lammps_engine</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="n">initial_set</span><span class="o">=</span><span class="n">al</span><span class="o">.</span><span class="n">make_initial_set</span><span class="p">({</span>
        <span class="s1">&#39;butadiene_pbc&#39;</span><span class="p">:</span> <span class="n">butadiene_pbc</span><span class="p">,</span>
    <span class="p">},</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">sub_dir</span><span class="o">=</span><span class="n">xtb_wrk</span><span class="o">+</span><span class="s1">&#39;/al_results/&#39;</span><span class="p">)</span>

<span class="n">initial_ds</span><span class="o">=</span><span class="n">al</span><span class="o">.</span><span class="n">generate_dataset</span><span class="p">(</span><span class="n">xtb_wrk</span><span class="o">+</span><span class="s1">&#39;/al_results/initial_set/butadiene_pbc&#39;</span><span class="p">)</span> 

<span class="n">dpdata</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">initial_ds</span><span class="p">)</span>
<span class="c1">#dpdata.dump_data(data_dir=&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/deepmd/iter_0/mlp/dataset_DeepMD/butadiene_pbc&#39;)</span>

<span class="c1"># For this call to work, patch hyset/local/runner.py@265 by commenting it out. </span>
<span class="n">results</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">systems</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;butadiene&#39;</span><span class="p">:</span> <span class="n">butadiene</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">hyal_settings</span><span class="p">],</span>
    <span class="n">initial_set</span><span class="o">=</span><span class="n">initial_set</span><span class="p">,</span> 
    <span class="n">run_opt</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span> <span class="n">xtb_wrk</span><span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEBUG: (one of) output file(s) [PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b.out&#39;), PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b.out&#39;), PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b.stderr&#39;)] exists
DEBUG: and will *not* be overwritten
DEBUG: QUICK RETURN: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b.out&#39;), output_folder=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/678b0ee6d547106007ea0ae889549cb05c08b0e50a7c0c4a1020b6b0dd48149b&#39;), stdout=None, stderr=None, returncode=None, error=None)
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb
DEBUG: removing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15/xtbrestart
DEBUG: writing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15.xyz with content
 10
Lattice = &quot;50.0 0.0 0.0 0.0 50.0 0.0 0.0 0.0 50.0&quot; Properties=species:S:1:pos:R:3 pbc=&quot;T T T&quot;
C 8.238045692443848 10.359274864196777 10.118163108825684
C 9.327064514160156 9.794961929321289 10.768964767456055
C 10.455530166625977 10.354304313659668 9.64173412322998
C 11.41665267944336 9.614789962768555 10.034067153930664
H 8.267404556274414 10.836565971374512 9.48583984375
H 7.406056880950928 10.258870124816895 10.655714988708496
H 9.335759162902832 9.203259468078613 11.223564147949219
H 10.346715927124023 10.749551773071289 9.194502830505371
H 11.734580039978027 8.940550804138184 10.861974716186523
H 12.736474990844727 10.132061004638672 9.763556480407715

DEBUG: RUNNING conda run -n hsp_al xtb fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15.xyz --grad
DEBUG: IN FOLDER /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/simenreine/miniconda3/envs/hsp_2024/lib/python3.10/site-packages/hyset/local/runner.py:299: UserWarning: normal termination of xtb
Note: The following floating-point exceptions are signalling: IEEE_DENORMAL


  warnings.warn(result.stderr)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEBUG: RESULTS: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15.out&#39;), output_folder=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15&#39;), stdout=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15/fcb37a880d122b90abef095701642e11694ccb11316c1e602c40b358cf583e15.out&#39;), stderr=&#39;normal termination of xtb\nNote: The following floating-point exceptions are signalling: IEEE_DENORMAL\n\n&#39;, returncode=0, error=None)
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb
DEBUG: removing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b/xtbrestart
DEBUG: writing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b.xyz with content
 10
Lattice = &quot;50.0 0.0 0.0 0.0 50.0 0.0 0.0 0.0 50.0&quot; Properties=species:S:1:pos:R:3 pbc=&quot;T T T&quot;
C 8.41935920715332 10.773401260375977 9.669677734375
C 9.125576972961426 10.140214920043945 10.420881271362305
C 10.513431549072266 10.071227073669434 9.648004531860352
C 11.577698707580566 9.426182746887207 10.122920036315918
H 8.198987007141113 10.91878604888916 9.362800598144531
H 7.339448928833008 10.382088661193848 10.601678848266602
H 9.314910888671875 9.520941734313965 11.503807067871094
H 10.516983032226562 10.794023513793945 8.929019927978516
H 11.899507522583008 8.679237365722656 11.066045761108398
H 12.55025577545166 9.954501152038574 9.455048561096191

DEBUG: RUNNING conda run -n hsp_al xtb 6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b.xyz --grad
DEBUG: IN FOLDER /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/simenreine/miniconda3/envs/hsp_2024/lib/python3.10/site-packages/hyset/local/runner.py:299: UserWarning: normal termination of xtb
Note: The following floating-point exceptions are signalling: IEEE_DENORMAL


  warnings.warn(result.stderr)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEBUG: RESULTS: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b.out&#39;), output_folder=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b&#39;), stdout=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b/6bf68d10155325b9280725f94d749fc801cdf4da4b68cb65038c623143e6326b.out&#39;), stderr=&#39;normal termination of xtb\nNote: The following floating-point exceptions are signalling: IEEE_DENORMAL\n\n&#39;, returncode=0, error=None)
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb
DEBUG: removing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9/xtbrestart
DEBUG: writing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9.xyz with content
 10
Lattice = &quot;50.0 0.0 0.0 0.0 50.0 0.0 0.0 0.0 50.0&quot; Properties=species:S:1:pos:R:3 pbc=&quot;T T T&quot;
C 8.36904525756836 10.403158187866211 10.014686584472656
C 9.739444732666016 10.109085083007812 10.618033409118652
C 10.897619247436523 10.028630256652832 9.922347068786621
C 11.831119537353516 9.512948036193848 10.074565887451172
H 8.059480667114258 10.99179458618164 9.282044410705566
H 7.511412620544434 10.604574203491211 10.062356948852539
H 9.615549087524414 9.299604415893555 11.716076850891113
H 10.610769271850586 10.507948875427246 8.677387237548828
H 11.683083534240723 9.097978591918945 11.215400695800781
H 12.410738945007324 9.641155242919922 9.522368431091309

DEBUG: RUNNING conda run -n hsp_al xtb de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9.xyz --grad
DEBUG: IN FOLDER /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/simenreine/miniconda3/envs/hsp_2024/lib/python3.10/site-packages/hyset/local/runner.py:299: UserWarning: normal termination of xtb
Note: The following floating-point exceptions are signalling: IEEE_DENORMAL


  warnings.warn(result.stderr)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEBUG: RESULTS: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9.out&#39;), output_folder=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9&#39;), stdout=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9/de0a871bcbd861869354f99bb03b72b0f35ec66f0601d853c951d7cc4b4ecae9.out&#39;), stderr=&#39;normal termination of xtb\nNote: The following floating-point exceptions are signalling: IEEE_DENORMAL\n\n&#39;, returncode=0, error=None)
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc
DEBUG: creating directory /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb
DEBUG: removing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872/xtbrestart
DEBUG: writing file /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872.xyz with content
 10
Lattice = &quot;50.0 0.0 0.0 0.0 50.0 0.0 0.0 0.0 50.0&quot; Properties=species:S:1:pos:R:3 pbc=&quot;T T T&quot;
C 7.97634744644165 10.351028442382812 10.139012336730957
C 9.230339050292969 9.849382400512695 10.35500717163086
C 10.720078468322754 9.906606674194336 10.044753074645996
C 11.61330509185791 10.114483833312988 10.162541389465332
H 7.910958290100098 11.053247451782227 8.983976364135742
H 7.593679428100586 10.199003219604492 10.762138366699219
H 9.473149299621582 9.305700302124023 11.428033828735352
H 10.260178565979004 10.572774887084961 8.673725128173828
H 12.028903007507324 8.80408000946045 10.994484901428223
H 12.63789176940918 9.830543518066406 9.872652053833008

DEBUG: RUNNING conda run -n hsp_al xtb 7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872.xyz --grad
DEBUG: IN FOLDER /Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/simenreine/miniconda3/envs/hsp_2024/lib/python3.10/site-packages/hyset/local/runner.py:299: UserWarning: normal termination of xtb
Note: The following floating-point exceptions are signalling: IEEE_DENORMAL


  warnings.warn(result.stderr)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEBUG: RESULTS: LocalResult(files_to_parse=[], output_file=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872.out&#39;), output_folder=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872&#39;), stdout=PosixPath(&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/xtb/al_results/initial_set/butadiene_pbc/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872/7a152600d17c66caede2be41f52631b6b6f5e33e53f1d9573baf4e50e3dad872.out&#39;), stderr=&#39;normal termination of xtb\nNote: The following floating-point exceptions are signalling: IEEE_DENORMAL\n\n&#39;, returncode=0, error=None)
could not find either input or output files
could not find either input or output files
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">line</span> <span class="mi">30</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="n">initial_set</span><span class="o">=</span><span class="n">al</span><span class="o">.</span><span class="n">make_initial_set</span><span class="p">({</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>         <span class="s1">&#39;butadiene_pbc&#39;</span><span class="p">:</span> <span class="n">butadiene_pbc</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="p">},</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">sub_dir</span><span class="o">=</span><span class="n">xtb_wrk</span><span class="o">+</span><span class="s1">&#39;/al_results/&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="n">initial_ds</span><span class="o">=</span><span class="n">al</span><span class="o">.</span><span class="n">generate_dataset</span><span class="p">(</span><span class="n">xtb_wrk</span><span class="o">+</span><span class="s1">&#39;/al_results/initial_set/butadiene_pbc&#39;</span><span class="p">)</span> 
<span class="ne">---&gt; </span><span class="mi">30</span> <span class="n">dpdata</span> <span class="o">=</span> <span class="n">deepmd_engine</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">initial_ds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="c1">#dpdata.dump_data(data_dir=&#39;/Users/simenreine/HSP/hylleraas/docs/src/active_learning/wrk_pbc/deepmd/iter_0/mlp/dataset_DeepMD/butadiene_pbc&#39;)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> 
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="c1"># For this call to work, patch hyset/local/runner.py@265 by commenting it out. </span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="n">results</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span>     <span class="n">systems</span><span class="o">=</span><span class="p">{</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>         <span class="s1">&#39;butadiene&#39;</span><span class="p">:</span> <span class="n">butadiene</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="n">run_opt</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span> <span class="n">xtb_wrk</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/hsp_2024/lib/python3.10/functools.py:926,</span> in <span class="ni">singledispatchmethod.__get__.&lt;locals&gt;._method</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">924</span> <span class="k">def</span><span class="w"> </span><span class="nf">_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">925</span>     <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">926</span>     <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/hsp_2024/lib/python3.10/site-packages/hyif/machinelearning/deepmd/src/deepmd.py:140,</span> in <span class="ni">DeepMD.get_data</span><span class="nt">(self, data, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span> <span class="nd">@singledispatchmethod</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeepMDData</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Get data from input.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">140</span>     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;data must be a DeepMDData, a DataSet, dict or a path&#39;</span><span class="p">)</span>

<span class="ne">TypeError</span>: data must be a DeepMDData, a DataSet, dict or a path
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_ds</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">generate_dataset</span><span class="p">(</span><span class="n">xtb_wrk</span><span class="o">+</span><span class="s1">&#39;/al_results/initial_set/butadiene_pbc&#39;</span><span class="p">)</span> 
<span class="n">deepmd_engine</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">initial_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hylleraas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span>
    <span class="s2">&quot;conda&quot;</span><span class="p">,</span>
    <span class="n">conda_env</span><span class="o">=</span><span class="s2">&quot;conda_xtb&quot;</span><span class="p">,</span>
    <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">xtb</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="n">compute_settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">water</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>

<span class="n">xtb</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span><span class="s1">&#39;sub&#39;</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb&quot;</span><span class="p">)</span>

<span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb&quot;</span> <span class="o">/</span> <span class="s2">&quot;sub&quot;</span>
<span class="c1">#data_dir = xtb_wrk + &#39;/reference&#39;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span>
    <span class="n">data_dir</span><span class="p">,</span>
    <span class="n">parser</span><span class="o">=</span><span class="n">xtb</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">,</span>
    <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">match</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.out&quot;</span><span class="p">],</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">ds</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_path</span><span class="o">=</span><span class="n">xtb_wrk</span> <span class="o">+</span> <span class="s1">&#39;/reference&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reference_path</span><span class="p">)</span>
<span class="n">reference</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">reference_path</span><span class="p">,</span>
                        <span class="n">parser</span><span class="o">=</span><span class="n">xtb_data_point</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">,</span>
                        <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">match</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*.out&#39;</span><span class="p">],</span>
                        <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient&#39;</span><span class="p">],</span>
                        <span class="n">units</span><span class="o">=</span><span class="n">xtb_data_point</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

<span class="n">reference</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hylleraas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span>
    <span class="s2">&quot;conda&quot;</span><span class="p">,</span>
    <span class="n">conda_env</span><span class="o">=</span><span class="s2">&quot;conda_xtb&quot;</span><span class="p">,</span>
    <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">xtb</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="n">compute_settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">water</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>

<span class="n">xtb</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb&quot;</span><span class="p">)</span>

<span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb&quot;</span>
<span class="c1">#data_dir = xtb_wrk + &#39;/reference&#39;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span>
    <span class="n">data_dir</span><span class="p">,</span>
    <span class="n">parser</span><span class="o">=</span><span class="n">xtb</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">,</span>
    <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">match</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.out&quot;</span><span class="p">],</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">ds</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hylleraas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># This debug varaible is used throughout. For the final version simply turn off the debug </span>
<span class="c1"># option, but it might come handy when setting up and testing the code -- to more easily </span>
<span class="c1"># understand why the code fails in certain steps</span>

<span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">xtb_wrk</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/new_wrk&#39;</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span>
    <span class="s2">&quot;conda&quot;</span><span class="p">,</span>
    <span class="n">conda_env</span><span class="o">=</span><span class="s2">&quot;conda_xtb&quot;</span><span class="p">,</span>
    <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="o">=</span><span class="n">xtb_wrk</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># XTB for geometry optimizations</span>
<span class="n">xtb_geo</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry_optimization&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient&#39;</span><span class="p">]},</span> <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">)</span>

<span class="c1"># XTB for single point calaculations of the energy and gradient</span>
<span class="n">xtb_data</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">({</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient&#39;</span><span class="p">]},</span> <span class="n">compute_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">)</span>

<span class="n">butadiene</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s1">&#39;C=C-C=C&#39;</span><span class="p">)</span>

<span class="n">result1</span> <span class="o">=</span> <span class="n">xtb_geo</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;xtb&#39;</span><span class="p">})</span>
<span class="n">butadiene</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">result1</span><span class="p">[</span><span class="s1">&#39;final_geometry&#39;</span><span class="p">]</span>

<span class="n">cis_butadiene</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;10</span>

<span class="s1">C -1.400150994841 0.478261820795 0.653083308889</span>
<span class="s1">C -0.812338402479 -0.485323350903 -0.046430688156</span>
<span class="s1">C 0.584996434273 -0.511370269276 -0.451098308709</span>
<span class="s1">C 1.559580367935 0.220696578716 0.075783220254</span>
<span class="s1">H -0.867416026674 1.355029383734 0.979605859109</span>
<span class="s1">H -2.442852127711 0.429878660025 0.916297784711</span>
<span class="s1">H -1.400778838995 -1.332818613746 -0.376026609302</span>
<span class="s1">H 0.820069874536 -1.213078365816 -1.241977606761</span>
<span class="s1">H 1.384366514399 0.911344527785 0.882907991820</span>
<span class="s1">H 2.574522199558 0.147379628686 -0.275451951853&#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">result2</span> <span class="o">=</span> <span class="n">xtb_geo</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">,</span> <span class="n">run_opt</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sub_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;xtb&#39;</span><span class="p">})</span>

<span class="n">cis_butadiene</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">result2</span><span class="p">[</span><span class="s1">&#39;final_geometry&#39;</span><span class="p">]</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">butadiene</span><span class="p">);</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">cis_butadiene</span><span class="p">);</span>

<span class="nb">print</span><span class="p">(</span><span class="n">butadiene</span><span class="o">.</span><span class="n">coordinates</span><span class="o">-</span><span class="n">cis_butadiene</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "hsp_2024"
        },
        kernelOptions: {
            name: "hsp_2024",
            path: "./src/active_learning"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'hsp_2024'</script>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-butadiene-and-setting-up-a-reference">Exploring butadiene and setting up a reference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#passive-learning">Passive learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#active-learning">Active Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sampler">Sampler</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ml-model">ML model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculator">Calculator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#al-model">AL model</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/src/active_learning/Active_learning.ipynb">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item"><p align="left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" height="20px"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M72 88a56 56 0 1 1 112 0A56 56 0 1 1 72 88zM64 245.7C54 256.9 48 271.8 48 288s6 31.1 16 42.3V245.7zm144.4-49.3C178.7 222.7 160 261.2 160 304c0 34.3 12 65.8 32 90.5V416c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V389.2C26.2 371.2 0 332.7 0 288c0-61.9 50.1-112 112-112h32c24 0 46.2 7.5 64.4 20.3zM448 416V394.5c20-24.7 32-56.2 32-90.5c0-42.8-18.7-81.3-48.4-107.7C449.8 183.5 472 176 496 176h32c61.9 0 112 50.1 112 112c0 44.7-26.2 83.2-64 101.2V416c0 17.7-14.3 32-32 32H480c-17.7 0-32-14.3-32-32zm8-328a56 56 0 1 1 112 0A56 56 0 1 1 456 88zM576 245.7v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM320 32a64 64 0 1 1 0 128 64 64 0 1 1 0-128zM240 304c0 16.2 6 31 16 42.3V261.7c-10 11.3-16 26.1-16 42.3zm144-42.3v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM448 304c0 44.7-26.2 83.2-64 101.2V448c0 17.7-14.3 32-32 32H288c-17.7 0-32-14.3-32-32V405.2c-37.8-18-64-56.5-64-101.2c0-61.9 50.1-112 112-112h32c61.9 0 112 50.1 112 112z"/></svg>
    <a href="../footer/about_us.html">About us</a>
</p>
<p align="left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 230 203" height="20px"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M212.55,102.07c0,28.44-10.74,49.54-27.89,49.54s-37.27-22.68-37.27-49.54,20.13-49.54,37.27-49.54,27.89,21.1,27.89,49.54 M19.06,102.07c0-50.49,19.07-87.95,49.5-87.95s66.17,40.26,66.17,87.95-35.73,87.95-66.17,87.95-49.5-37.46-49.5-87.95"/></svg>
    <a href="https://www.mn.uio.no/hylleraas/english/")>The Hylleraas Centre</a>
</p>
<p align="left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="20px"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M448 296c0 66.3-53.7 120-120 120h-8c-17.7 0-32-14.3-32-32s14.3-32 32-32h8c30.9 0 56-25.1 56-56v-8H320c-35.3 0-64-28.7-64-64V160c0-35.3 28.7-64 64-64h64c35.3 0 64 28.7 64 64v32 32 72zm-256 0c0 66.3-53.7 120-120 120H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h8c30.9 0 56-25.1 56-56v-8H64c-35.3 0-64-28.7-64-64V160c0-35.3 28.7-64 64-64h64c35.3 0 64 28.7 64 64v32 32 72z"/></svg>
    <a href="../footer/citing.html">Citing the Hylleraas Software Platform</a>
</p></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>