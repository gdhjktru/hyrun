
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DataSet &#8212; Hylleraas Software Platform</title>



  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />


  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'src/user_guide/dataset';</script>
    <link rel="icon" href="../../_static/hylleraas---logo---only.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>


  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">



  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>

  <div id="pst-scroll-pixel-helper"></div>

  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>


  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>

  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>

  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>


    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>


  <div class="col-lg-3 navbar-header-items__start">

      <div class="navbar-item">





<a class="navbar-brand logo" href="../index.html">










    <img src="../../_static/hsp---logo.png" class="logo__image only-light" alt="Hylleraas Software Platform - Home"/>
    <script>document.write(`<img src="../../_static/hsp---logo---neg.png" class="logo__image only-dark" alt="Hylleraas Software Platform - Home"/>`);</script>


</a></div>

  </div>

  <div class="col-lg-9 navbar-header-items">

    <div class="me-auto navbar-header-items__center">

        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">

  </ul>
</nav></div>

    </div>


    <div class="navbar-header-items__end">

        <div class="navbar-item navbar-persistent--container">


 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>


        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>

    </div>

  </div>


    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>



    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>

</div>

    </header>


  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">





      <div class="bd-sidebar-primary bd-sidebar">



  <div class="sidebar-header-items sidebar-primary__section">


      <div class="sidebar-header-items__center">



            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">

  </ul>
</nav></div>


      </div>



      <div class="sidebar-header-items__end">

          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>

      </div>

  </div>

    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><div class="sidebar-header-item">
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
            <nav class="bd-docs-nav bd-links">
                <ul class="nav bd-sidenav">
                    <li class="toctree-l1">
                        <a class="reference internal" href="user_guide.html">
                            User Guide
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div></div>
    </div>


  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>

  <div id="rtd-footer-container"></div>


      </div>

      <main id="main-content" class="bd-main" role="main">


          <div class="bd-content">
            <div class="bd-article-container">

              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">

    <div class="header-article-items__start">

        <div class="header-article-item">
<div class="prev-next-area">
</div></div>

    </div>


    <div class="header-article-items__end">

        <div class="header-article-item">
<div class="prev-next-area">
</div></div>

    </div>

</div>
</div>




<div id="searchbox"></div>
                <article class="bd-article">

  <section class="tex2jax_ignore mathjax_ignore" id="dataset">
<h1>DataSet<a class="headerlink" href="#dataset" title="Link to this heading">#</a></h1>
<p>The Hylleraas Software Platform (HSP) <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> object is a container used for storing and manipulating chemical simulation data. Both in terms of input information <em>for</em> simulations, such as chemical structures and molecular geometries, and output information <em>from</em> simulations, such as energies, gradients, and other properties.</p>
<p>The HSP <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> wraps and extends the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object, providing a number of additional features and methods for working with chemical simulation data.</p>
<p>In the following tutorial, we will consider (a subset of) the <a class="reference external" href="https://www.nature.com/articles/sdata201422">QM9 dataset</a>, performing xTB calculations and comparing the results to the reference data. We will demonstrate how to use the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> object to store and manipulate the data, and how the simulations can be run on supercomputing clusters.</p>
<p><a id='install_note'></a></p>
<div class="admonition-note admonition">
<p class="admonition-title">Note</p>
<p>This guide requires the <em>Hylleraas Software Platform</em> to be installed. Please refer to <a class="reference internal" href="../installation/installation.html#installation"><span class="std std-ref">Installation</span></a> for information about how to install the HSP.</p>
<p>This guide also requires the xTB software to be installed. Please refer to <a class="reference internal" href="../installation/quantum_chemistry_codes.html#quantum-chemistry-codes"><span class="std std-ref">Quantum chemistry codes</span></a> for information about how to install xTB.</p>
<p>Normally, <strong>all</strong> necessary software for this tutorial may be installed by running the following commands in the terminal:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://gitlab.com/hylleraasplatform/hylleraas.git
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>ipywidgets<span class="w"> </span>numpy<span class="w"> </span>matplotlib<span class="w"> </span>pandas

conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>conda_xtb
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>-n<span class="w"> </span>conda_xtb<span class="w"> </span>xtb
</pre></div>
</div>
</div></blockquote>
<p>In order to execute the part of this guide which pertains to running calculations on remote supercomputing clusters, you will need to have access to a server on which xTB is installed (or install it yourself <em>on</em> the server).</p>
</div>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<p>First, we will download the QM9 dataset and prepare the data for the tutorial. The QM9 dataset is a large dataset of small organic molecules, containing about 134 000 molecules and 19 properties for each molecule. We will use a subset of the dataset containing 100 molecules.</p>
<p>To download the QM9 dataset in .CSV format, run the following command in the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-L<span class="w"> </span>-o<span class="w"> </span>qm9.csv<span class="w"> </span>https://deepchemdata.s3-us-west-1.amazonaws.com/datasets/qm9.csv
</pre></div>
</div>
</section>
<section id="loading-the-data-our-first-dataset">
<h2>Loading the data: Our first <code class="docutils literal notranslate"><span class="pre">DataSet</span></code><a class="headerlink" href="#loading-the-data-our-first-dataset" title="Link to this heading">#</a></h2>
<p>We will start by loading the QM9 dataset into a <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> object. The HSP <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> can read from .CSV files like any other <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. The QM9 dataset contains data about the following properties for each molecule:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Property Index</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mol_id</span></code></p></td>
<td><p></p></td>
<td><p>The (internal) molecule ID for the dataset</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smiles</span></code></p></td>
<td><p></p></td>
<td><p>The SMILES string representation of the molecule</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">A</span></code></p></td>
<td><p>GHz</p></td>
<td><p>Rotational constant A</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">B</span></code></p></td>
<td><p>GHz</p></td>
<td><p>Rotational constant B</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">C</span></code></p></td>
<td><p>GHz</p></td>
<td><p>Rotational constant C</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mu</span></code></p></td>
<td><p>Bohr<sup>3</sup></p></td>
<td><p>Dipole moment</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p>Bohr<sup>3</sup></p></td>
<td><p>Isotropic polarizability</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">homo</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Energy of the highest occupied molecular orbital</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lumo</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Energy of the lowest unoccupied molecular orbital</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">gap</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Difference between the HOMO and the LUMO</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">r2</span></code></p></td>
<td><p>Bohr<sup>2</sup></p></td>
<td><p>Electonic spatial extent</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">zpve</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Zero point vibrational energy</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u0</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Internal energy at 0 K</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u298</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Internal energy at 298.15 K</p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">h298</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Enthalpy at 298.15 K</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">g298</span></code></p></td>
<td><p>Hartree</p></td>
<td><p>Free energy at 298.15 K</p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cv</span></code></p></td>
<td><p>cal / (mol K)</p></td>
<td><p>Heat capacity at 298.15 K</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u0_atom</span></code></p></td>
<td><p>kcal / mol</p></td>
<td><p>Atomization energy at 0 K</p></td>
</tr>
<tr class="row-even"><td><p>19</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u298_atom</span></code></p></td>
<td><p>kcal / mol</p></td>
<td><p>Atomization energy at 298.15 K</p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">h298_atom</span></code></p></td>
<td><p>kcal / mol</p></td>
<td><p>Atomization enthalpy at 298.15 K</p></td>
</tr>
<tr class="row-even"><td><p>21</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">g298_atom</span></code></p></td>
<td><p>kcal / mol</p></td>
<td><p>Atomization free energy at 298.15 K</p></td>
</tr>
</tbody>
</table>
</div>
<p>Let us load this data into our <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> and inspect it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hylleraas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the dataset from the file qm9.csv</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="s2">&quot;qm9.csv&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">hsp</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="s2">&quot;atomic&quot;</span><span class="p">))</span>

<span class="c1"># Inspect the first few rows of the dataset</span>
<span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>mu</th>
      <th>alpha</th>
      <th>homo</th>
      <th>lumo</th>
      <th>gap</th>
      <th>...</th>
      <th>zpve</th>
      <th>u0</th>
      <th>u298</th>
      <th>h298</th>
      <th>g298</th>
      <th>cv</th>
      <th>u0_atom</th>
      <th>u298_atom</th>
      <th>h298_atom</th>
      <th>g298_atom</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>gdb_1</td>
      <td>C</td>
      <td>157.71180</td>
      <td>157.709970</td>
      <td>157.706990</td>
      <td>0.0000</td>
      <td>13.21</td>
      <td>-0.3877</td>
      <td>0.1171</td>
      <td>0.5048</td>
      <td>...</td>
      <td>0.044749</td>
      <td>-40.478930</td>
      <td>-40.476062</td>
      <td>-40.475117</td>
      <td>-40.498597</td>
      <td>6.469</td>
      <td>-395.999595</td>
      <td>-398.643290</td>
      <td>-401.014647</td>
      <td>-372.471772</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gdb_2</td>
      <td>N</td>
      <td>293.60975</td>
      <td>293.541110</td>
      <td>191.393970</td>
      <td>1.6256</td>
      <td>9.46</td>
      <td>-0.2570</td>
      <td>0.0829</td>
      <td>0.3399</td>
      <td>...</td>
      <td>0.034358</td>
      <td>-56.525887</td>
      <td>-56.523026</td>
      <td>-56.522082</td>
      <td>-56.544961</td>
      <td>6.316</td>
      <td>-276.861363</td>
      <td>-278.620271</td>
      <td>-280.399259</td>
      <td>-259.338802</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gdb_3</td>
      <td>O</td>
      <td>799.58812</td>
      <td>437.903860</td>
      <td>282.945450</td>
      <td>1.8511</td>
      <td>6.31</td>
      <td>-0.2928</td>
      <td>0.0687</td>
      <td>0.3615</td>
      <td>...</td>
      <td>0.021375</td>
      <td>-76.404702</td>
      <td>-76.401867</td>
      <td>-76.400922</td>
      <td>-76.422349</td>
      <td>6.002</td>
      <td>-213.087624</td>
      <td>-213.974294</td>
      <td>-215.159658</td>
      <td>-201.407171</td>
    </tr>
    <tr>
      <th>3</th>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.00000</td>
      <td>35.610036</td>
      <td>35.610036</td>
      <td>0.0000</td>
      <td>16.28</td>
      <td>-0.2845</td>
      <td>0.0506</td>
      <td>0.3351</td>
      <td>...</td>
      <td>0.026841</td>
      <td>-77.308427</td>
      <td>-77.305527</td>
      <td>-77.304583</td>
      <td>-77.327429</td>
      <td>8.574</td>
      <td>-385.501997</td>
      <td>-387.237686</td>
      <td>-389.016047</td>
      <td>-365.800724</td>
    </tr>
    <tr>
      <th>4</th>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.00000</td>
      <td>44.593883</td>
      <td>44.593883</td>
      <td>2.8937</td>
      <td>12.99</td>
      <td>-0.3604</td>
      <td>0.0191</td>
      <td>0.3796</td>
      <td>...</td>
      <td>0.016601</td>
      <td>-93.411888</td>
      <td>-93.409370</td>
      <td>-93.408425</td>
      <td>-93.431246</td>
      <td>6.278</td>
      <td>-301.820534</td>
      <td>-302.906752</td>
      <td>-304.091489</td>
      <td>-288.720028</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<section id="pruning-the-dataset">
<h3>Pruning the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code><a class="headerlink" href="#pruning-the-dataset" title="Link to this heading">#</a></h3>
<p>We will only consider a small subset of the total QM9 data in this tutorial. Both in terms of the number of molecules, <em>and</em> in terms of the number of properties we will consider. We can find the size of the dataset by calling e.g. <code class="docutils literal notranslate"><span class="pre">dataset.shape</span></code> or <code class="docutils literal notranslate"><span class="pre">len(dataset)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># BUG: https://gitlab.com/hylleraasplatform/hyobj/-/blob/main/hyobj/dataset/dataset.py?ref_type=heads#L688</span>
<span class="c1"># TODO: Remove the if test and remove this line when the bug is fixed</span>
<span class="n">ds</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;pandas&quot;</span>

<span class="n">ds</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(200, 21)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
<p>Individual rows of the dataset may be accessed using simple indexing, e.g. <code class="docutils literal notranslate"><span class="pre">dataset[0]</span></code> or <code class="docutils literal notranslate"><span class="pre">dataset[127]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataSet(debug=False, _units=Units({&#39;style&#39;: &#39;atomic&#39;, &#39;mass&#39;: Quantity(unit=&#39;electron_mass&#39;, value=1.0, symbol=&#39;me&#39;), &#39;energy&#39;: Quantity(unit=&#39;hartree&#39;, value=1.0, symbol=&#39;Eh&#39;), &#39;length&#39;: Quantity(unit=&#39;bohr&#39;, value=1.0, symbol=&#39;a0&#39;), &#39;time&#39;: Quantity(unit=&#39;femtoseconds&#39;, value=1.0, symbol=&#39;fs&#39;), &#39;force&#39;: Quantity(unit=&#39;hartree/bohr&#39;, value=1.0, symbol=&#39;Eh/a0&#39;), &#39;hessian&#39;: Quantity(unit=&#39;hartree/bohr**2&#39;, value=1.0, symbol=&#39;Eh/a0**2&#39;)}), data=  mol_id smiles         A          B          C   mu  alpha    homo    lumo  \
0  gdb_1      C  157.7118  157.70997  157.70699  0.0  13.21 -0.3877  0.1171

      gap  ...      zpve        u0       u298       h298       g298     cv  \
0  0.5048  ...  0.044749 -40.47893 -40.476062 -40.475117 -40.498597  6.469

      u0_atom  u298_atom   h298_atom   g298_atom
0 -395.999595 -398.64329 -401.014647 -372.471772

[1 rows x 21 columns], properties={&#39;units&#39;: Units({&#39;style&#39;: &#39;atomic&#39;, &#39;mass&#39;: Quantity(unit=&#39;electron_mass&#39;, value=1.0, symbol=&#39;me&#39;), &#39;energy&#39;: Quantity(unit=&#39;hartree&#39;, value=1.0, symbol=&#39;Eh&#39;), &#39;length&#39;: Quantity(unit=&#39;bohr&#39;, value=1.0, symbol=&#39;a0&#39;), &#39;time&#39;: Quantity(unit=&#39;femtoseconds&#39;, value=1.0, symbol=&#39;fs&#39;), &#39;force&#39;: Quantity(unit=&#39;hartree/bohr&#39;, value=1.0, symbol=&#39;Eh/a0&#39;), &#39;hessian&#39;: Quantity(unit=&#39;hartree/bohr**2&#39;, value=1.0, symbol=&#39;Eh/a0**2&#39;)}), &#39;column_units&#39;: {&#39;mol_id&#39;: None, &#39;smiles&#39;: None, &#39;A&#39;: None, &#39;B&#39;: None, &#39;C&#39;: None, &#39;mu&#39;: None, &#39;alpha&#39;: None, &#39;homo&#39;: None, &#39;lumo&#39;: None, &#39;gap&#39;: None, &#39;r2&#39;: None, &#39;zpve&#39;: None, &#39;u0&#39;: None, &#39;u298&#39;: None, &#39;h298&#39;: None, &#39;g298&#39;: None, &#39;cv&#39;: None, &#39;u0_atom&#39;: None, &#39;u298_atom&#39;: None, &#39;h298_atom&#39;: None, &#39;g298_atom&#39;: None}})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="mi">127</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataSet(debug=False, _units=Units({&#39;style&#39;: &#39;atomic&#39;, &#39;mass&#39;: Quantity(unit=&#39;electron_mass&#39;, value=1.0, symbol=&#39;me&#39;), &#39;energy&#39;: Quantity(unit=&#39;hartree&#39;, value=1.0, symbol=&#39;Eh&#39;), &#39;length&#39;: Quantity(unit=&#39;bohr&#39;, value=1.0, symbol=&#39;a0&#39;), &#39;time&#39;: Quantity(unit=&#39;femtoseconds&#39;, value=1.0, symbol=&#39;fs&#39;), &#39;force&#39;: Quantity(unit=&#39;hartree/bohr&#39;, value=1.0, symbol=&#39;Eh/a0&#39;), &#39;hessian&#39;: Quantity(unit=&#39;hartree/bohr**2&#39;, value=1.0, symbol=&#39;Eh/a0**2&#39;)}), data=      mol_id  smiles         A        B        C      mu  alpha    homo  \
127  gdb_128  CCCC=O  20.60318  2.12564  2.08237  2.7552  47.03 -0.2487

       lumo     gap  ...      zpve         u0        u298        h298  \
127 -0.0195  0.2292  ...  0.112697 -232.36363 -232.357283 -232.356339

          g298      cv      u0_atom    u298_atom    h298_atom    g298_atom
127 -232.39356  20.766 -1198.403511 -1205.974407 -1213.087849 -1117.809392

[1 rows x 21 columns], properties={&#39;units&#39;: Units({&#39;style&#39;: &#39;atomic&#39;, &#39;mass&#39;: Quantity(unit=&#39;electron_mass&#39;, value=1.0, symbol=&#39;me&#39;), &#39;energy&#39;: Quantity(unit=&#39;hartree&#39;, value=1.0, symbol=&#39;Eh&#39;), &#39;length&#39;: Quantity(unit=&#39;bohr&#39;, value=1.0, symbol=&#39;a0&#39;), &#39;time&#39;: Quantity(unit=&#39;femtoseconds&#39;, value=1.0, symbol=&#39;fs&#39;), &#39;force&#39;: Quantity(unit=&#39;hartree/bohr&#39;, value=1.0, symbol=&#39;Eh/a0&#39;), &#39;hessian&#39;: Quantity(unit=&#39;hartree/bohr**2&#39;, value=1.0, symbol=&#39;Eh/a0**2&#39;)}), &#39;column_units&#39;: {&#39;mol_id&#39;: None, &#39;smiles&#39;: None, &#39;A&#39;: None, &#39;B&#39;: None, &#39;C&#39;: None, &#39;mu&#39;: None, &#39;alpha&#39;: None, &#39;homo&#39;: None, &#39;lumo&#39;: None, &#39;gap&#39;: None, &#39;r2&#39;: None, &#39;zpve&#39;: None, &#39;u0&#39;: None, &#39;u298&#39;: None, &#39;h298&#39;: None, &#39;g298&#39;: None, &#39;cv&#39;: None, &#39;u0_atom&#39;: None, &#39;u298_atom&#39;: None, &#39;h298_atom&#39;: None, &#39;g298_atom&#39;: None}})
</pre></div>
</div>
</div>
</div>
<p>Slicing can be used to extract a subset of the <em>rows</em> in the dataset, e.g. <code class="docutils literal notranslate"><span class="pre">dataset[:10]</span></code> or <code class="docutils literal notranslate"><span class="pre">dataset[100:200]</span></code>. Let us use it to take the first 100 molecules from the dataset. This will be our reference data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>mu</th>
      <th>alpha</th>
      <th>homo</th>
      <th>lumo</th>
      <th>gap</th>
      <th>...</th>
      <th>zpve</th>
      <th>u0</th>
      <th>u298</th>
      <th>h298</th>
      <th>g298</th>
      <th>cv</th>
      <th>u0_atom</th>
      <th>u298_atom</th>
      <th>h298_atom</th>
      <th>g298_atom</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>gdb_1</td>
      <td>C</td>
      <td>157.71180</td>
      <td>157.709970</td>
      <td>157.706990</td>
      <td>0.0000</td>
      <td>13.21</td>
      <td>-0.3877</td>
      <td>0.1171</td>
      <td>0.5048</td>
      <td>...</td>
      <td>0.044749</td>
      <td>-40.478930</td>
      <td>-40.476062</td>
      <td>-40.475117</td>
      <td>-40.498597</td>
      <td>6.469</td>
      <td>-395.999595</td>
      <td>-398.643290</td>
      <td>-401.014647</td>
      <td>-372.471772</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gdb_2</td>
      <td>N</td>
      <td>293.60975</td>
      <td>293.541110</td>
      <td>191.393970</td>
      <td>1.6256</td>
      <td>9.46</td>
      <td>-0.2570</td>
      <td>0.0829</td>
      <td>0.3399</td>
      <td>...</td>
      <td>0.034358</td>
      <td>-56.525887</td>
      <td>-56.523026</td>
      <td>-56.522082</td>
      <td>-56.544961</td>
      <td>6.316</td>
      <td>-276.861363</td>
      <td>-278.620271</td>
      <td>-280.399259</td>
      <td>-259.338802</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gdb_3</td>
      <td>O</td>
      <td>799.58812</td>
      <td>437.903860</td>
      <td>282.945450</td>
      <td>1.8511</td>
      <td>6.31</td>
      <td>-0.2928</td>
      <td>0.0687</td>
      <td>0.3615</td>
      <td>...</td>
      <td>0.021375</td>
      <td>-76.404702</td>
      <td>-76.401867</td>
      <td>-76.400922</td>
      <td>-76.422349</td>
      <td>6.002</td>
      <td>-213.087624</td>
      <td>-213.974294</td>
      <td>-215.159658</td>
      <td>-201.407171</td>
    </tr>
    <tr>
      <th>3</th>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.00000</td>
      <td>35.610036</td>
      <td>35.610036</td>
      <td>0.0000</td>
      <td>16.28</td>
      <td>-0.2845</td>
      <td>0.0506</td>
      <td>0.3351</td>
      <td>...</td>
      <td>0.026841</td>
      <td>-77.308427</td>
      <td>-77.305527</td>
      <td>-77.304583</td>
      <td>-77.327429</td>
      <td>8.574</td>
      <td>-385.501997</td>
      <td>-387.237686</td>
      <td>-389.016047</td>
      <td>-365.800724</td>
    </tr>
    <tr>
      <th>4</th>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.00000</td>
      <td>44.593883</td>
      <td>44.593883</td>
      <td>2.8937</td>
      <td>12.99</td>
      <td>-0.3604</td>
      <td>0.0191</td>
      <td>0.3796</td>
      <td>...</td>
      <td>0.016601</td>
      <td>-93.411888</td>
      <td>-93.409370</td>
      <td>-93.408425</td>
      <td>-93.431246</td>
      <td>6.278</td>
      <td>-301.820534</td>
      <td>-302.906752</td>
      <td>-304.091489</td>
      <td>-288.720028</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>gdb_96</td>
      <td>CC1CCO1</td>
      <td>9.93129</td>
      <td>4.563620</td>
      <td>3.637040</td>
      <td>1.6826</td>
      <td>45.72</td>
      <td>-0.2410</td>
      <td>0.0915</td>
      <td>0.3325</td>
      <td>...</td>
      <td>0.114590</td>
      <td>-232.331230</td>
      <td>-232.325877</td>
      <td>-232.324933</td>
      <td>-232.359589</td>
      <td>18.582</td>
      <td>-1178.072219</td>
      <td>-1186.266859</td>
      <td>-1193.380301</td>
      <td>-1096.492284</td>
    </tr>
    <tr>
      <th>96</th>
      <td>gdb_97</td>
      <td>CC1COC1</td>
      <td>10.13697</td>
      <td>4.325120</td>
      <td>3.509120</td>
      <td>1.8995</td>
      <td>45.45</td>
      <td>-0.2419</td>
      <td>0.0814</td>
      <td>0.3233</td>
      <td>...</td>
      <td>0.114694</td>
      <td>-232.325947</td>
      <td>-232.320548</td>
      <td>-232.319604</td>
      <td>-232.354576</td>
      <td>18.443</td>
      <td>-1174.757089</td>
      <td>-1182.922863</td>
      <td>-1190.036306</td>
      <td>-1093.346581</td>
    </tr>
    <tr>
      <th>97</th>
      <td>gdb_98</td>
      <td>C1CC(C1)O</td>
      <td>10.09703</td>
      <td>4.268650</td>
      <td>3.404870</td>
      <td>1.4604</td>
      <td>45.55</td>
      <td>-0.2560</td>
      <td>0.0801</td>
      <td>0.3361</td>
      <td>...</td>
      <td>0.115063</td>
      <td>-232.333258</td>
      <td>-232.328097</td>
      <td>-232.327153</td>
      <td>-232.361103</td>
      <td>19.023</td>
      <td>-1179.344807</td>
      <td>-1187.659929</td>
      <td>-1194.773371</td>
      <td>-1097.442332</td>
    </tr>
    <tr>
      <th>98</th>
      <td>gdb_99</td>
      <td>C1C(CO1)O</td>
      <td>10.85394</td>
      <td>4.528670</td>
      <td>3.623280</td>
      <td>2.4158</td>
      <td>38.58</td>
      <td>-0.2465</td>
      <td>0.0604</td>
      <td>0.3069</td>
      <td>...</td>
      <td>0.091005</td>
      <td>-268.248371</td>
      <td>-268.243234</td>
      <td>-268.242290</td>
      <td>-268.276572</td>
      <td>17.344</td>
      <td>-989.744218</td>
      <td>-996.296667</td>
      <td>-1002.224117</td>
      <td>-921.180074</td>
    </tr>
    <tr>
      <th>99</th>
      <td>gdb_100</td>
      <td>CC1CC1C</td>
      <td>7.14221</td>
      <td>4.370830</td>
      <td>3.302650</td>
      <td>0.1023</td>
      <td>52.92</td>
      <td>-0.2632</td>
      <td>0.0940</td>
      <td>0.3573</td>
      <td>...</td>
      <td>0.137341</td>
      <td>-196.406419</td>
      <td>-196.400340</td>
      <td>-196.399396</td>
      <td>-196.435152</td>
      <td>22.005</td>
      <td>-1361.587226</td>
      <td>-1371.104027</td>
      <td>-1379.403461</td>
      <td>-1267.127041</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 21 columns</p>
</div></div></div>
</div>
</section>
<section id="extracting-certain-columns">
<h3>Extracting certain columns<a class="headerlink" href="#extracting-certain-columns" title="Link to this heading">#</a></h3>
<p>To simplify our tutorial, we will only consider a small number of properties for each molecule. We will remove columns from the dataset pertaining to properties we are not interested in. This can be done using the <code class="docutils literal notranslate"><span class="pre">dataset.drop</span></code> method. We will keep only the <code class="docutils literal notranslate"><span class="pre">mol_id</span></code>, <code class="docutils literal notranslate"><span class="pre">smiles</span></code>, <code class="docutils literal notranslate"><span class="pre">gap</span></code>, and <code class="docutils literal notranslate"><span class="pre">u0</span></code> columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;mol_id&#39;, &#39;smiles&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;mu&#39;, &#39;alpha&#39;, &#39;homo&#39;, &#39;lumo&#39;, &#39;gap&#39;,
       &#39;r2&#39;, &#39;zpve&#39;, &#39;u0&#39;, &#39;u298&#39;, &#39;h298&#39;, &#39;g298&#39;, &#39;cv&#39;, &#39;u0_atom&#39;,
       &#39;u298_atom&#39;, &#39;h298_atom&#39;, &#39;g298_atom&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>mu</th>
      <th>alpha</th>
      <th>homo</th>
      <th>lumo</th>
      <th>gap</th>
      <th>...</th>
      <th>zpve</th>
      <th>u0</th>
      <th>u298</th>
      <th>h298</th>
      <th>g298</th>
      <th>cv</th>
      <th>u0_atom</th>
      <th>u298_atom</th>
      <th>h298_atom</th>
      <th>g298_atom</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>gdb_1</td>
      <td>C</td>
      <td>157.71180</td>
      <td>157.709970</td>
      <td>157.706990</td>
      <td>0.0000</td>
      <td>13.21</td>
      <td>-0.3877</td>
      <td>0.1171</td>
      <td>0.5048</td>
      <td>...</td>
      <td>0.044749</td>
      <td>-40.478930</td>
      <td>-40.476062</td>
      <td>-40.475117</td>
      <td>-40.498597</td>
      <td>6.469</td>
      <td>-395.999595</td>
      <td>-398.643290</td>
      <td>-401.014647</td>
      <td>-372.471772</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gdb_2</td>
      <td>N</td>
      <td>293.60975</td>
      <td>293.541110</td>
      <td>191.393970</td>
      <td>1.6256</td>
      <td>9.46</td>
      <td>-0.2570</td>
      <td>0.0829</td>
      <td>0.3399</td>
      <td>...</td>
      <td>0.034358</td>
      <td>-56.525887</td>
      <td>-56.523026</td>
      <td>-56.522082</td>
      <td>-56.544961</td>
      <td>6.316</td>
      <td>-276.861363</td>
      <td>-278.620271</td>
      <td>-280.399259</td>
      <td>-259.338802</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gdb_3</td>
      <td>O</td>
      <td>799.58812</td>
      <td>437.903860</td>
      <td>282.945450</td>
      <td>1.8511</td>
      <td>6.31</td>
      <td>-0.2928</td>
      <td>0.0687</td>
      <td>0.3615</td>
      <td>...</td>
      <td>0.021375</td>
      <td>-76.404702</td>
      <td>-76.401867</td>
      <td>-76.400922</td>
      <td>-76.422349</td>
      <td>6.002</td>
      <td>-213.087624</td>
      <td>-213.974294</td>
      <td>-215.159658</td>
      <td>-201.407171</td>
    </tr>
    <tr>
      <th>3</th>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.00000</td>
      <td>35.610036</td>
      <td>35.610036</td>
      <td>0.0000</td>
      <td>16.28</td>
      <td>-0.2845</td>
      <td>0.0506</td>
      <td>0.3351</td>
      <td>...</td>
      <td>0.026841</td>
      <td>-77.308427</td>
      <td>-77.305527</td>
      <td>-77.304583</td>
      <td>-77.327429</td>
      <td>8.574</td>
      <td>-385.501997</td>
      <td>-387.237686</td>
      <td>-389.016047</td>
      <td>-365.800724</td>
    </tr>
    <tr>
      <th>4</th>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.00000</td>
      <td>44.593883</td>
      <td>44.593883</td>
      <td>2.8937</td>
      <td>12.99</td>
      <td>-0.3604</td>
      <td>0.0191</td>
      <td>0.3796</td>
      <td>...</td>
      <td>0.016601</td>
      <td>-93.411888</td>
      <td>-93.409370</td>
      <td>-93.408425</td>
      <td>-93.431246</td>
      <td>6.278</td>
      <td>-301.820534</td>
      <td>-302.906752</td>
      <td>-304.091489</td>
      <td>-288.720028</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>gdb_96</td>
      <td>CC1CCO1</td>
      <td>9.93129</td>
      <td>4.563620</td>
      <td>3.637040</td>
      <td>1.6826</td>
      <td>45.72</td>
      <td>-0.2410</td>
      <td>0.0915</td>
      <td>0.3325</td>
      <td>...</td>
      <td>0.114590</td>
      <td>-232.331230</td>
      <td>-232.325877</td>
      <td>-232.324933</td>
      <td>-232.359589</td>
      <td>18.582</td>
      <td>-1178.072219</td>
      <td>-1186.266859</td>
      <td>-1193.380301</td>
      <td>-1096.492284</td>
    </tr>
    <tr>
      <th>96</th>
      <td>gdb_97</td>
      <td>CC1COC1</td>
      <td>10.13697</td>
      <td>4.325120</td>
      <td>3.509120</td>
      <td>1.8995</td>
      <td>45.45</td>
      <td>-0.2419</td>
      <td>0.0814</td>
      <td>0.3233</td>
      <td>...</td>
      <td>0.114694</td>
      <td>-232.325947</td>
      <td>-232.320548</td>
      <td>-232.319604</td>
      <td>-232.354576</td>
      <td>18.443</td>
      <td>-1174.757089</td>
      <td>-1182.922863</td>
      <td>-1190.036306</td>
      <td>-1093.346581</td>
    </tr>
    <tr>
      <th>97</th>
      <td>gdb_98</td>
      <td>C1CC(C1)O</td>
      <td>10.09703</td>
      <td>4.268650</td>
      <td>3.404870</td>
      <td>1.4604</td>
      <td>45.55</td>
      <td>-0.2560</td>
      <td>0.0801</td>
      <td>0.3361</td>
      <td>...</td>
      <td>0.115063</td>
      <td>-232.333258</td>
      <td>-232.328097</td>
      <td>-232.327153</td>
      <td>-232.361103</td>
      <td>19.023</td>
      <td>-1179.344807</td>
      <td>-1187.659929</td>
      <td>-1194.773371</td>
      <td>-1097.442332</td>
    </tr>
    <tr>
      <th>98</th>
      <td>gdb_99</td>
      <td>C1C(CO1)O</td>
      <td>10.85394</td>
      <td>4.528670</td>
      <td>3.623280</td>
      <td>2.4158</td>
      <td>38.58</td>
      <td>-0.2465</td>
      <td>0.0604</td>
      <td>0.3069</td>
      <td>...</td>
      <td>0.091005</td>
      <td>-268.248371</td>
      <td>-268.243234</td>
      <td>-268.242290</td>
      <td>-268.276572</td>
      <td>17.344</td>
      <td>-989.744218</td>
      <td>-996.296667</td>
      <td>-1002.224117</td>
      <td>-921.180074</td>
    </tr>
    <tr>
      <th>99</th>
      <td>gdb_100</td>
      <td>CC1CC1C</td>
      <td>7.14221</td>
      <td>4.370830</td>
      <td>3.302650</td>
      <td>0.1023</td>
      <td>52.92</td>
      <td>-0.2632</td>
      <td>0.0940</td>
      <td>0.3573</td>
      <td>...</td>
      <td>0.137341</td>
      <td>-196.406419</td>
      <td>-196.400340</td>
      <td>-196.399396</td>
      <td>-196.435152</td>
      <td>22.005</td>
      <td>-1361.587226</td>
      <td>-1371.104027</td>
      <td>-1379.403461</td>
      <td>-1267.127041</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 21 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">,</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
        <span class="s2">&quot;homo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lumo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zpve&quot;</span><span class="p">,</span>
        <span class="s2">&quot;u298&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h298&quot;</span><span class="p">,</span>
        <span class="s2">&quot;g298&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;u0_atom&quot;</span><span class="p">,</span>
        <span class="s2">&quot;u298_atom&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h298_atom&quot;</span><span class="p">,</span>
        <span class="s2">&quot;g298_atom&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/js/w1m65s9d371f4z6l71rjgn200000gn/T/ipykernel_21634/209270271.py:1: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  reference.data.drop(
</pre></div>
</div>
</div>
</div>
<p>Inspecting the dataset now shows a more manageable size. This will serve as our reference data for the tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>gap</th>
      <th>u0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>gdb_1</td>
      <td>C</td>
      <td>0.5048</td>
      <td>-40.478930</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gdb_2</td>
      <td>N</td>
      <td>0.3399</td>
      <td>-56.525887</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gdb_3</td>
      <td>O</td>
      <td>0.3615</td>
      <td>-76.404702</td>
    </tr>
    <tr>
      <th>3</th>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.3351</td>
      <td>-77.308427</td>
    </tr>
    <tr>
      <th>4</th>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.3796</td>
      <td>-93.411888</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>gdb_96</td>
      <td>CC1CCO1</td>
      <td>0.3325</td>
      <td>-232.331230</td>
    </tr>
    <tr>
      <th>96</th>
      <td>gdb_97</td>
      <td>CC1COC1</td>
      <td>0.3233</td>
      <td>-232.325947</td>
    </tr>
    <tr>
      <th>97</th>
      <td>gdb_98</td>
      <td>C1CC(C1)O</td>
      <td>0.3361</td>
      <td>-232.333258</td>
    </tr>
    <tr>
      <th>98</th>
      <td>gdb_99</td>
      <td>C1C(CO1)O</td>
      <td>0.3069</td>
      <td>-268.248371</td>
    </tr>
    <tr>
      <th>99</th>
      <td>gdb_100</td>
      <td>CC1CC1C</td>
      <td>0.3573</td>
      <td>-196.406419</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 4 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="dataset-objects-and-hsp-calculations">
<h2><code class="docutils literal notranslate"><span class="pre">DataSet</span></code> objects and HSP calculations<a class="headerlink" href="#dataset-objects-and-hsp-calculations" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> object is a powerful tool for working with chemical simulation data. It can be used to handle running of large numbers of simulations, and to store the results of these simulations.</p>
<p>In order to run simulations with the Hylleraas Software Platform (HSP), we first need to create <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> objects repsenting a single molecule. We can create molecules from each row in the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> using the <code class="docutils literal notranslate"><span class="pre">DataSet.systems()</span></code>. This will return a list of <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> objects, one for each row in the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: https://gitlab.com/hylleraasplatform/hyobj/-/blob/main/hyobj/dataset/dataset.py?ref_type=heads#L322-390</span>
<span class="c1"># TODO: Support SMILES string generation in hyobj.DataSet.systems</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>


<span class="k">def</span><span class="w"> </span><span class="nf">systems</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">_units</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get molecules from DataSet.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hyobj</span><span class="w"> </span><span class="kn">import</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">PeriodicSystem</span>

    <span class="n">unit_cell_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unit_cell&#39;</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;cells&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="s1">&#39;pbc&#39;</span><span class="p">]</span>
    <span class="n">coordinates_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;coordinates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;coords&#39;</span><span class="p">,</span>
        <span class="s1">&#39;coord&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pos&#39;</span><span class="p">,</span>
        <span class="s1">&#39;positions&#39;</span><span class="p">,</span>
        <span class="s1">&#39;position&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">atoms_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;atoms&#39;</span><span class="p">,</span>
        <span class="s1">&#39;atom&#39;</span><span class="p">,</span>
        <span class="s1">&#39;species&#39;</span><span class="p">,</span>
        <span class="s1">&#39;species_labels&#39;</span><span class="p">,</span>
        <span class="s1">&#39;species_label&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">smiles_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;smiles&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SMILES&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">systems</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># columns = self.data.columns</span>

    <span class="n">smiles_key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">smiles_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">smiles_key</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">if</span> <span class="n">smiles_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Molecule</span><span class="p">(</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">smiles_key</span><span class="p">],</span>
                    <span class="n">units</span><span class="o">=</span><span class="n">_units</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">systems</span>

    <span class="n">atoms_key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">atoms_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">atoms_key</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">atoms_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;could not find atoms key&#39;</span><span class="p">)</span>

    <span class="n">coordinates_key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">coordinates_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">coordinates_key</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">coordinates_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;could not find coordinates key&#39;</span><span class="p">)</span>

    <span class="n">unit_cell_key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unit_cell_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">unit_cell_key</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">break</span>


    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">coordinates_key</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">atoms_key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unit_cell_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unit_cell</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">unit_cell_key</span><span class="p">]</span>
            <span class="n">systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">PeriodicSystem</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;atoms&#39;</span><span class="p">:</span> <span class="n">atoms</span><span class="p">,</span>
                        <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">,</span>
                        <span class="s1">&#39;pbc&#39;</span><span class="p">:</span> <span class="n">unit_cell</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">units</span><span class="o">=</span><span class="n">_units</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Molecule</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
                    <span class="p">{</span><span class="s1">&#39;atoms&#39;</span><span class="p">:</span> <span class="n">atoms</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">},</span>
                    <span class="n">units</span><span class="o">=</span><span class="n">_units</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">systems</span>


<span class="n">reference</span><span class="o">.</span><span class="n">systems_</span> <span class="o">=</span> <span class="n">systems</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># BUG: Cannot create Molecule object with units for any other choice than &quot;angstrom&quot;</span>
<span class="c1"># TODO: Fix https://gitlab.com/hylleraasplatform/hyobj/-/issues/9</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">hsp</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="s2">&quot;atomic&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [42],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># BUG: Cannot create Molecule object with units for any other choice than &quot;angstrom&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># TODO: Fix https://gitlab.com/hylleraasplatform/hyobj/-/issues/9</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">mol</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">hsp</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="s2">&quot;atomic&quot;</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/hyobj/molecule/molecule.py:184,</span> in <span class="ni">Molecule.__init__</span><span class="nt">(self, molecule, filetype, properties, units, optimize_smiles, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>     <span class="k">if</span> <span class="n">mol_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">!=</span> <span class="n">Units</span><span class="p">(</span><span class="n">mol_units</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">184</span>             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>                 <span class="s1">&#39;units changed, properties might be &#39;</span> <span class="o">+</span> <span class="s1">&#39;inconsistent&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>     <span class="c1"># try to infer unit from molecule_constructor</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>     <span class="k">if</span> <span class="n">mol_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">TypeError</span>: units changed, properties might be inconsistent
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecules</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">systems_</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [23],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">molecules</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">systems_</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>

<span class="nn">Input In [22],</span> in <span class="ni">systems</span><span class="nt">(columns, data, _units)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span> <span class="k">if</span> <span class="n">smiles_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>         <span class="n">systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="ne">---&gt; </span><span class="mi">42</span>             <span class="n">Molecule</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>                 <span class="n">row</span><span class="p">[</span><span class="n">smiles_key</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span>                 <span class="n">units</span><span class="o">=</span><span class="n">_units</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>             <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>         <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="k">return</span> <span class="n">systems</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> <span class="n">atoms_key</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/hyobj/molecule/molecule.py:184,</span> in <span class="ni">Molecule.__init__</span><span class="nt">(self, molecule, filetype, properties, units, optimize_smiles, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>     <span class="k">if</span> <span class="n">mol_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">!=</span> <span class="n">Units</span><span class="p">(</span><span class="n">mol_units</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">184</span>             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>                 <span class="s1">&#39;units changed, properties might be &#39;</span> <span class="o">+</span> <span class="s1">&#39;inconsistent&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>     <span class="c1"># try to infer unit from molecule_constructor</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>     <span class="k">if</span> <span class="n">mol_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">TypeError</span>: units changed, properties might be inconsistent
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: Remove when previous cell works after https://gitlab.com/hylleraasplatform/hyobj/-/issues/10 is fixed.</span>

<span class="n">molecules</span> <span class="o">=</span> <span class="p">[</span><span class="n">hsp</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;smiles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<section id="visualizing-molecules">
<h3>Visualizing <code class="docutils literal notranslate"><span class="pre">Molecule</span></code>s<a class="headerlink" href="#visualizing-molecules" title="Link to this heading">#</a></h3>
<p>We can now inspect the starting structure generated from the SMILES strings in the dataset. We can use the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> object to visualize the structure of the molecule, and to inspect the SMILES string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="mi">27</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_17105208925273302"  style="position: relative; width: 640px; height: 400px;">
        <p id="3dmolwarning_17105208925273302" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_17105208925273302 = null;
var warn = document.getElementById("3dmolwarning_17105208925273302");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_17105208925273302 = $3Dmol.createViewer(document.getElementById("3dmolviewer_17105208925273302"),{backgroundColor:"white"});
viewer_17105208925273302.zoomTo();
	viewer_17105208925273302.clear();
	viewer_17105208925273302.addModel("6\n\nC -0.711492000000 -0.111467000000 0.050782000000\nO -1.530759000000 0.841060000000 0.021161000000\nC 0.730726000000 0.096954000000 -0.050725000000\nO 1.558884000000 -0.832974000000 -0.023484000000\nH -1.153625000000 -1.090871000000 0.156519000000\nH 1.106266000000 1.097298000000 -0.154255000000\n","xyz");
		viewer_17105208925273302.getModel().setStyle({"stick": {"radius": 0.1}, "sphere": {"scale": 0.25}});
	viewer_17105208925273302.setBackgroundColor("#17d9ff");
	viewer_17105208925273302.zoomTo();
viewer_17105208925273302.render();
});
</script></div><div class="output text_html"><script>
            $3Dmolpromise.then(function() { //wrap in promise for non-interactive functionality

                viewer_17105208925273302.render();
            });
            </script></div></div>
</div>
<p>Some <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> magic can get us an interactive viewer for the molecules in the reference dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">interactive_show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="n">hsp</span><span class="o">.</span><span class="n">view_molecule</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

<span class="n">play</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">slider</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_value_change</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="n">slider</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_value_change</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">ipywidgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="n">play</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>
<span class="n">ipywidgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">interactive_show</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">play</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b86cc151ba3c40d2b481042ee66df932", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "1a05644f42e44b46b76ce85bf234eb24", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="removing-certain-rows">
<h3>Removing certain rows<a class="headerlink" href="#removing-certain-rows" title="Link to this heading">#</a></h3>
<p>In order to ease the molecule identification later on, we will keep only molecules in the reference dataset which correspond to unique atomic compositions. For example, QM9 index 11: <a class="reference external" href="https://en.wikipedia.org/wiki/Acetaldehyde">Acetaldehyde</a> (SMILES string: <code class="docutils literal notranslate"><span class="pre">CC=O</span></code>) and QM9 index 17: <a class="reference external" href="https://en.wikipedia.org/wiki/Ethylene_oxide">Ethylene oxide</a> (SMILES string: <code class="docutils literal notranslate"><span class="pre">C1CO1</span></code>) both share the chemical formula C<sub>2</sub>H<sub>4</sub>O. Although they represent different molecules, we will keep only one of them in our reference dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: https://gitlab.com/hylleraasplatform/hyobj/-/blob/main/hyobj/dataset/dataset.py?ref_type=heads#L836-909</span>
<span class="c1"># TODO: Update get_duplicates to handle lists with different lengths</span>
<span class="c1"># </span>
<span class="c1"># BUG: Does not handle dataframes with non-contiguous indices, i.e. after </span>
<span class="c1"># BUG: dropping duplicate rows once, this will fail</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_duplicates</span><span class="p">(</span>
    <span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-05</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get duplicates in column.</span>

<span class="sd">    Parameter</span>
<span class="sd">    ---------</span>
<span class="sd">    col: pandas.Series</span>
<span class="sd">        column</span>
<span class="sd">    rtol: float, optional</span>
<span class="sd">        rtol as used by numpy.allclose, default 1e-05</span>
<span class="sd">    atol: float, optional</span>
<span class="sd">        atol as used by numpy.allclose, default 1e-08</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        list of (tuples) of duplicates</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span><span class="p">())</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span>
                <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
            <span class="p">)</span>
            <span class="n">duplicates</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))):</span>
            <span class="n">alist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">item</span><span class="p">,</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">alist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                            <span class="n">alist</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                            <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span>
                                            <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)]</span>

        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))):</span>
                <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                            <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;duplicate comparison currently only allowed for &#39;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span><span class="w"> </span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">duplicates</span>


<span class="n">reference</span><span class="o">.</span><span class="n">get_duplicates</span> <span class="o">=</span> <span class="n">get_duplicates</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;atoms&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">_atoms</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">duplicates</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">get_duplicates</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">])</span>
<span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">duplicates</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/js/w1m65s9d371f4z6l71rjgn200000gn/T/ipykernel_21634/3945742013.py:2: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  reference.data.drop(index=duplicates, inplace=True)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>gap</th>
      <th>u0</th>
      <th>atoms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>gdb_1</td>
      <td>C</td>
      <td>0.5048</td>
      <td>-40.478930</td>
      <td>CHHHH</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gdb_2</td>
      <td>N</td>
      <td>0.3399</td>
      <td>-56.525887</td>
      <td>NHHH</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gdb_3</td>
      <td>O</td>
      <td>0.3615</td>
      <td>-76.404702</td>
      <td>OHH</td>
    </tr>
    <tr>
      <th>3</th>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.3351</td>
      <td>-77.308427</td>
      <td>CCHH</td>
    </tr>
    <tr>
      <th>4</th>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.3796</td>
      <td>-93.411888</td>
      <td>CNH</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>85</th>
      <td>gdb_86</td>
      <td>CC1(CC1)C</td>
      <td>0.3526</td>
      <td>-196.409349</td>
      <td>CCCCCHHHHHHHHHH</td>
    </tr>
    <tr>
      <th>88</th>
      <td>gdb_89</td>
      <td>N=C1CCO1</td>
      <td>0.2907</td>
      <td>-247.201165</td>
      <td>NCCCOHHHHH</td>
    </tr>
    <tr>
      <th>89</th>
      <td>gdb_90</td>
      <td>C1CC(=O)C1</td>
      <td>0.2222</td>
      <td>-231.155780</td>
      <td>CCCOCHHHHHH</td>
    </tr>
    <tr>
      <th>90</th>
      <td>gdb_91</td>
      <td>C1CNC1=O</td>
      <td>0.2880</td>
      <td>-247.225618</td>
      <td>CCNCOHHHHH</td>
    </tr>
    <tr>
      <th>98</th>
      <td>gdb_99</td>
      <td>C1C(CO1)O</td>
      <td>0.3069</td>
      <td>-268.248371</td>
      <td>CCCOOHHHHHH</td>
    </tr>
  </tbody>
</table>
<p>77 rows × 5 columns</p>
</div></div></div>
</div>
<p>Let us finally prune the <code class="docutils literal notranslate"><span class="pre">molecules</span></code> list we created earlier to include only the molecules in the reduced reference set. First we reindex the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code>, ensuring the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> index is contigouous monotonically increasing to make it more conveinent to work with. Note that the previous index—corresponding to the QM9 index—is stored in a new column now called <code class="docutils literal notranslate"><span class="pre">index</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">reference</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>gap</th>
      <th>u0</th>
      <th>atoms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>gdb_1</td>
      <td>C</td>
      <td>0.5048</td>
      <td>-40.478930</td>
      <td>CHHHH</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>gdb_2</td>
      <td>N</td>
      <td>0.3399</td>
      <td>-56.525887</td>
      <td>NHHH</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>gdb_3</td>
      <td>O</td>
      <td>0.3615</td>
      <td>-76.404702</td>
      <td>OHH</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.3351</td>
      <td>-77.308427</td>
      <td>CCHH</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.3796</td>
      <td>-93.411888</td>
      <td>CNH</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>72</th>
      <td>85</td>
      <td>gdb_86</td>
      <td>CC1(CC1)C</td>
      <td>0.3526</td>
      <td>-196.409349</td>
      <td>CCCCCHHHHHHHHHH</td>
    </tr>
    <tr>
      <th>73</th>
      <td>88</td>
      <td>gdb_89</td>
      <td>N=C1CCO1</td>
      <td>0.2907</td>
      <td>-247.201165</td>
      <td>NCCCOHHHHH</td>
    </tr>
    <tr>
      <th>74</th>
      <td>89</td>
      <td>gdb_90</td>
      <td>C1CC(=O)C1</td>
      <td>0.2222</td>
      <td>-231.155780</td>
      <td>CCCOCHHHHHH</td>
    </tr>
    <tr>
      <th>75</th>
      <td>90</td>
      <td>gdb_91</td>
      <td>C1CNC1=O</td>
      <td>0.2880</td>
      <td>-247.225618</td>
      <td>CCNCOHHHHH</td>
    </tr>
    <tr>
      <th>76</th>
      <td>98</td>
      <td>gdb_99</td>
      <td>C1C(CO1)O</td>
      <td>0.3069</td>
      <td>-268.248371</td>
      <td>CCCOOHHHHHH</td>
    </tr>
  </tbody>
</table>
<p>77 rows × 6 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="running-calculations-on-the-molecules">
<h2>Running calculations on the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code>s<a class="headerlink" href="#running-calculations-on-the-molecules" title="Link to this heading">#</a></h2>
<p>Let us now run some simulations on the molecules in the reference dataset. We will use the xTB software to calculate the energies and gradients of the molecules. For a more in-depth guide on how to use xTB with the HSP, please refer to the <code class="docutils literal notranslate"><span class="pre">QUICKSTART</span> <span class="pre">GUIDE</span> <span class="pre">LINK</span> <span class="pre">HERE</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the compute settings for running xTB in the conda environment we setup</span>
<span class="c1"># earlier</span>
<span class="n">xtb_conda_settings</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">create_compute_settings</span><span class="p">(</span>
    <span class="s2">&quot;conda&quot;</span><span class="p">,</span>
    <span class="n">conda_env</span><span class="o">=</span><span class="s2">&quot;conda_xtb&quot;</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;xtb_conda_simulations&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Define the HSP xTB method object</span>
<span class="n">xtb_method</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Xtb</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="c1"># calculate energy, gradients, and perform a geometry optimization</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry_optimization&quot;</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="n">compute_settings</span><span class="o">=</span><span class="n">xtb_conda_settings</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="n">hsp</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="s2">&quot;atomic&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A single xTB calculation may now be run by picking out one of the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> objects from the list, and calling the <code class="docutils literal notranslate"><span class="pre">.run()</span></code> method from <code class="docutils literal notranslate"><span class="pre">xtb_method</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_0</span> <span class="o">=</span> <span class="n">xtb_method</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;xtbopt.xyz&#39;: &#39;5\n energy: -4.175218289350 gnorm: 0.000359683898 xtb: 6.6.1 (8d0f1dd)\nC           -0.00015654817627        0.00007121354402       -0.00010985227481\nH            0.52742168077821        0.74358830513502       -0.58356844346293\nH            0.71197963169963       -0.58317003458969        0.56899242241239\nH           -0.55343963426943       -0.65313148358235       -0.66265592159449\nH           -0.68580513003213        0.49264199949299        0.67734179491984\n&#39;, &#39;final_geometry&#39;: [[-0.00015654817627, 7.121354402e-05, -0.00010985227481], [0.52742168077821, 0.74358830513502, -0.58356844346293], [0.71197963169963, -0.58317003458969, 0.56899242241239], [-0.55343963426943, -0.65313148358235, -0.66265592159449], [-0.68580513003213, 0.49264199949299, 0.67734179491984]], &#39;input_geometry&#39;: array([[ 0.005119, -0.01062 ,  0.006014],
       [ 0.549668,  0.755438, -0.596981],
       [ 0.749764, -0.587944,  0.585285],
       [-0.586753, -0.652136, -0.676092],
       [-0.717798,  0.495262,  0.681774]]), &#39;atoms&#39;: [&#39;C&#39;, &#39;H&#39;, &#39;H&#39;, &#39;H&#39;, &#39;H&#39;], &#39;gradient&#39;: array([ 2.81538760e-05, -3.62963800e-06,  1.18386340e-05,  1.23998482e-04,
        1.02193228e-04, -5.94675690e-05,  9.60687500e-06, -7.02442000e-07,
        6.45918500e-06, -7.79932110e-05, -1.83102844e-04, -1.28070096e-04,
       -8.37660210e-05,  8.52416970e-05,  1.69239847e-04]), &#39;version&#39;: &#39;6.6.1&#39;, &#39;cite&#39;: &#39;10.1002/wcms.1493&#39;, &#39;omp_threads&#39;: &#39;12&#39;, &#39;Reference&#39;: &#39;10.1021/acs.jctc.8b01176&#39;, &#39;basis_functions&#39;: 8, &#39;atomic_orbitals&#39;: 8, &#39;electrons&#39;: 8, &#39;iterations&#39;: 3, &#39;fermi_level&#39;: -4.0484, &#39;energy&#39;: -4.17521828935, &#39;homo_lumo_gap&#39;: 17.34117028748, &#39;geometry_iterations&#39;: 4, &#39;orbital_energies&#39;: [-0.5817974, -0.4674646, -0.4674467, -0.4674136, 4.6222, 6.2276, 6.2288, 6.2298], &#39;orbital_occupations&#39;: [2.0, 2.0, 2.0, 2.0, 0.0, 0.0, 0.0, 0.0], &#39;orbital_homo&#39;: 4, &#39;orbital_lumo&#39;: 5, &#39;coordination_numbers&#39;: [3.702, 0.925, 0.925, 0.925, 0.925], &#39;molecular_dipole&#39;: 0.001, &#39;molecular_quadrupole&#39;: array([&#39;-0.000&#39;, &#39;0.001&#39;, &#39;0.000&#39;, &#39;-0.001&#39;, &#39;0.001&#39;, &#39;0.000&#39;],
      dtype=&#39;&lt;U6&#39;), &#39;molecular_quadrupole_order&#39;: [&#39;xx&#39;, &#39;xy&#39;, &#39;yy&#39;, &#39;xz&#39;, &#39;yz&#39;, &#39;zz&#39;], &#39;gradient_norm&#39;: &#39;0.000359683898&#39;}
</pre></div>
</div>
</div>
</div>
<p>The result object is returned right here in the notebook. If we want to inspect the result files from the simulation directly, we may find them inside the <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> directory we defined in the computational settings earlier.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tree
├──<span class="w"> </span>dataset.ipynb
├──<span class="w"> </span>qm9.csv
├──<span class="w"> </span>xtb_conda_simulations
│<span class="w">   </span>├──<span class="w"> </span>ee0a1806e18a850dc9811e5c7def32220d04d00aefa81e6b3f3509b1202264a9
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>charges
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ee0a1806e18a850dc9811e5c7def32220d04d00aefa81e6b3f3509b1202264a9.engrad
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ee0a1806e18a850dc9811e5c7def32220d04d00aefa81e6b3f3509b1202264a9.out
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ee0a1806e18a850dc9811e5c7def32220d04d00aefa81e6b3f3509b1202264a9.stderr
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ee0a1806e18a850dc9811e5c7def32220d04d00aefa81e6b3f3509b1202264a9.xyz
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>energy
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>gradient
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>wbo
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>xtbopt.log
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>xtbopt.xyz
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>xtbrestart
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>xtbtopo.mol
│<span class="w">   </span>├──<span class="w"> </span>stderr.out
│<span class="w">   </span>└──<span class="w"> </span>xtb_version.out
</pre></div>
</div>
<p>Each simulation will be placed in a subdirectory named after the simulation’s (molecule and simulation method details) <em>hash</em>. This is a string containing a 65-digit hexadecimal number, acting as a unique identifier for the calculation.</p>
<section id="running-multiple-calculations">
<h3>Running multiple calculations<a class="headerlink" href="#running-multiple-calculations" title="Link to this heading">#</a></h3>
<section id="sequential-runs">
<h4>Sequential <code class="docutils literal notranslate"><span class="pre">run</span></code>s<a class="headerlink" href="#sequential-runs" title="Link to this heading">#</a></h4>
<p>There are two main ways to run multiple simulations with the HSP. One way is sequentially. This may be done simply by providing the run method with a list of <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_0_to_5</span> <span class="o">=</span> <span class="n">xtb_method</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="concurrent-aruns">
<h4>Concurrent <code class="docutils literal notranslate"><span class="pre">arun</span></code>s<a class="headerlink" href="#concurrent-aruns" title="Link to this heading">#</a></h4>
<p>The other way is to perform the calculations in parallel. This is done with the <code class="docutils literal notranslate"><span class="pre">.arun()</span></code> method of the xTB method object. As <code class="docutils literal notranslate"><span class="pre">.arun()</span></code> is an asynchronous method, we need to <code class="docutils literal notranslate"><span class="pre">await</span></code> the result with <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="n">results_0_to_10</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">xtb_method</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">[:</span><span class="mi">10</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Note that all simulations are <em>cached</em>, meaning that any starting simulation will first check if the result has already been calculated and stored. If so, the result will be immediately returned. We can demonstrate this by now running the xTB calculations for the first ten molecules again, and observing that the results will be instantaneously returned.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_recomputed</span> <span class="o">=</span> <span class="n">xtb_method</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">molecules</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="dataset-objects-and-hsp-results">
<h2><code class="docutils literal notranslate"><span class="pre">DataSet</span></code> objects and HSP results<a class="headerlink" href="#dataset-objects-and-hsp-results" title="Link to this heading">#</a></h2>
<p>Let us now create an HSP <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> from the results of the xTB calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">testset</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span>
    <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb_conda_simulations&quot;</span><span class="p">,</span>
    <span class="n">parser</span><span class="o">=</span><span class="n">xtb_method</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">testset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;version&#39;, &#39;cite&#39;, &#39;omp_threads&#39;, &#39;Reference&#39;, &#39;basis_functions&#39;,
       &#39;atomic_orbitals&#39;, &#39;electrons&#39;, &#39;iterations&#39;, &#39;fermi_level&#39;, &#39;energy&#39;,
       &#39;homo_lumo_gap&#39;, &#39;geometry_iterations&#39;, &#39;orbital_energies&#39;,
       &#39;orbital_occupations&#39;, &#39;orbital_homo&#39;, &#39;orbital_lumo&#39;,
       &#39;coordination_numbers&#39;, &#39;molecular_dipole&#39;, &#39;molecular_quadrupole&#39;,
       &#39;molecular_quadrupole_order&#39;, &#39;gradient_norm&#39;, &#39;gradient&#39;,
       &#39;input_geometry&#39;, &#39;atoms&#39;, &#39;xtbopt.xyz&#39;, &#39;final_geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>As with the reference dataset earlier, this new test set contains a lot of properties we are not interested in right now (such as the version number of xTB used to run the simulations, the DOI of the xTB software paper, etc.). We can use the <code class="docutils literal notranslate"><span class="pre">dataset.drop</span></code> method to remove these columns from the dataset.</p>
<p>However, it is easier to just read in only the data we care about when we create the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> object. We can do this by providing the <code class="docutils literal notranslate"><span class="pre">keys=</span></code> keyword argument to the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> constructor. This will only read in the columns we specify.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">testset</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span>
    <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;xtb_conda_simulations&quot;</span><span class="p">,</span>
    <span class="n">parser</span><span class="o">=</span><span class="n">xtb_method</span><span class="o">.</span><span class="n">OutputParser</span><span class="p">,</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;homo_lumo_gap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;atoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;final_geometry&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">units</span><span class="o">=</span><span class="n">hsp</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="s2">&quot;atomic&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Convert the &quot;atoms&quot; column to a string from a list</span>
<span class="n">testset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="n">testset</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>energy</th>
      <th>homo_lumo_gap</th>
      <th>atoms</th>
      <th>final_geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-5.206769</td>
      <td>7.288901</td>
      <td>CCHH</td>
      <td>[[-0.56211563647059, 0.23910764565559, 0.02689...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-7.336371</td>
      <td>15.504792</td>
      <td>CCHHHHHH</td>
      <td>[[-0.7603170246353, 0.01769692838875, 0.017796...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-7.175648</td>
      <td>3.620081</td>
      <td>COHH</td>
      <td>[[0.00078145605603, -0.00013842954601, -0.0001...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.070544</td>
      <td>14.381636</td>
      <td>OHH</td>
      <td>[[-0.00024349594891, 0.37994936981825, 0.0], [...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-5.504063</td>
      <td>5.948841</td>
      <td>CNH</td>
      <td>[[-0.02069976821768, -0.34939553451093, -0.0],...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-8.382907</td>
      <td>7.080212</td>
      <td>CCCHHHH</td>
      <td>[[-0.94081333309376, 0.14274919428681, 0.00082...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-4.426244</td>
      <td>12.229820</td>
      <td>NHHH</td>
      <td>[[0.00222253356455, -0.00019656410115, 0.27501...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-8.688500</td>
      <td>6.110333</td>
      <td>CCNHHH</td>
      <td>[[-0.48653032543673, 0.02885077880477, -0.0031...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-8.226118</td>
      <td>13.090922</td>
      <td>COHHHH</td>
      <td>[[-0.36220929111903, -0.02428303744012, -0.015...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-4.175218</td>
      <td>17.341170</td>
      <td>CHHHH</td>
      <td>[[-0.00015654817627, 7.121354402e-05, -0.00010...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let us make a copy of the reference <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> containing only the first ten molecules.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_10</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">reference</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">reference_10</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>gap</th>
      <th>u0</th>
      <th>atoms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>gdb_1</td>
      <td>C</td>
      <td>0.5048</td>
      <td>-40.478930</td>
      <td>CHHHH</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>gdb_2</td>
      <td>N</td>
      <td>0.3399</td>
      <td>-56.525887</td>
      <td>NHHH</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>gdb_3</td>
      <td>O</td>
      <td>0.3615</td>
      <td>-76.404702</td>
      <td>OHH</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.3351</td>
      <td>-77.308427</td>
      <td>CCHH</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.3796</td>
      <td>-93.411888</td>
      <td>CNH</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>gdb_6</td>
      <td>C=O</td>
      <td>0.2263</td>
      <td>-114.483613</td>
      <td>COHH</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>gdb_7</td>
      <td>CC</td>
      <td>0.4426</td>
      <td>-79.764152</td>
      <td>CCHHHHHH</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>gdb_8</td>
      <td>CO</td>
      <td>0.3437</td>
      <td>-115.679136</td>
      <td>COHHHH</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>gdb_9</td>
      <td>CC#C</td>
      <td>0.3222</td>
      <td>-116.609549</td>
      <td>CCCHHHH</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>gdb_10</td>
      <td>CC#N</td>
      <td>0.3640</td>
      <td>-132.718150</td>
      <td>CCNHHH</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we can merge the test and reference datasets together using …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_10</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testset</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="s2">&quot;atoms&quot;</span><span class="p">})</span>
<span class="n">reference_10</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>energy</th>
      <th>homo_lumo_gap</th>
      <th>atoms</th>
      <th>final_geometry</th>
      <th>index</th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>gap</th>
      <th>u0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-4.175218</td>
      <td>17.341170</td>
      <td>CHHHH</td>
      <td>[[-0.00015654817627, 7.121354402e-05, -0.00010...</td>
      <td>0</td>
      <td>gdb_1</td>
      <td>C</td>
      <td>0.5048</td>
      <td>-40.478930</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-4.426244</td>
      <td>12.229820</td>
      <td>NHHH</td>
      <td>[[0.00222253356455, -0.00019656410115, 0.27501...</td>
      <td>1</td>
      <td>gdb_2</td>
      <td>N</td>
      <td>0.3399</td>
      <td>-56.525887</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-5.070544</td>
      <td>14.381636</td>
      <td>OHH</td>
      <td>[[-0.00024349594891, 0.37994936981825, 0.0], [...</td>
      <td>2</td>
      <td>gdb_3</td>
      <td>O</td>
      <td>0.3615</td>
      <td>-76.404702</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.206769</td>
      <td>7.288901</td>
      <td>CCHH</td>
      <td>[[-0.56211563647059, 0.23910764565559, 0.02689...</td>
      <td>3</td>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.3351</td>
      <td>-77.308427</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-5.504063</td>
      <td>5.948841</td>
      <td>CNH</td>
      <td>[[-0.02069976821768, -0.34939553451093, -0.0],...</td>
      <td>4</td>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.3796</td>
      <td>-93.411888</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-7.175648</td>
      <td>3.620081</td>
      <td>COHH</td>
      <td>[[0.00078145605603, -0.00013842954601, -0.0001...</td>
      <td>5</td>
      <td>gdb_6</td>
      <td>C=O</td>
      <td>0.2263</td>
      <td>-114.483613</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-7.336371</td>
      <td>15.504792</td>
      <td>CCHHHHHH</td>
      <td>[[-0.7603170246353, 0.01769692838875, 0.017796...</td>
      <td>6</td>
      <td>gdb_7</td>
      <td>CC</td>
      <td>0.4426</td>
      <td>-79.764152</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-8.226118</td>
      <td>13.090922</td>
      <td>COHHHH</td>
      <td>[[-0.36220929111903, -0.02428303744012, -0.015...</td>
      <td>7</td>
      <td>gdb_8</td>
      <td>CO</td>
      <td>0.3437</td>
      <td>-115.679136</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-8.382907</td>
      <td>7.080212</td>
      <td>CCCHHHH</td>
      <td>[[-0.94081333309376, 0.14274919428681, 0.00082...</td>
      <td>8</td>
      <td>gdb_9</td>
      <td>CC#C</td>
      <td>0.3222</td>
      <td>-116.609549</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-8.688500</td>
      <td>6.110333</td>
      <td>CCNHHH</td>
      <td>[[-0.48653032543673, 0.02885077880477, -0.0031...</td>
      <td>9</td>
      <td>gdb_10</td>
      <td>CC#N</td>
      <td>0.3640</td>
      <td>-132.718150</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can rename some columns to make the data easier to keep track of.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_10</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">reference_10</span><span class="p">)</span>
<span class="n">data_10</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="s2">&quot;xtb_energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;u0&quot;</span><span class="p">:</span> <span class="s2">&quot;reference_energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;homo_lumo_gap&quot;</span><span class="p">:</span> <span class="s2">&quot;xtb_gap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gap&quot;</span><span class="p">:</span> <span class="s2">&quot;reference_gap&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     energy  homo_lumo_gap     atoms  \
0 -4.175218      17.341170     CHHHH
1 -4.426244      12.229820      NHHH
2 -5.070544      14.381636       OHH
3 -5.206769       7.288901      CCHH
4 -5.504063       5.948841       CNH
5 -7.175648       3.620081      COHH
6 -7.336371      15.504792  CCHHHHHH
7 -8.226118      13.090922    COHHHH
8 -8.382907       7.080212   CCCHHHH
9 -8.688500       6.110333    CCNHHH

                                      final_geometry  index  mol_id smiles  \
0  [[-0.00015654817627, 7.121354402e-05, -0.00010...      0   gdb_1      C
1  [[0.00222253356455, -0.00019656410115, 0.27501...      1   gdb_2      N
2  [[-0.00024349594891, 0.37994936981825, 0.0], [...      2   gdb_3      O
3  [[-0.56211563647059, 0.23910764565559, 0.02689...      3   gdb_4    C#C
4  [[-0.02069976821768, -0.34939553451093, -0.0],...      4   gdb_5    C#N
5  [[0.00078145605603, -0.00013842954601, -0.0001...      5   gdb_6    C=O
6  [[-0.7603170246353, 0.01769692838875, 0.017796...      6   gdb_7     CC
7  [[-0.36220929111903, -0.02428303744012, -0.015...      7   gdb_8     CO
8  [[-0.94081333309376, 0.14274919428681, 0.00082...      8   gdb_9   CC#C
9  [[-0.48653032543673, 0.02885077880477, -0.0031...      9  gdb_10   CC#N

      gap          u0
0  0.5048  -40.478930
1  0.3399  -56.525887
2  0.3615  -76.404702
3  0.3351  -77.308427
4  0.3796  -93.411888
5  0.2263 -114.483613
6  0.4426  -79.764152
7  0.3437 -115.679136
8  0.3222 -116.609549
9  0.3640 -132.718150
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">Input In [63],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">data_10</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">reference_10</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">data_10</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">data_10</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="s2">&quot;xtb_energy&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>         <span class="s2">&quot;u0&quot;</span><span class="p">:</span> <span class="s2">&quot;reference_energy&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>         <span class="s2">&quot;homo_lumo_gap&quot;</span><span class="p">:</span> <span class="s2">&quot;xtb_gap&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>         <span class="s2">&quot;gap&quot;</span><span class="p">:</span> <span class="s2">&quot;reference_gap&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/hyobj/dataset/dataset.py:193,</span> in <span class="ni">DataSet.rename_columns</span><span class="nt">(self, mappings)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">mappings</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span>     <span class="c1"># rename column units</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span>     <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;column_units&#39;</span><span class="p">][</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span>         <span class="n">value</span>
<span class="ne">--&gt; </span><span class="mi">193</span>     <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span>  <span class="c1"># type: ignore</span>
<span class="g g-Whitespace">    </span><span class="mi">194</span>         <span class="s1">&#39;column_units&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">195</span>     <span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
<span class="g g-Whitespace">    </span><span class="mi">196</span>         <span class="n">key</span>  <span class="c1"># type: ignore</span>
<span class="g g-Whitespace">    </span><span class="mi">197</span>     <span class="p">)</span>

<span class="ne">KeyError</span>: &#39;energy&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: It seems neccessary to set the &quot;column_units&quot; property, or this renameing </span>
<span class="c1"># straight up fails</span>

<span class="n">data_10</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;column_units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">hsp</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="s2">&quot;atomic&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;u0&quot;</span><span class="p">,</span> <span class="s2">&quot;gap&quot;</span><span class="p">,</span> <span class="s2">&quot;homo_lumo_gap&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">data_10</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="s2">&quot;xtb_energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;u0&quot;</span><span class="p">:</span> <span class="s2">&quot;reference_energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;homo_lumo_gap&quot;</span><span class="p">:</span> <span class="s2">&quot;xtb_gap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gap&quot;</span><span class="p">:</span> <span class="s2">&quot;reference_gap&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">data_10</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>xtb_energy</th>
      <th>xtb_gap</th>
      <th>atoms</th>
      <th>final_geometry</th>
      <th>index</th>
      <th>mol_id</th>
      <th>smiles</th>
      <th>reference_gap</th>
      <th>reference_energy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-4.175218</td>
      <td>17.341170</td>
      <td>CHHHH</td>
      <td>[[-0.00015654817627, 7.121354402e-05, -0.00010...</td>
      <td>0</td>
      <td>gdb_1</td>
      <td>C</td>
      <td>0.5048</td>
      <td>-40.478930</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-4.426244</td>
      <td>12.229820</td>
      <td>NHHH</td>
      <td>[[0.00222253356455, -0.00019656410115, 0.27501...</td>
      <td>1</td>
      <td>gdb_2</td>
      <td>N</td>
      <td>0.3399</td>
      <td>-56.525887</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-5.070544</td>
      <td>14.381636</td>
      <td>OHH</td>
      <td>[[-0.00024349594891, 0.37994936981825, 0.0], [...</td>
      <td>2</td>
      <td>gdb_3</td>
      <td>O</td>
      <td>0.3615</td>
      <td>-76.404702</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.206769</td>
      <td>7.288901</td>
      <td>CCHH</td>
      <td>[[-0.56211563647059, 0.23910764565559, 0.02689...</td>
      <td>3</td>
      <td>gdb_4</td>
      <td>C#C</td>
      <td>0.3351</td>
      <td>-77.308427</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-5.504063</td>
      <td>5.948841</td>
      <td>CNH</td>
      <td>[[-0.02069976821768, -0.34939553451093, -0.0],...</td>
      <td>4</td>
      <td>gdb_5</td>
      <td>C#N</td>
      <td>0.3796</td>
      <td>-93.411888</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-7.175648</td>
      <td>3.620081</td>
      <td>COHH</td>
      <td>[[0.00078145605603, -0.00013842954601, -0.0001...</td>
      <td>5</td>
      <td>gdb_6</td>
      <td>C=O</td>
      <td>0.2263</td>
      <td>-114.483613</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-7.336371</td>
      <td>15.504792</td>
      <td>CCHHHHHH</td>
      <td>[[-0.7603170246353, 0.01769692838875, 0.017796...</td>
      <td>6</td>
      <td>gdb_7</td>
      <td>CC</td>
      <td>0.4426</td>
      <td>-79.764152</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-8.226118</td>
      <td>13.090922</td>
      <td>COHHHH</td>
      <td>[[-0.36220929111903, -0.02428303744012, -0.015...</td>
      <td>7</td>
      <td>gdb_8</td>
      <td>CO</td>
      <td>0.3437</td>
      <td>-115.679136</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-8.382907</td>
      <td>7.080212</td>
      <td>CCCHHHH</td>
      <td>[[-0.94081333309376, 0.14274919428681, 0.00082...</td>
      <td>8</td>
      <td>gdb_9</td>
      <td>CC#C</td>
      <td>0.3222</td>
      <td>-116.609549</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-8.688500</td>
      <td>6.110333</td>
      <td>CCNHHH</td>
      <td>[[-0.48653032543673, 0.02885077880477, -0.0031...</td>
      <td>9</td>
      <td>gdb_10</td>
      <td>CC#N</td>
      <td>0.3640</td>
      <td>-132.718150</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="comparing-xtb-calculations-to-reference-data">
<h3>Comparing xTB calculations to reference data<a class="headerlink" href="#comparing-xtb-calculations-to-reference-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;gap&quot;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;xtb&quot;</span><span class="p">,</span> <span class="s2">&quot;reference&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;b^-&quot;</span><span class="p">,</span> <span class="s2">&quot;rs--&quot;</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">data_10</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;smiles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">data_10</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2"> / hartree&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/184207efcdbd3f1ee88064bfbbbbabe2db53a200e3e002bfbe9a8cb803251c8d.png" src="../../_images/184207efcdbd3f1ee88064bfbbbbabe2db53a200e3e002bfbe9a8cb803251c8d.png" />
</div>
</div>
</section>
</section>
<section id="offload-simulations-slurm-servers">
<h2>Offload simulations: SLURM servers<a class="headerlink" href="#offload-simulations-slurm-servers" title="Link to this heading">#</a></h2>
<section id="monitoring-job-progress">
<h3>Monitoring job progress<a class="headerlink" href="#monitoring-job-progress" title="Link to this heading">#</a></h3>
</section>
<section id="batching-calculations-into-a-single-slurm-job">
<h3>Batching calculations into a single SLURM job<a class="headerlink" href="#batching-calculations-into-a-single-slurm-job" title="Link to this heading">#</a></h3>
</section>
</section>
<section id="comparing-xtb-calculations-versus-the-full-reference-data">
<h2>Comparing xTB calculations versus the “full” reference data<a class="headerlink" href="#comparing-xtb-calculations-versus-the-full-reference-data" title="Link to this heading">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "hsp_dataset"
        },
        kernelOptions: {
            name: "hsp_dataset",
            path: "./src/user_guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'hsp_dataset'</script>

                </article>





                <footer class="prev-next-footer d-print-none">

<div class="prev-next-area">
</div>
                </footer>

            </div>



                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i>
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data-our-first-dataset">Loading the data: Our first <code class="docutils literal notranslate"><span class="pre">DataSet</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pruning-the-dataset">Pruning the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-certain-columns">Extracting certain columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-objects-and-hsp-calculations"><code class="docutils literal notranslate"><span class="pre">DataSet</span></code> objects and HSP calculations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-molecules">Visualizing <code class="docutils literal notranslate"><span class="pre">Molecule</span></code>s</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-certain-rows">Removing certain rows</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calculations-on-the-molecules">Running calculations on the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code>s</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-multiple-calculations">Running multiple calculations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-runs">Sequential <code class="docutils literal notranslate"><span class="pre">run</span></code>s</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#concurrent-aruns">Concurrent <code class="docutils literal notranslate"><span class="pre">arun</span></code>s</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-objects-and-hsp-results"><code class="docutils literal notranslate"><span class="pre">DataSet</span></code> objects and HSP results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-xtb-calculations-to-reference-data">Comparing xTB calculations to reference data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#offload-simulations-slurm-servers">Offload simulations: SLURM servers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring-job-progress">Monitoring job progress</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#batching-calculations-into-a-single-slurm-job">Batching calculations into a single SLURM job</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-xtb-calculations-versus-the-full-reference-data">Comparing xTB calculations versus the “full” reference data</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/src/user_guide/dataset.ipynb">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>


          </div>
          <footer class="bd-footer-content">

          </footer>

      </main>
    </div>
  </div>

  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">

    <div class="footer-items__start">

        <div class="footer-item">

  <p class="copyright">

      © Copyright 2025.
      <br/>

  </p>
</div>

    </div>


    <div class="footer-items__center">

        <div class="footer-item"><p align="left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" height="20px"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M72 88a56 56 0 1 1 112 0A56 56 0 1 1 72 88zM64 245.7C54 256.9 48 271.8 48 288s6 31.1 16 42.3V245.7zm144.4-49.3C178.7 222.7 160 261.2 160 304c0 34.3 12 65.8 32 90.5V416c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V389.2C26.2 371.2 0 332.7 0 288c0-61.9 50.1-112 112-112h32c24 0 46.2 7.5 64.4 20.3zM448 416V394.5c20-24.7 32-56.2 32-90.5c0-42.8-18.7-81.3-48.4-107.7C449.8 183.5 472 176 496 176h32c61.9 0 112 50.1 112 112c0 44.7-26.2 83.2-64 101.2V416c0 17.7-14.3 32-32 32H480c-17.7 0-32-14.3-32-32zm8-328a56 56 0 1 1 112 0A56 56 0 1 1 456 88zM576 245.7v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM320 32a64 64 0 1 1 0 128 64 64 0 1 1 0-128zM240 304c0 16.2 6 31 16 42.3V261.7c-10 11.3-16 26.1-16 42.3zm144-42.3v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM448 304c0 44.7-26.2 83.2-64 101.2V448c0 17.7-14.3 32-32 32H288c-17.7 0-32-14.3-32-32V405.2c-37.8-18-64-56.5-64-101.2c0-61.9 50.1-112 112-112h32c61.9 0 112 50.1 112 112z"/></svg>
    <a href="../footer/about_us.html">About us</a>
</p>
<p align="left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 230 203" height="20px"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M212.55,102.07c0,28.44-10.74,49.54-27.89,49.54s-37.27-22.68-37.27-49.54,20.13-49.54,37.27-49.54,27.89,21.1,27.89,49.54 M19.06,102.07c0-50.49,19.07-87.95,49.5-87.95s66.17,40.26,66.17,87.95-35.73,87.95-66.17,87.95-49.5-37.46-49.5-87.95"/></svg>
    <a href="https://www.mn.uio.no/hylleraas/english/")>The Hylleraas Centre</a>
</p>
<p align="left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="20px"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M448 296c0 66.3-53.7 120-120 120h-8c-17.7 0-32-14.3-32-32s14.3-32 32-32h8c30.9 0 56-25.1 56-56v-8H320c-35.3 0-64-28.7-64-64V160c0-35.3 28.7-64 64-64h64c35.3 0 64 28.7 64 64v32 32 72zm-256 0c0 66.3-53.7 120-120 120H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h8c30.9 0 56-25.1 56-56v-8H64c-35.3 0-64-28.7-64-64V160c0-35.3 28.7-64 64-64h64c35.3 0 64 28.7 64 64v32 32 72z"/></svg>
    <a href="../footer/citing.html">Citing the Hylleraas Software Platform</a>
</p></div>

    </div>


    <div class="footer-items__end">

        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>

    </div>

</div>

  </footer>
  </body>
</html>